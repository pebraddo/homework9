<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Powell Braddock, ST 558">

<title>Homework 9 Modeling Practice - Continuation of Homework 8</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Basic Modeling Practice_files/libs/clipboard/clipboard.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/popper.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/anchor.min.js"></script>
<link href="Basic Modeling Practice_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Basic Modeling Practice_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Basic Modeling Practice_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Basic Modeling Practice_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Basic Modeling Practice_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 9 Modeling Practice - Continuation of Homework 8</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Powell Braddock, ST 558 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="homework-8-portion" class="level1">
<h1>Homework 8 Portion</h1>
<p>In this assignment, we are looking at the Seoul Bike Data from the UCI Machine Learning Repository. We are looking at the following variables of interest:</p>
<p>• Date : day/month/year</p>
<p>• Rented Bike count - Count of bikes rented at each hour</p>
<p>• Hour - Hour of the day</p>
<p>• Temperature-Temperature in Celsius</p>
<p>• Humidity - %</p>
<p>• Windspeed - m/s</p>
<p>• Visibility - 10m</p>
<p>• Dew point temperature - Celsius</p>
<p>• Solar radiation - MJ/m2</p>
<p>• Rainfall - mm</p>
<p>• Snowfall - cm</p>
<p>• Seasons - Winter, Spring, Summer, Autumn</p>
<p>• Holiday - Holiday/No holiday</p>
<p>• Functional Day - NoFunc(Non Functional Hours), Fun(Functional hours)</p>
<section id="reading-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-the-data">Reading in the Data</h2>
<p>Let’s look at the data using read_csv. We have to use the locale encoding of latin1 because of the degree symbol for temperature variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#originally got an error: what I think came from the degree symbol in one of the attributes.  the wild internet provided the locale = latin1 solution!</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv'</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">'latin1'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8760 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Date, Seasons, Holiday, Functioning Day
dbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,760 × 14
   Date       `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
   &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;
 1 01/12/2017                 254     0              -5.2            37
 2 01/12/2017                 204     1              -5.5            38
 3 01/12/2017                 173     2              -6              39
 4 01/12/2017                 107     3              -6.2            40
 5 01/12/2017                  78     4              -6              36
 6 01/12/2017                 100     5              -6.4            37
 7 01/12/2017                 181     6              -6.6            35
 8 01/12/2017                 460     7              -7.4            38
 9 01/12/2017                 930     8              -7.6            37
10 01/12/2017                 490     9              -6.5            27
# ℹ 8,750 more rows
# ℹ 9 more variables: `Wind speed (m/s)` &lt;dbl&gt;, `Visibility (10m)` &lt;dbl&gt;,
#   `Dew point temperature(°C)` &lt;dbl&gt;, `Solar Radiation (MJ/m2)` &lt;dbl&gt;,
#   `Rainfall(mm)` &lt;dbl&gt;, `Snowfall (cm)` &lt;dbl&gt;, Seasons &lt;chr&gt;, Holiday &lt;chr&gt;,
#   `Functioning Day` &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<p>Now we must <em>check</em> the data… I’m starting with check for missingness: looks like we have na_counts of zero across the board for all columns! Whoop whoop whoop!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sum_na <span class="ot">&lt;-</span> <span class="cf">function</span>(column){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">is.na</span>(column) <span class="sc">+</span> <span class="fu">is.null</span>(column) <span class="sc">+</span> <span class="fu">is.nan</span>(column))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>na_counts <span class="ot">&lt;-</span> seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum_na))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>na_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 14
   Date `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
  &lt;int&gt;               &lt;int&gt; &lt;int&gt;             &lt;int&gt;         &lt;int&gt;
1     0                   0     0                 0             0
# ℹ 9 more variables: `Wind speed (m/s)` &lt;int&gt;, `Visibility (10m)` &lt;int&gt;,
#   `Dew point temperature(°C)` &lt;int&gt;, `Solar Radiation (MJ/m2)` &lt;int&gt;,
#   `Rainfall(mm)` &lt;int&gt;, `Snowfall (cm)` &lt;int&gt;, Seasons &lt;int&gt;, Holiday &lt;int&gt;,
#   `Functioning Day` &lt;int&gt;</code></pre>
</div>
</div>
<p>Now, we must check the column types and the values within the columns to make sure they make sense. I’m using the psych package’s describe() for basic summary statistics for numeric columns. I’m checking the unique values for the categorical variables using unique().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'psych'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:ggplot2':

    %+%, alpha</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(seoul_bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          vars    n    mean     sd  median trimmed    mad   min
Date*                        1 8760  183.00 105.37  183.00  183.00 134.92   1.0
Rented Bike Count            2 8760  704.60 645.00  504.50  612.58 553.75   0.0
Hour                         3 8760   11.50   6.92   11.50   11.50   8.90   0.0
Temperature(°C)              4 8760   12.88  11.94   13.70   13.19  13.94 -17.8
Humidity(%)                  5 8760   58.23  20.36   57.00   58.02  23.72   0.0
Wind speed (m/s)             6 8760    1.72   1.04    1.50    1.63   1.04   0.0
Visibility (10m)             7 8760 1436.83 608.30 1698.00 1509.50 447.75  27.0
Dew point temperature(°C)    8 8760    4.07  13.06    5.10    4.76  14.38 -30.6
Solar Radiation (MJ/m2)      9 8760    0.57   0.87    0.01    0.38   0.01   0.0
Rainfall(mm)                10 8760    0.15   1.13    0.00    0.00   0.00   0.0
Snowfall (cm)               11 8760    0.08   0.44    0.00    0.00   0.00   0.0
Seasons*                    12 8760    2.50   1.11    2.00    2.49   1.48   1.0
Holiday*                    13 8760    1.95   0.22    2.00    2.00   0.00   1.0
Functioning Day*            14 8760    1.97   0.18    2.00    2.00   0.00   1.0
                              max   range  skew kurtosis   se
Date*                      365.00  364.00  0.00    -1.20 1.13
Rented Bike Count         3556.00 3556.00  1.15     0.85 6.89
Hour                        23.00   23.00  0.00    -1.20 0.07
Temperature(°C)             39.40   57.20 -0.20    -0.84 0.13
Humidity(%)                 98.00   98.00  0.06    -0.80 0.22
Wind speed (m/s)             7.40    7.40  0.89     0.73 0.01
Visibility (10m)          2000.00 1973.00 -0.70    -0.96 6.50
Dew point temperature(°C)   27.20   57.80 -0.37    -0.76 0.14
Solar Radiation (MJ/m2)      3.52    3.52  1.50     1.12 0.01
Rainfall(mm)                35.00   35.00 14.53   284.76 0.01
Snowfall (cm)                8.80    8.80  8.44    93.73 0.00
Seasons*                     4.00    3.00  0.00    -1.35 0.01
Holiday*                     2.00    1.00 -4.16    15.33 0.00
Functioning Day*             2.00    1.00 -5.17    24.72 0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span>Seasons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Winter" "Spring" "Summer" "Autumn"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span>Holiday) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "No Holiday" "Holiday"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span><span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yes" "No" </code></pre>
</div>
</div>
<p>Let’s convert the Date column into an actual date using the dmy() function from the lubridate package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_date <span class="ot">&lt;-</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  seoul_bike_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">dmy</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we want to turn the character variables (Seasons, Holiday, and Functioning Day) into factors (remember those unique values from before?). We can rename all the variables to be lower snake case too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data<span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Seasons =</span> <span class="fu">as.factor</span>(Seasons),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Holiday =</span> <span class="fu">as.factor</span>(Holiday),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'date'</span><span class="ot">=</span><span class="st">'Date'</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">'rented_bike_count'</span> <span class="ot">=</span> <span class="st">'Rented Bike Count'</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">'hour'</span> <span class="ot">=</span> <span class="st">'Hour'</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">'celcius_temp'</span> <span class="ot">=</span> <span class="st">'Temperature(°C)'</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">'percent_humidity'</span><span class="ot">=</span><span class="st">'Humidity(%)'</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">'wind_speed'</span><span class="ot">=</span> <span class="st">'Wind speed (m/s)'</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">'visib'</span><span class="ot">=</span><span class="st">'Visibility (10m)'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">'dew_point_temp'</span> <span class="ot">=</span> <span class="st">'Dew point temperature(°C)'</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">'solar_rad'</span><span class="ot">=</span><span class="st">'Solar Radiation (MJ/m2)'</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">'rainfall'</span> <span class="ot">=</span> <span class="st">'Rainfall(mm)'</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">'snowfall'</span> <span class="ot">=</span> <span class="st">'Snowfall (cm)'</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">'seasons'</span> <span class="ot">=</span> <span class="st">'Seasons'</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">'holiday'</span> <span class="ot">=</span> <span class="st">'Holiday'</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">'function_day'</span> <span class="ot">=</span> <span class="st">'Functioning Day'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Onto creating summary statistics. The first contingency table is the data grouped by Functioning Day across Rented Bike Count with descriptive summaries of mean, median, variance, standard deviation, and interquartile range.</p>
<p>Wow! When functioning day is ‘no’, there were no bike rentals. Bike rentals only occurred on functioning days of ‘yes’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(function_day) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"var"</span> <span class="ot">=</span> var, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> sd, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"IQR"</span> <span class="ot">=</span> IQR), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  function_day mean_rented_bike_count median_rented_bike_count
  &lt;fct&gt;                         &lt;dbl&gt;                    &lt;dbl&gt;
1 No                               0                         0
2 Yes                            729.                      542
# ℹ 3 more variables: var_rented_bike_count &lt;dbl&gt;, sd_rented_bike_count &lt;dbl&gt;,
#   IQR_rented_bike_count &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This time, we will only look at functioning days of ‘yes’ where we summarize grouped by seasons and holiday variables. All four seasons have rented bike counts associated with them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasons, holiday) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(function_day <span class="sc">==</span> <span class="st">'Yes'</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"var"</span> <span class="ot">=</span> var, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> sd, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"IQR"</span> <span class="ot">=</span> IQR), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'seasons'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
# Groups:   seasons [4]
  seasons holiday    mean_rented_bike_count median_rented_bike_count
  &lt;fct&gt;   &lt;fct&gt;                       &lt;dbl&gt;                    &lt;dbl&gt;
1 Autumn  Holiday                      948.                     900 
2 Autumn  No Holiday                   923.                     852 
3 Spring  Holiday                      635.                     366.
4 Spring  No Holiday                   750.                     605 
5 Summer  Holiday                     1022.                     925 
6 Summer  No Holiday                  1034.                     904.
7 Winter  Holiday                      157.                     138 
8 Winter  No Holiday                   232.                     212 
# ℹ 3 more variables: var_rented_bike_count &lt;dbl&gt;, sd_rented_bike_count &lt;dbl&gt;,
#   IQR_rented_bike_count &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now, we’ll summarize across the hours so that each day has one observation associated with it. We are grouping by Date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(function_day <span class="sc">==</span> <span class="st">'Yes'</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 353 × 3
   date       mean_rented_bike_count median_rented_bike_count
   &lt;chr&gt;                       &lt;dbl&gt;                    &lt;dbl&gt;
 1 01/01/2018                   179.                    174. 
 2 01/02/2018                   224.                    238. 
 3 01/03/2018                   214.                    190. 
 4 01/04/2018                   724.                    662. 
 5 01/05/2018                  1118.                   1092  
 6 01/06/2018                  1330.                   1156  
 7 01/07/2018                   135.                     22.5
 8 01/08/2018                   863                     673  
 9 01/09/2018                  1084.                   1034. 
10 01/10/2018                  1163.                   1122. 
# ℹ 343 more rows</code></pre>
</div>
</div>
<p>Now let’s group across date, seasons, and holiday variables for the sums of rented bike count, rainfall, and snowfall and the averages of the weather variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new_bike_data <span class="ot">&lt;-</span> seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, seasons, holiday) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(rented_bike_count,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                     rainfall,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                     snowfall), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns=</span><span class="fu">list</span>(<span class="st">'sum'</span><span class="ot">=</span>sum), </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">c</span>(celcius_temp, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                     percent_humidity,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                     wind_speed,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                     visib,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                     dew_point_temp, </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                     solar_rad, </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                     rainfall,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                     snowfall), </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean), </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date', 'seasons'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>new_bike_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 14
# Groups:   date, seasons [365]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter  Holiday                     4290          0            0  
 2 2018-02-01 Winter  No Holiday                  5377          0           21.7
 3 2018-03-01 Spring  Holiday                     5132          2.5          0  
 4 2018-04-01 Spring  No Holiday                 17388          0            0  
 5 2018-05-01 Spring  Holiday                    26820          0            0  
 6 2018-06-01 Summer  No Holiday                 31928          0            0  
 7 2018-07-01 Summer  No Holiday                  3231         81            0  
 8 2018-08-01 Summer  No Holiday                 20712          0            0  
 9 2018-09-01 Autumn  No Holiday                 26010          0            0  
10 2018-10-01 Autumn  No Holiday                 27909          0            0  
# ℹ 355 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now let’s use this data to recreate those basic summary statistics and then create some plots to explore relationships.</p>
<p>First, we will create a contingency table of seasons and holiday variables. Most rented bike counts occurred on ‘not’ holidays. The highest count of rentals is in the summer for ‘not’ holidays and winter for holidays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>new_bike_data <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasons, holiday)<span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> holiday, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'seasons'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   seasons [4]
  seasons Holiday `No Holiday`
  &lt;fct&gt;     &lt;int&gt;        &lt;int&gt;
1 Autumn        5           86
2 Spring        3           89
3 Summer        2           90
4 Winter        8           82</code></pre>
</div>
</div>
<p>We can use psych’s describe() function again to get numeric summaries on this new data, like before.</p>
<p>I also defined the numeric variables in the data as num_vars for easier use later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(new_bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(newX[, i], ...): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(newX[, i], ...): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      vars   n     mean       sd   median  trimmed      mad
date                     1 365      NaN       NA       NA      NaN       NA
seasons*                 2 365     2.50     1.12     2.00     2.49     1.48
holiday*                 3 365     1.95     0.22     2.00     2.00     0.00
sum_rented_bike_count    4 365 16910.45 10258.64 17730.00 16859.32 14654.02
sum_rainfall             5 365     3.57    11.85     0.00     0.60     0.00
sum_snowfall             6 365     1.80     8.66     0.00     0.00     0.00
mean_celcius_temp        7 365    12.88    11.56    13.84    13.20    13.50
mean_percent_humidity    8 365    58.23    14.67    57.21    57.75    14.70
mean_wind_speed          9 365     1.72     0.60     1.64     1.66     0.50
mean_visib              10 365  1436.83   491.25  1557.75  1486.04   565.49
mean_dew_point_temp     11 365     4.07    12.81     5.01     4.67    14.39
mean_solar_rad          12 365     0.57     0.31     0.56     0.56     0.41
mean_rainfall           13 365     0.15     0.49     0.00     0.02     0.00
mean_snowfall           14 365     0.08     0.36     0.00     0.00     0.00
                         min      max    range  skew kurtosis     se
date                     Inf     -Inf     -Inf    NA       NA     NA
seasons*                1.00     4.00     3.00  0.00    -1.36   0.06
holiday*                1.00     2.00     1.00 -4.15    15.23   0.01
sum_rented_bike_count   0.00 36149.00 36149.00 -0.03    -1.39 536.96
sum_rainfall            0.00    95.50    95.50  4.85    26.25   0.62
sum_snowfall            0.00    78.70    78.70  5.94    37.97   0.45
mean_celcius_temp     -14.74    33.74    48.48 -0.24    -0.91   0.60
mean_percent_humidity  22.25    95.88    73.62  0.26    -0.28   0.77
mean_wind_speed         0.66     4.00     3.34  1.07     1.18   0.03
mean_visib            214.29  2000.00  1785.71 -0.63    -0.74  25.71
mean_dew_point_temp   -27.75    25.04    52.79 -0.32    -0.82   0.67
mean_solar_rad          0.03     1.22     1.19  0.18    -1.08   0.02
mean_rainfall           0.00     3.98     3.98  4.85    26.25   0.03
mean_snowfall           0.00     3.28     3.28  5.94    37.97   0.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> new_bike_data <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sum_rented_bike_count, sum_rainfall, sum_snowfall, mean_celcius_temp, mean_percent_humidity, mean_wind_speed, mean_visib, mean_dew_point_temp, mean_solar_rad, mean_rainfall, mean_snowfall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `date`, `seasons`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>num_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 13
# Groups:   date, seasons [365]
   date       seasons sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;                   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter                   4290          0            0  
 2 2018-02-01 Winter                   5377          0           21.7
 3 2018-03-01 Spring                   5132          2.5          0  
 4 2018-04-01 Spring                  17388          0            0  
 5 2018-05-01 Spring                  26820          0            0  
 6 2018-06-01 Summer                  31928          0            0  
 7 2018-07-01 Summer                   3231         81            0  
 8 2018-08-01 Summer                  20712          0            0  
 9 2018-09-01 Autumn                  26010          0            0  
10 2018-10-01 Autumn                  27909          0            0  
# ℹ 355 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now to plot… Let’s look at the rented bike count sums by date and holiday! Both the scatterplot and the overlapping holiday linear regression plots show an increase in the rental counts as the year goes on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>holiday)) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%B %d, %Y"</span>) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Date'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_rainfall, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_visib)) <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Rainfall and Mean Visibility in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Rainfall - mm'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s check where the x axis is mean snowfall and mean wind speed. The majority of bike rentals occur when there is no snowfall and low wind speed. There are a few dates with snowfall and rentals, but they mostly have lower wind speeds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_snowfall, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_wind_speed)) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Snowfall and Mean Wind Speed in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Rainfall - mm'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OOOh, a correlation matrix of the numeric variables we defined before.</p>
<p>As expected, mean rainfall and sum rainfall are very correlated, as well as mean snowfall and sum snowfall.</p>
<p>Mean Celcius Temp and Mean Dew Point Temp are also super correlated (0.96).</p>
<p>The most correlated variable with the Sum Rented Bike Count is Mean Celcius Temp. Let’s look at this and the next most correlated variable: solar radiation!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">correlate</span>(num_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `date`, and `seasons`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">shave</span>(cor_matrix)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rplot</span>(cor_matrix, <span class="at">print_cor =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.
ℹ The deprecated feature was likely used in the corrr package.
  Please report the issue at &lt;https://github.com/tidymodels/corrr/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is certainly a correlated relationship! The higher temperature has higher rental counts and higher solar radiation. Who would have thought?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_celcius_temp, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_solar_rad)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Temperature and Mean Solar Radiation </span><span class="sc">\n</span><span class="st">in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Temperature in Celcius'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Makes sense, because dew point temperature looks to be correlated as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_celcius_temp, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_dew_point_temp)) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Temperature and Mean Dew Point Temperature </span><span class="sc">\n</span><span class="st">in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Temperature in Celcius'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="split-the-data" class="level1">
<h1>Split the Data</h1>
<p>Here, we can use functions from tidymodels to split the data into a training and test set (75/25 split). By using the strata argument, we can stratify the split on the seasons variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.10     ✔ rsample      1.3.1 
✔ dials        1.4.2      ✔ tailor       0.1.0 
✔ infer        1.0.9      ✔ tune         2.0.1 
✔ modeldata    1.5.1      ✔ workflows    1.3.0 
✔ parsnip      1.3.3      ✔ workflowsets 1.1.1 
✔ recipes      1.3.1      ✔ yardstick    1.3.2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ psych::%+%()      masks ggplot2::%+%()
✖ scales::alpha()   masks psych::alpha(), ggplot2::alpha()
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>seoul_data <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(new_bike_data, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata=</span>seasons)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>seoul_train <span class="ot">&lt;-</span> <span class="fu">training</span>(seoul_data)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>seoul_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 273 × 14
# Groups:   date, seasons [273]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-09-01 Autumn  No Holiday                 26010          0              0
 2 2018-09-02 Autumn  No Holiday                 26881          0              0
 3 2018-10-02 Autumn  No Holiday                     0          0              0
 4 2018-11-02 Autumn  No Holiday                 24077          0              0
 5 2018-09-03 Autumn  No Holiday                 10802         34.5            0
 6 2018-10-03 Autumn  Holiday                    30349          0              0
 7 2018-11-03 Autumn  No Holiday                     0          0              0
 8 2018-09-04 Autumn  No Holiday                 29529          0              0
 9 2018-10-04 Autumn  No Holiday                     0          0              0
10 2018-11-04 Autumn  No Holiday                 20471          0              0
# ℹ 263 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>seoul_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(seoul_data)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>seoul_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92 × 14
# Groups:   date, seasons [92]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter  Holiday                     4290          0            0  
 2 2018-10-01 Autumn  No Holiday                 27909          0            0  
 3 2018-11-01 Autumn  No Holiday                 22964          0            0  
 4 2018-03-02 Spring  No Holiday                  8433          0            0  
 5 2018-05-02 Spring  No Holiday                  7448         12            0  
 6 2018-06-02 Summer  No Holiday                 30693          0            0  
 7 2018-02-03 Winter  No Holiday                  3290          0.5          2.2
 8 2018-03-03 Spring  No Holiday                 12191          0            0  
 9 2018-01-04 Winter  No Holiday                  6453          0            0  
10 2018-07-04 Summer  No Holiday                 31781          0            0  
# ℹ 82 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now we can look further into the training set and create a 10 fold CV split.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(seoul_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 273</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>size_fold <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(seoul_train)<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>size_fold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>random_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(seoul_train), <span class="at">size =</span> <span class="fu">nrow</span>(seoul_train), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#see the random reordering</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(random_indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 183 226  79  12 119 170</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a list to save our folds in</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#now cycle through our random indices vector and take the appropriate observations to each fold</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#you may want to set i to 1 and run the arguments to from and to in the seq() function</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#change i to 2 and do the same thing to see how this works</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    fold_index <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> (i<span class="dv">-1</span>)<span class="sc">*</span>size_fold <span class="sc">+</span><span class="dv">1</span>, <span class="at">to =</span> i<span class="sc">*</span>size_fold, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    folds[[i]] <span class="ot">&lt;-</span> seoul_train[random_indices[fold_index], ]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co">#for i = 10 we need to have 1 more observation </span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    fold_index <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> (i<span class="dv">-1</span>)<span class="sc">*</span>size_fold <span class="sc">+</span><span class="dv">1</span>, <span class="at">to =</span> <span class="fu">length</span>(random_indices), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    folds[[i]] <span class="ot">&lt;-</span> seoul_train[random_indices[fold_index], ]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>folds[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 14
# Groups:   date, seasons [27]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-06-22 Summer  No Holiday                 34079          0            0  
 2 2018-02-09 Winter  No Holiday                  6268          0            0  
 3 2018-05-05 Spring  No Holiday                 25353          0            0  
 4 2018-11-05 Autumn  No Holiday                 23472          0            0  
 5 2018-04-22 Spring  No Holiday                  6852         13.5          0  
 6 2018-07-15 Summer  No Holiday                 22790          0            0  
 7 2017-12-11 Winter  No Holiday                  5848          0            0  
 8 2018-01-22 Winter  No Holiday                  4503          3.3          6.2
 9 2018-02-23 Winter  No Holiday                  5797          4.1         44.7
10 2018-01-07 Winter  No Holiday                  4714          0            0  
# ℹ 17 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>folds[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 14
# Groups:   date, seasons [27]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-05-23 Spring  No Holiday                 27674         10              0
 2 2018-09-29 Autumn  No Holiday                 31447          0              0
 3 2018-09-22 Autumn  No Holiday                 26398          6.5            0
 4 2018-06-06 Summer  Holiday                    30498          0              0
 5 2018-08-24 Summer  No Holiday                 11658          8              0
 6 2018-04-08 Spring  No Holiday                  6666          3              0
 7 2018-01-17 Winter  No Holiday                  6292          0              0
 8 2018-03-13 Spring  No Holiday                 15963          0              0
 9 2018-05-22 Spring  Holiday                    13790          9              0
10 2018-01-11 Winter  No Holiday                  4017          0              0
# ℹ 17 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#training data</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>train_list <span class="ot">&lt;-</span> folds</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(train_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
</section>
<section id="fitting-mlr-models" class="level1">
<h1>Fitting MLR Models</h1>
<p>First, let’s create some recipes for our different models. For the 1st recipe: we’re ignoring the date variable for modeling (day_type) and removing it after we create a weekday/weekend (factor) variable. We can use step_normalize to standardize the numeric variables since their scales are pretty different and create dummy variables for the seasons, holiday, and our new day type variable using step_dummy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_1 <span class="ot">&lt;-</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
</div>
<p>For the 2nd recipe we are beginning with the same steps as before, but also adding in interactions between seasons and holiday, seasons and temp, temp and rainfall.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_2 <span class="ot">&lt;-</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)<span class="sc">|&gt;</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">step_interact</span>(</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="sc">~</span> (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span><span class="st">`</span><span class="at">holiday_No.Holiday</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>           (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span>mean_celcius_temp <span class="sc">+</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>           mean_celcius_temp<span class="sc">:</span>mean_rainfall</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: ...</code></pre>
</div>
</div>
<p>For the 3rd recipe: we are adding in quadratic terms for each numeric predictor using step_poly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_3 <span class="ot">&lt;-</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)<span class="sc">|&gt;</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="sc">~</span> (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span><span class="st">`</span><span class="at">holiday_No.Holiday</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>           (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span>mean_celcius_temp <span class="sc">+</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>           mean_celcius_temp<span class="sc">:</span>mean_rainfall</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>)<span class="sc">|&gt;</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(sum_rainfall, sum_snowfall, mean_celcius_temp, mean_percent_humidity, </span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>          mean_wind_speed, mean_visib, mean_dew_point_temp, mean_solar_rad, </span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>          mean_rainfall, mean_snowfall, <span class="at">degree =</span> <span class="dv">2</span>) </span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Polynomial expansion on: sum_rainfall sum_snowfall, ...</code></pre>
</div>
</div>
<p>Now we will set up our linear model fit to use the “lm” engine as seoul_mod.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>seoul_mod <span class="ot">&lt;-</span><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'lm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use this to create a workflow using the recipe and this model (for all three models).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl1 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl2 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_2) <span class="sc">|&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
5 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()
• step_interact()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl3 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_3) <span class="sc">|&gt;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
6 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()
• step_interact()
• step_poly()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
<p>Let’s check out the fits on the training data using the three different workflows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>seoul_fit1 <span class="ot">&lt;-</span> seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>seoul_fit1 <span class="sc">|&gt;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)            16928.       343.   49.3     1.18e-133
 2 sum_rainfall           -1915.       459.   -4.17    4.12e-  5
 3 sum_snowfall            -160.       369.   -0.434   6.65e-  1
 4 mean_celcius_temp       3183.      6278.    0.507   6.13e-  1
 5 mean_percent_humidity   -355.      2348.   -0.151   8.80e-  1
 6 mean_wind_speed        -1047.       401.   -2.61    9.53e-  3
 7 mean_visib                46.5      514.    0.0904  9.28e-  1
 8 mean_dew_point_temp      318.      7395.    0.0430  9.66e-  1
 9 mean_solar_rad          3281.       612.    5.36    1.80e-  7
10 mean_rainfall             NA         NA    NA      NA        
11 mean_snowfall             NA         NA    NA      NA        
12 seasons_Spring         -1397.       499.   -2.80    5.52e-  3
13 seasons_Summer          -588.       572.   -1.03    3.05e-  1
14 seasons_Winter         -2950.       680.   -4.34    2.03e-  5
15 holiday_No.Holiday       526.       349.    1.51    1.33e-  1
16 day_type_Weekend       -1046.       349.   -3.00    3.00e-  3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>seoul_fit2 <span class="ot">&lt;-</span> seoul_wfl2 <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>seoul_fit2 <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 5
   term                  estimate std.error statistic   p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)            22169.       946.    23.4    3.06e-65
 2 sum_rainfall           -2699.       725.    -3.72   2.42e- 4
 3 sum_snowfall             -58.8      332.    -0.177  8.60e- 1
 4 mean_celcius_temp        768.      5939.     0.129  8.97e- 1
 5 mean_percent_humidity   -870.      2226.    -0.391  6.96e- 1
 6 mean_wind_speed         -811.       360.    -2.25   2.52e- 2
 7 mean_visib               504.       484.     1.04   2.98e- 1
 8 mean_dew_point_temp      946.      6966.     0.136  8.92e- 1
 9 mean_solar_rad          2324.       559.     4.16   4.37e- 5
10 mean_rainfall             NA         NA     NA     NA       
# ℹ 13 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>seoul_fit3 <span class="ot">&lt;-</span> seoul_wfl3 <span class="sc">|&gt;</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>seoul_fit3<span class="sc">|&gt;</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 5
   term                                estimate std.error statistic  p.value
   &lt;chr&gt;                                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)                          29497.      2750.    10.7   3.07e-22
 2 seasons_Spring                        -604.       465.    -1.30  1.94e- 1
 3 seasons_Summer                       12225.      1702.     7.18  8.19e-12
 4 seasons_Winter                        1083.      1836.     0.590 5.56e- 1
 5 holiday_No.Holiday                     525.       333.     1.58  1.16e- 1
 6 day_type_Weekend                     -1060.       314.    -3.38  8.55e- 4
 7 seasons_Spring_x_holiday_No.Holiday    173.       412.     0.420 6.75e- 1
 8 seasons_Summer_x_holiday_No.Holiday    178.       439.     0.405 6.86e- 1
 9 seasons_Winter_x_holiday_No.Holiday     56.4      338.     0.167 8.68e- 1
10 seasons_Spring_x_mean_celcius_temp    3460.       877.     3.95  1.03e- 4
# ℹ 23 more rows</code></pre>
</div>
</div>
<p>We can fit the models using 10 fold CV via fit_resamples() and look at the training set CV error to choose a best model—looks like the model 1!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>seoul_10_fold <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(seoul_train, <span class="dv">10</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>cv_fits1 <span class="ot">&lt;-</span> seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x8</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>cv_fits2 <span class="ot">&lt;-</span> seoul_wfl2 <span class="sc">|&gt;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>cv_fits3 <span class="ot">&lt;-</span> seoul_wfl3 <span class="sc">|&gt;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cv_fits1 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>),</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>      cv_fits2 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>),</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>      cv_fits3 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model=</span> <span class="fu">c</span>(<span class="st">'Model 1'</span>, <span class="st">'Model 2'</span>, <span class="st">'Model 3'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, mean, n, std_err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Model    mean     n std_err
  &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 Model 1 5744.    10    260.
2 Model 2 5078.    10    249.
3 Model 3 5032.    10    260.</code></pre>
</div>
</div>
<p>Model 1 is the ‘best’ model, so let’s fit the model to the entire training data set. The 2x4 tibble is the computed RMSE (and RSQ) metric on the test set.</p>
<p>The final model is fit on the entire training set and its coefficient table is the final displayed tibble (using extract_fit_parsnip() and tidy()).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(seoul_wfl1, <span class="at">split=</span>seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(best_mod_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6136. pre0_mod0_post0
2 mae     standard       4156. pre0_mod0_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)            16928.       343.   49.3     1.18e-133
 2 sum_rainfall           -1915.       459.   -4.17    4.12e-  5
 3 sum_snowfall            -160.       369.   -0.434   6.65e-  1
 4 mean_celcius_temp       3183.      6278.    0.507   6.13e-  1
 5 mean_percent_humidity   -355.      2348.   -0.151   8.80e-  1
 6 mean_wind_speed        -1047.       401.   -2.61    9.53e-  3
 7 mean_visib                46.5      514.    0.0904  9.28e-  1
 8 mean_dew_point_temp      318.      7395.    0.0430  9.66e-  1
 9 mean_solar_rad          3281.       612.    5.36    1.80e-  7
10 mean_rainfall             NA         NA    NA      NA        
11 mean_snowfall             NA         NA    NA      NA        
12 seasons_Spring         -1397.       499.   -2.80    5.52e-  3
13 seasons_Summer          -588.       572.   -1.03    3.05e-  1
14 seasons_Winter         -2950.       680.   -4.34    2.03e-  5
15 holiday_No.Holiday       526.       349.    1.51    1.33e-  1
16 day_type_Weekend       -1046.       349.   -3.00    3.00e-  3</code></pre>
</div>
</div>
<p>I would be interested to learn more about why the p value of mean_solar_rad is so small, followed by rainfall and wind speed.</p>
<p>Overall, interesting assignment!</p>
</section>
<section id="homework-9-begins-here" class="level1">
<h1>Homework 9 Begins Here</h1>
<p>We will use the first recipe (seoul_train_rec_1) from homework 8 with no quadratics nor interactions to tune our <strong>LASSO Model</strong>. Let’s use the glmnet engine and the linear_reg function with a mixture of 1 (specifies LASSO instead of Elastic Net) and an opportunity to tune the penalty with a resampling method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>LASSO_Seoul <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'glmnet'</span>)</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(LASSO_Seoul)</span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a>LASSO_wkf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Main Arguments:
  penalty = tune()
  mixture = 1

Computational engine: glmnet </code></pre>
</div>
</div>
<p>Now, we can great a grid that tunes based on the resamples of the CV-10-fold with 200 levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>LASSO_grid <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold, </span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">200</span>),</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s plot these grid results with the RMSE metric… Looks like all the RMSE values are the same!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>LASSO_grid <span class="sc">|&gt;</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>) <span class="sc">|&gt;</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">color=</span>.metric)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'LASSO Grid results for Means associated with Penalty Options'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s pull out the ‘best’ model using select_best() by RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>lowest_rmse_LASSO <span class="ot">&lt;-</span> LASSO_grid <span class="sc">|&gt;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>lowest_rmse_LASSO</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
       penalty .config          
         &lt;dbl&gt; &lt;chr&gt;            
1 0.0000000001 pre0_mod001_post0</code></pre>
</div>
</div>
<p>Now we can fit that ‘best’ LASSO model on the entire training set, seoul_train. finalize_workflow() has captured the tuned model we defined before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lowest_rmse_LASSO) <span class="sc">|&gt;</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(LASSO_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   term                  estimate      penalty
   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;
 1 (Intercept)            16928.  0.0000000001
 2 sum_rainfall           -1910.  0.0000000001
 3 sum_snowfall            -156.  0.0000000001
 4 mean_celcius_temp       3387.  0.0000000001
 5 mean_percent_humidity   -226.  0.0000000001
 6 mean_wind_speed        -1047.  0.0000000001
 7 mean_visib                65.8 0.0000000001
 8 mean_dew_point_temp        0   0.0000000001
 9 mean_solar_rad          3277.  0.0000000001
10 mean_rainfall            -12.5 0.0000000001
11 mean_snowfall              0   0.0000000001
12 seasons_Spring         -1354.  0.0000000001
13 seasons_Summer          -520.  0.0000000001
14 seasons_Winter         -2943.  0.0000000001
15 holiday_No.Holiday       509.  0.0000000001
16 day_type_Weekend       -1033.  0.0000000001</code></pre>
</div>
</div>
<p>Now we can compare the chosen model on the test set using last_fit() and see the differences between our MLR model from Homework 8 and this LASSO model. It appears that the MLR Model outperforms the LASSO Model slightly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data) <span class="sc">|&gt;</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1
There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    6136.    pre0_mod0_post0
2 rsq     standard       0.687 pre0_mod0_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lowest_rmse_LASSO) <span class="sc">|&gt;</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data) <span class="sc">|&gt;</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    6133.    pre0_mod0_post0
2 rsq     standard       0.688 pre0_mod0_post0</code></pre>
</div>
</div>
<p>Let’s check out the RMSE of the model when predicting on a new set of data: the test data. That’s the same RMSE as on the combined data. Let’s confirm and ‘finalize’ that model using finalize_workflow and collect metrics on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="sc">|&gt;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(seoul_test) <span class="sc">|&gt;</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">|&gt;</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse_vec</span>(<span class="at">truth =</span> seoul_test<span class="sc">$</span>sum_rented_bike_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6133.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(<span class="fu">tibble</span>(<span class="at">penalty =</span> lowest_rmse_LASSO<span class="sc">$</span>penalty)) </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>LASSO_model <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(LASSO_wkf, <span class="at">split=</span>seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>LASSO_model<span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6133. pre0_mod0_post0
2 mae     standard       4163. pre0_mod0_post0</code></pre>
</div>
</div>
<p>To tuning a <strong>Regression Tree</strong> model…</p>
<p>We can use decision_tree from the tree package this time, with the rpart engine specified for regression. Let’s tune for the tree_depth and cost_complexity and follow similar steps to the LASSO model, using the recipe from homework 8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">20</span>,</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>tree_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_mod)</span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a>temp_tree <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span> </span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae)) <span class="co">#uses defaults from dials</span></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>temp_tree <span class="sc">|&gt;</span> </span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          5 mae     standard   3977.    10    236. pre0_mod01…
 2    0.0000000001          5 rmse    standard   5844.    10    407. pre0_mod01…
 3    0.000000001          11 mae     standard   4053.    10    218. pre0_mod02…
 4    0.000000001          11 rmse    standard   6063.    10    399. pre0_mod02…
 5    0.00000001            1 mae     standard   5744.    10    300. pre0_mod03…
 6    0.00000001            1 rmse    standard   7583.    10    375. pre0_mod03…
 7    0.0000001             7 mae     standard   4053.    10    216. pre0_mod04…
 8    0.0000001             7 rmse    standard   6067.    10    398. pre0_mod04…
 9    0.000001             13 mae     standard   4053.    10    218. pre0_mod05…
10    0.000001             13 rmse    standard   6063.    10    399. pre0_mod05…
11    0.00001               2 mae     standard   4732.    10    310. pre0_mod06…
12    0.00001               2 rmse    standard   6529.    10    451. pre0_mod06…
13    0.0001                8 mae     standard   4053.    10    218. pre0_mod07…
14    0.0001                8 rmse    standard   6063.    10    399. pre0_mod07…
15    0.001                15 mae     standard   4054.    10    213. pre0_mod08…
16    0.001                15 rmse    standard   6064.    10    399. pre0_mod08…
17    0.01                  4 mae     standard   4303.    10    221. pre0_mod09…
18    0.01                  4 rmse    standard   6177.    10    413. pre0_mod09…
19    0.1                  10 mae     standard   5141.    10    360. pre0_mod10…
20    0.1                  10 rmse    standard   6865.    10    486. pre0_mod10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span> </span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> tree_grid,</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          1 mae     standard   5744.    10    300. pre0_mod01…
 2    0.0000000001          1 rmse    standard   7583.    10    375. pre0_mod01…
 3    0.0000000001          4 mae     standard   4237.    10    209. pre0_mod02…
 4    0.0000000001          4 rmse    standard   6163.    10    410. pre0_mod02…
 5    0.0000000001          8 mae     standard   4053.    10    218. pre0_mod03…
 6    0.0000000001          8 rmse    standard   6063.    10    399. pre0_mod03…
 7    0.0000000001         11 mae     standard   4053.    10    218. pre0_mod04…
 8    0.0000000001         11 rmse    standard   6063.    10    399. pre0_mod04…
 9    0.0000000001         15 mae     standard   4053.    10    218. pre0_mod05…
10    0.0000000001         15 rmse    standard   6063.    10    399. pre0_mod05…
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Our best tree fit selected with the RMSE in mind has a cost complexity of 0.001 and a tree depth of 4. We can finalize that workflow and plot it to a tree plot! So fun.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="sc">|&gt;</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"rmse"</span>) <span class="sc">|&gt;</span></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          8 rmse    standard   6063.    10    399. pre0_mod03…
 2    0.0000000001         11 rmse    standard   6063.    10    399. pre0_mod04…
 3    0.0000000001         15 rmse    standard   6063.    10    399. pre0_mod05…
 4    0.000000001           8 rmse    standard   6063.    10    399. pre0_mod08…
 5    0.000000001          11 rmse    standard   6063.    10    399. pre0_mod09…
 6    0.000000001          15 rmse    standard   6063.    10    399. pre0_mod10…
 7    0.00000001            8 rmse    standard   6063.    10    399. pre0_mod13…
 8    0.00000001           11 rmse    standard   6063.    10    399. pre0_mod14…
 9    0.00000001           15 rmse    standard   6063.    10    399. pre0_mod15…
10    0.0000001             8 rmse    standard   6063.    10    399. pre0_mod18…
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>tree_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tree_fits, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>tree_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  cost_complexity tree_depth .config         
            &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;           
1    0.0000000001          8 pre0_mod03_post0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>tree_final_wkf <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(tree_best_params)</span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="ot">&lt;-</span> tree_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a>tree_final_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits           id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;           &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [273/92]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6696. pre0_mod0_post0
2 mae     standard       4087. pre0_mod0_post0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>tree_final_model <span class="ot">&lt;-</span> <span class="fu">extract_workflow</span>(tree_final_fit) </span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>tree_final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: decision_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
n= 273 

node), split, n, deviance, yval
      * denotes terminal node

  1) root 273 27472340000 16927.640  
    2) mean_celcius_temp&lt; -0.5859426 84  1127977000  6752.036  
      4) seasons_Winter&gt;=0.5904959 67   238534200  5442.343  
        8) mean_dew_point_temp&lt; -1.673243 17    20798620  3987.412 *
        9) mean_dew_point_temp&gt;=-1.673243 50   169514200  5937.020  
         18) sum_rainfall&gt;=-0.2787387 10    20609780  4038.200 *
         19) sum_rainfall&lt; -0.2787387 40   103835500  6411.725  
           38) mean_celcius_temp&lt; -1.053983 28    71419880  5912.750  
             76) mean_celcius_temp&gt;=-1.305311 13    34695890  5331.923 *
             77) mean_celcius_temp&lt; -1.305311 15    28537390  6416.133 *
           39) mean_celcius_temp&gt;=-1.053983 12     9177846  7576.000 *
      5) seasons_Winter&lt; 0.5904959 17   321579800 11913.760 *
    3) mean_celcius_temp&gt;=-0.5859426 189 13781160000 21450.130  
      6) mean_solar_rad&lt; -0.5633404 38  1995523000 12356.390  
       12) sum_rainfall&gt;=1.97123 10    84244810  5846.800 *
       13) sum_rainfall&lt; 1.97123 28  1336191000 14681.250  
         26) mean_dew_point_temp&lt; 0.3728727 11   572285100  9223.909 *
         27) mean_dew_point_temp&gt;=0.3728727 17   224315900 18212.470 *
      7) mean_solar_rad&gt;=-0.5633404 151  7852381000 23738.620  
       14) mean_celcius_temp&lt; 0.5336447 73  4531017000 20328.380  
         28) mean_percent_humidity&gt;=-0.3024604 41  3190592000 17742.070  
           56) mean_wind_speed&gt;=-0.857452 29  2350263000 15218.280  
            112) mean_solar_rad&gt;=0.3647939 12  1209092000 12333.330 *
            113) mean_solar_rad&lt; 0.3647939 17   970795800 17254.710 *
           57) mean_wind_speed&lt; -0.857452 12   209213100 23841.250 *
         29) mean_percent_humidity&lt; -0.3024604 32   714794300 23642.090  
           58) mean_dew_point_temp&lt; -0.3984703 10   120859700 19066.100 *
           59) mean_dew_point_temp&gt;=-0.3984703 22   289356800 25722.090  
            118) mean_wind_speed&gt;=0.02517615 9   134397900 23811.000 *
            119) mean_wind_speed&lt; 0.02517615 13    99332080 27045.150 *
       15) mean_celcius_temp&gt;=0.5336447 78  1677851000 26930.240  
         30) mean_celcius_temp&gt;=1.342559 24   193245700 21766.080  
           60) day_type_Weekend&gt;=0.4834446 7    11848520 18760.140 *
           61) day_type_Weekend&lt; 0.4834446 17    92103420 23003.820 *
         31) mean_celcius_temp&lt; 1.342559 54   560095100 29225.430  
           62) mean_dew_point_temp&gt;=0.9007591 19   164380100 27097.680 *
           63) mean_dew_point_temp&lt; 0.9007591 35   263000900 30380.490  
            126) mean_wind_speed&lt; 0.2500282 25   202867600 29749.280  
              252) day_type_Weekend&gt;=0.4834446 10    39188060 28611.900 *
              253) day_type_Weekend&lt; 0.4834446 15   142119000 30507.530 *
            127) mean_wind_speed&gt;=0.2500282 10    25271520 31958.500 *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>tree_final_model <span class="sc">|&gt;</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>(<span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ooh La La… a tuned <strong>Bagged Tree</strong> model.</p>
<p>This time, we use bag_tree from the baguette library and do basically the same things as for the tree model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(baguette)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>bag_mod <span class="ot">&lt;-</span> <span class="fu">bag_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">20</span>,</span>
<span id="cb187-4"><a href="#cb187-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb187-5"><a href="#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb187-6"><a href="#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb187-7"><a href="#cb187-7" aria-hidden="true" tabindex="-1"></a>bag_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb187-8"><a href="#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb187-9"><a href="#cb187-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bag_mod)</span>
<span id="cb187-10"><a href="#cb187-10" aria-hidden="true" tabindex="-1"></a>temp_bag <span class="ot">&lt;-</span> bag_wkf <span class="sc">|&gt;</span> </span>
<span id="cb187-11"><a href="#cb187-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb187-12"><a href="#cb187-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae)) <span class="co">#uses defaults from dials</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'butcher':
  method                 from    
  as.character.dev_topic generics</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>temp_bag <span class="sc">|&gt;</span> </span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          5 mae     standard   3679.    10    186. pre0_mod01…
 2    0.0000000001          5 rmse    standard   5361.    10    360. pre0_mod01…
 3    0.000000001          11 mae     standard   3410.    10    163. pre0_mod02…
 4    0.000000001          11 rmse    standard   5069.    10    308. pre0_mod02…
 5    0.00000001            1 mae     standard   5452.    10    251. pre0_mod03…
 6    0.00000001            1 rmse    standard   7041.    10    340. pre0_mod03…
 7    0.0000001             7 mae     standard   3461.    10    151. pre0_mod04…
 8    0.0000001             7 rmse    standard   5232.    10    322. pre0_mod04…
 9    0.000001             13 mae     standard   3592.    10    139. pre0_mod05…
10    0.000001             13 rmse    standard   5172.    10    287. pre0_mod05…
11    0.00001               2 mae     standard   4355.    10    282. pre0_mod06…
12    0.00001               2 rmse    standard   6028.    10    397. pre0_mod06…
13    0.0001                8 mae     standard   3564.    10    154. pre0_mod07…
14    0.0001                8 rmse    standard   5338.    10    326. pre0_mod07…
15    0.001                15 mae     standard   3435.    10    155. pre0_mod08…
16    0.001                15 rmse    standard   5136.    10    310. pre0_mod08…
17    0.01                  4 mae     standard   3795.    10    148. pre0_mod09…
18    0.01                  4 rmse    standard   5380.    10    300. pre0_mod09…
19    0.1                  10 mae     standard   4825.    10    236. pre0_mod10…
20    0.1                  10 rmse    standard   6358.    10    353. pre0_mod10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>bag_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="ot">&lt;-</span> bag_wkf <span class="sc">|&gt;</span> </span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> bag_grid,</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          1 mae     standard   5530.    10    220. pre0_mod01…
 2    0.0000000001          1 rmse    standard   7183.    10    294. pre0_mod01…
 3    0.0000000001          4 mae     standard   3715.    10    145. pre0_mod02…
 4    0.0000000001          4 rmse    standard   5236.    10    313. pre0_mod02…
 5    0.0000000001          8 mae     standard   3401.    10    151. pre0_mod03…
 6    0.0000000001          8 rmse    standard   5084.    10    331. pre0_mod03…
 7    0.0000000001         11 mae     standard   3465.    10    163. pre0_mod04…
 8    0.0000000001         11 rmse    standard   5207.    10    319. pre0_mod04…
 9    0.0000000001         15 mae     standard   3479.    10    125. pre0_mod05…
10    0.0000000001         15 rmse    standard   5240.    10    263. pre0_mod05…
# ℹ 90 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="sc">|&gt;</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.metric == "rmse") |&gt;</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          8 mae     standard   3401.    10    151. pre0_mod03…
 2    0.0000001            15 mae     standard   3411.    10    152. pre0_mod20…
 3    0.000001              8 mae     standard   3417.    10    171. pre0_mod23…
 4    0.000000001          11 mae     standard   3432.    10    154. pre0_mod09…
 5    0.0001               15 mae     standard   3445.    10    106. pre0_mod35…
 6    0.000000001           8 mae     standard   3449.    10    158. pre0_mod08…
 7    0.001                15 mae     standard   3452.    10    114. pre0_mod40…
 8    0.0000001             8 mae     standard   3455.    10    156. pre0_mod18…
 9    0.00001              11 mae     standard   3457.    10    177. pre0_mod29…
10    0.000001             11 mae     standard   3460.    10    154. pre0_mod24…
# ℹ 90 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>bag_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(bag_fits, <span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>bag_final_wkf <span class="ot">&lt;-</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  bag_wkf <span class="sc">|&gt;</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(bag_best_params)</span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>bag_final_fit <span class="ot">&lt;-</span> bag_final_wkf <span class="sc">|&gt;</span> </span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>bag_final_fit<span class="sc">$</span>.metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       5982. pre0_mod0_post0
2 mae     standard       3630. pre0_mod0_post0</code></pre>
</div>
</div>
<p>Finally, a tuned Random Forest model: it uses the library ranger and rand_forest to tune mtry and trees. Let’s check out the comparisons between the models below to learn more!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>rand_for_mod <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'ranger'</span>, <span class="at">importance=</span><span class="st">'impurity'</span>) <span class="sc">|&gt;</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">'regression'</span>)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>rand_for_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rand_for_mod)</span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>temp_rand_for <span class="ot">&lt;-</span> rand_for_wkf<span class="sc">|&gt;</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid=</span><span class="dv">7</span>,</span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>i Creating pre-processing data to finalize 1 unknown parameter: "mtry"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>temp_rand_for <span class="sc">|&gt;</span><span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1     1  1333 mae     standard   4999.    10    234. pre0_mod1_post0
 2     1  1333 rmse    standard   6243.    10    278. pre0_mod1_post0
 3     3   334 mae     standard   3534.    10    146. pre0_mod2_post0
 4     3   334 rmse    standard   5186.    10    279. pre0_mod2_post0
 5     5  2000 mae     standard   3401.    10    144. pre0_mod3_post0
 6     5  2000 rmse    standard   5114.    10    281. pre0_mod3_post0
 7     8  1000 mae     standard   3352.    10    149. pre0_mod4_post0
 8     8  1000 rmse    standard   5145.    10    290. pre0_mod4_post0
 9    10     1 mae     standard   4620.    10    311. pre0_mod5_post0
10    10     1 rmse    standard   6841.    10    553. pre0_mod5_post0
11    12  1666 mae     standard   3332.    10    132. pre0_mod6_post0
12    12  1666 rmse    standard   5182.    10    283. pre0_mod6_post0
13    15   667 mae     standard   3311.    10    129. pre0_mod7_post0
14    15   667 rmse    standard   5206.    10    293. pre0_mod7_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>rand_for_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">mtry</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(seoul_train) <span class="sc">-</span> <span class="dv">1</span>)), <span class="fu">trees</span>())</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="ot">&lt;-</span> rand_for_wkf <span class="sc">|&gt;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold, <span class="at">grid=</span>rand_for_grid,</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1     1     1 mae     standard   6470.    10    410. pre0_mod1_post0
 2     1     1 rmse    standard   8157.    10    401. pre0_mod1_post0
 3     1  1000 mae     standard   5031.    10    239. pre0_mod2_post0
 4     1  1000 rmse    standard   6267.    10    280. pre0_mod2_post0
 5     1  2000 mae     standard   4997.    10    231. pre0_mod3_post0
 6     1  2000 rmse    standard   6245.    10    279. pre0_mod3_post0
 7     7     1 mae     standard   4913.    10    243. pre0_mod4_post0
 8     7     1 rmse    standard   7565.    10    404. pre0_mod4_post0
 9     7  1000 mae     standard   3339.    10    131. pre0_mod5_post0
10     7  1000 rmse    standard   5118.    10    270. pre0_mod5_post0
11     7  2000 mae     standard   3329.    10    136. pre0_mod6_post0
12     7  2000 rmse    standard   5102.    10    277. pre0_mod6_post0
13    13     1 mae     standard   4361.    10    297. pre0_mod7_post0
14    13     1 rmse    standard   6542.    10    565. pre0_mod7_post0
15    13  1000 mae     standard   3321.    10    130. pre0_mod8_post0
16    13  1000 rmse    standard   5174.    10    285. pre0_mod8_post0
17    13  2000 mae     standard   3312.    10    128. pre0_mod9_post0
18    13  2000 rmse    standard   5175.    10    290. pre0_mod9_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="sc">|&gt;</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.metric == 'rmse') |&gt;</span></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1    13  2000 mae     standard   3312.    10    128. pre0_mod9_post0
 2    13  1000 mae     standard   3321.    10    130. pre0_mod8_post0
 3     7  2000 mae     standard   3329.    10    136. pre0_mod6_post0
 4     7  1000 mae     standard   3339.    10    131. pre0_mod5_post0
 5    13     1 mae     standard   4361.    10    297. pre0_mod7_post0
 6     7     1 mae     standard   4913.    10    243. pre0_mod4_post0
 7     1  2000 mae     standard   4997.    10    231. pre0_mod3_post0
 8     1  1000 mae     standard   5031.    10    239. pre0_mod2_post0
 9     7  2000 rmse    standard   5102.    10    277. pre0_mod6_post0
10     7  1000 rmse    standard   5118.    10    270. pre0_mod5_post0
11    13  1000 rmse    standard   5174.    10    285. pre0_mod8_post0
12    13  2000 rmse    standard   5175.    10    290. pre0_mod9_post0
13     1  2000 rmse    standard   6245.    10    279. pre0_mod3_post0
14     1  1000 rmse    standard   6267.    10    280. pre0_mod2_post0
15     1     1 mae     standard   6470.    10    410. pre0_mod1_post0
16    13     1 rmse    standard   6542.    10    565. pre0_mod7_post0
17     7     1 rmse    standard   7565.    10    404. pre0_mod4_post0
18     1     1 rmse    standard   8157.    10    401. pre0_mod1_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>rand_for_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rand_for_fits, <span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>rand_for_final_wkf <span class="ot">&lt;-</span> rand_for_wkf <span class="sc">|&gt;</span><span class="fu">finalize_workflow</span>(rand_for_best_params)</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>rand_for_final_fit <span class="ot">&lt;-</span> rand_for_final_wkf <span class="sc">|&gt;</span> <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each of these models are fit and tuned on the training set. The best model from each family of models is then fit it to the entire training data set to see how it predicts on the test set.</p>
<p>All final model’s RMSE and MAE are shown in the table below. The Random Forest model has the lowest RMSE and MAE, which would make it my choice for the ‘best’ model for predicting the bike rentals in Seoul. The second ‘best’ model would be the Bagged Tree model, with the closest RMSE and MAE values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb206-2"><a href="#cb206-2" aria-hidden="true" tabindex="-1"></a>   best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb206-3"><a href="#cb206-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> </span>
<span id="cb206-4"><a href="#cb206-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"MLR"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>), </span>
<span id="cb206-5"><a href="#cb206-5" aria-hidden="true" tabindex="-1"></a>  LASSO_model <span class="sc">|&gt;</span></span>
<span id="cb206-6"><a href="#cb206-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb206-7"><a href="#cb206-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"LASSO"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb206-8"><a href="#cb206-8" aria-hidden="true" tabindex="-1"></a>  tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb206-9"><a href="#cb206-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb206-10"><a href="#cb206-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"TREE"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb206-11"><a href="#cb206-11" aria-hidden="true" tabindex="-1"></a>  bag_final_fit <span class="sc">|&gt;</span></span>
<span id="cb206-12"><a href="#cb206-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb206-13"><a href="#cb206-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"BAG"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb206-14"><a href="#cb206-14" aria-hidden="true" tabindex="-1"></a>  rand_for_final_fit <span class="sc">|&gt;</span></span>
<span id="cb206-15"><a href="#cb206-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb206-16"><a href="#cb206-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"RANDOM FOREST"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>)</span>
<span id="cb206-17"><a href="#cb206-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   Model         .metric .estimator .estimate .config        
   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
 1 MLR           rmse    standard       6136. pre0_mod0_post0
 2 MLR           mae     standard       4156. pre0_mod0_post0
 3 LASSO         rmse    standard       6133. pre0_mod0_post0
 4 LASSO         mae     standard       4163. pre0_mod0_post0
 5 TREE          rmse    standard       6696. pre0_mod0_post0
 6 TREE          mae     standard       4087. pre0_mod0_post0
 7 BAG           rmse    standard       5982. pre0_mod0_post0
 8 BAG           mae     standard       3630. pre0_mod0_post0
 9 RANDOM FOREST rmse    standard       5774. pre0_mod0_post0
10 RANDOM FOREST mae     standard       3526. pre0_mod0_post0</code></pre>
</div>
</div>
<p>Below are the extracted final model fits for each type, followed by a summary of each model.</p>
<p>The MLR model’s final coefficient table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits           id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;           &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [273/92]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;

There were issues with some computations:

  - Warning(s) x1: prediction from rank-deficient fit; consider predict(., rankdefic...

Run `show_notes(.Last.tune.result)` for more information.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)            16928.       343.   49.3     1.18e-133
 2 sum_rainfall           -1915.       459.   -4.17    4.12e-  5
 3 sum_snowfall            -160.       369.   -0.434   6.65e-  1
 4 mean_celcius_temp       3183.      6278.    0.507   6.13e-  1
 5 mean_percent_humidity   -355.      2348.   -0.151   8.80e-  1
 6 mean_wind_speed        -1047.       401.   -2.61    9.53e-  3
 7 mean_visib                46.5      514.    0.0904  9.28e-  1
 8 mean_dew_point_temp      318.      7395.    0.0430  9.66e-  1
 9 mean_solar_rad          3281.       612.    5.36    1.80e-  7
10 mean_rainfall             NA         NA    NA      NA        
11 mean_snowfall             NA         NA    NA      NA        
12 seasons_Spring         -1397.       499.   -2.80    5.52e-  3
13 seasons_Summer          -588.       572.   -1.03    3.05e-  1
14 seasons_Winter         -2950.       680.   -4.34    2.03e-  5
15 holiday_No.Holiday       526.       349.    1.51    1.33e-  1
16 day_type_Weekend       -1046.       349.   -3.00    3.00e-  3</code></pre>
</div>
</div>
<p>According to the MLR coefficient table, the dew point temperature, followed by the solar radiation, are the two most impactful variables.</p>
<p>The LASSO model’s final coefficient table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>LASSO_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────

Call:  glmnet::glmnet(x = maybe_matrix(x), y = y, family = "gaussian",      alpha = ~1) 

   Df  %Dev Lambda
1   0  0.00 6968.0
2   1  8.19 6349.0
3   2 17.02 5785.0
4   2 24.44 5271.0
5   2 30.61 4803.0
6   3 35.92 4376.0
7   3 40.39 3987.0
8   3 44.10 3633.0
9   3 47.18 3310.0
10  3 49.74 3016.0
11  3 51.86 2748.0
12  3 53.62 2504.0
13  3 55.09 2282.0
14  3 56.30 2079.0
15  3 57.31 1894.0
16  5 58.54 1726.0
17  5 59.79 1573.0
18  5 60.83 1433.0
19  5 61.70 1306.0
20  5 62.42 1190.0
21  6 63.19 1084.0
22  6 63.86  987.7
23  7 64.46  899.9
24  7 65.09  820.0
25  8 65.76  747.1
26  8 66.35  680.8
27  8 66.84  620.3
28  9 67.25  565.2
29 10 67.60  515.0
30 10 67.92  469.2
31 10 68.19  427.5
32 10 68.41  389.6
33 10 68.60  354.9
34 10 68.75  323.4
35 10 68.88  294.7
36 10 68.98  268.5
37 10 69.07  244.7
38 12 69.15  222.9
39 12 69.21  203.1
40 12 69.27  185.1
41 12 69.31  168.6
42 12 69.35  153.6
43 12 69.38  140.0
44 12 69.41  127.6
45 13 69.43  116.2
46 14 69.47  105.9

...
and 23 more lines.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="sc">|&gt;</span> </span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   term                  estimate      penalty
   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;
 1 (Intercept)            16928.  0.0000000001
 2 sum_rainfall           -1910.  0.0000000001
 3 sum_snowfall            -156.  0.0000000001
 4 mean_celcius_temp       3387.  0.0000000001
 5 mean_percent_humidity   -226.  0.0000000001
 6 mean_wind_speed        -1047.  0.0000000001
 7 mean_visib                65.8 0.0000000001
 8 mean_dew_point_temp        0   0.0000000001
 9 mean_solar_rad          3277.  0.0000000001
10 mean_rainfall            -12.5 0.0000000001
11 mean_snowfall              0   0.0000000001
12 seasons_Spring         -1354.  0.0000000001
13 seasons_Summer          -520.  0.0000000001
14 seasons_Winter         -2943.  0.0000000001
15 holiday_No.Holiday       509.  0.0000000001
16 day_type_Weekend       -1033.  0.0000000001</code></pre>
</div>
</div>
<p>According to this table of coefficients, the LASSO model perceives the solar radiation and dew point temperature to have the biggest influence on the accuracy of the prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="ot">&lt;-</span> tree_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_predictions</span>()</span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tree_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ".pred"                 "id"                    "sum_rented_bike_count"
[4] ".row"                  ".config"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>tree_preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92 × 5
    .pred id               sum_rented_bike_count  .row .config        
    &lt;dbl&gt; &lt;chr&gt;                            &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;          
 1  5332. train/test split                  4290     1 pre0_mod0_post0
 2 17255. train/test split                 27909    10 pre0_mod0_post0
 3 17255. train/test split                 22964    11 pre0_mod0_post0
 4 11914. train/test split                  8433    15 pre0_mod0_post0
 5 18212. train/test split                  7448    17 pre0_mod0_post0
 6 31958. train/test split                 30693    18 pre0_mod0_post0
 7  4038. train/test split                  3290    26 pre0_mod0_post0
 8 19066. train/test split                 12191    27 pre0_mod0_post0
 9  6416. train/test split                  6453    37 pre0_mod0_post0
10 27098. train/test split                 31781    43 pre0_mod0_post0
# ℹ 82 more rows</code></pre>
</div>
</div>
<p>The Regression Tree model’s plot of the final fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="sc">|&gt;</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_rented_bike_count, <span class="at">y=</span>.pred)) <span class="sc">+</span></span>
<span id="cb220-3"><a href="#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb220-4"><a href="#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)<span class="sc">+</span></span>
<span id="cb220-5"><a href="#cb220-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Actual Rented Bike Count versus Predictions </span><span class="sc">\n</span><span class="st">for Regression Tree Model'</span>, <span class="at">x=</span><span class="st">'Rented Bike Count'</span>, <span class="at">y =</span> <span class="st">'Predictions for Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Regression Tree model shows a positive relationship between the actual rented bike count and the predicted rented bike count, shown by the blue indicator line. There are obvious visual outliers that prevent this line from having a slope of 1.</p>
<p>The bagged tree model’s variable importance plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>bag_final_model <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(bag_final_fit) </span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>bag_final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bagged CART (regression with 11 members)

Variable importance scores include:

# A tibble: 15 × 4
   term                         value  std.error  used
   &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
 1 mean_celcius_temp     17666749399. 561077242.    11
 2 mean_dew_point_temp   14911601098. 849525032.    11
 3 mean_solar_rad        11029643472. 703530453.    11
 4 seasons_Winter        10552411322. 494229533.    11
 5 mean_percent_humidity  7863348009. 573600795.    11
 6 sum_rainfall           3398900485. 349448437.    11
 7 mean_rainfall          3185266962. 384841950.    11
 8 seasons_Summer         2563734246. 675236084.    11
 9 mean_wind_speed        1569198505. 265237986.    11
10 sum_snowfall           1496983563. 430049069.    10
11 mean_visib             1326950913. 248348702.    11
12 seasons_Spring         1294396673. 163869765.    11
13 day_type_Weekend        183923087.  51073609.    11
14 holiday_No.Holiday       49848691.  23507013.     8
15 mean_snowfall            15112955.   6004101.     5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>bag_final_model<span class="sc">$</span>imp <span class="sc">|&gt;</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">factor</span>(term, <span class="at">levels =</span> term)) <span class="sc">|&gt;</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Variable Importance for Bagged Tree Model'</span>, <span class="at">x=</span><span class="st">'Variable'</span>, <span class="at">y=</span><span class="st">'Importance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks like the temperature, solar radiation, and the dew point temperature were deemed the ‘most important’ by the Bagged tree model, which aligns with the results we anticipated in the correlation matrix from before. Snowfall, holiday/non-holiday, and weekday/weekend were not very relevant variables to the model.</p>
<p>Now, let’s break down the Random Forest model with a function to extract the fit to a control grid, then resample the fit using that control grid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>get_rand_for_importance <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a>    vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-7"><a href="#cb225-7" aria-hidden="true" tabindex="-1"></a>ctrl_imp <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">extract =</span> get_rand_for_importance)</span>
<span id="cb225-8"><a href="#cb225-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-9"><a href="#cb225-9" aria-hidden="true" tabindex="-1"></a>cells_resampling <span class="ot">&lt;-</span></span>
<span id="cb225-10"><a href="#cb225-10" aria-hidden="true" tabindex="-1"></a>  rand_for_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb225-11"><a href="#cb225-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold, <span class="at">control =</span> ctrl_imp)</span>
<span id="cb225-12"><a href="#cb225-12" aria-hidden="true" tabindex="-1"></a>cells_resampling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# 10-fold cross-validation 
# A tibble: 10 × 5
   splits           id     .metrics         .notes           .extracts       
   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
 1 &lt;split [245/28]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 2 &lt;split [245/28]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 3 &lt;split [245/28]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 4 &lt;split [246/27]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 5 &lt;split [246/27]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 6 &lt;split [246/27]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 7 &lt;split [246/27]&gt; Fold07 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 8 &lt;split [246/27]&gt; Fold08 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 9 &lt;split [246/27]&gt; Fold09 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
10 &lt;split [246/27]&gt; Fold10 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;</code></pre>
</div>
</div>
<p>Great, now we can unnest the tibble’s nested tibbles in the .extracts column to get the lists 2 levels down.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>cells_resampling_2 <span class="ot">&lt;-</span> cells_resampling <span class="sc">|&gt;</span></span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .extracts) <span class="sc">|&gt;</span></span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(.extracts) <span class="sc">|&gt;</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(.extracts) </span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a>cells_resampling_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 4
   id     Variable               Importance .config        
   &lt;chr&gt;  &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;          
 1 Fold01 mean_celcius_temp     8022412120. pre0_mod0_post0
 2 Fold01 mean_solar_rad        3971947730. pre0_mod0_post0
 3 Fold01 seasons_Winter        3281739808. pre0_mod0_post0
 4 Fold01 mean_dew_point_temp   2730419394. pre0_mod0_post0
 5 Fold01 mean_percent_humidity 1002526204. pre0_mod0_post0
 6 Fold01 mean_wind_speed        979427535. pre0_mod0_post0
 7 Fold01 mean_visib             871537933. pre0_mod0_post0
 8 Fold01 sum_rainfall           713617778. pre0_mod0_post0
 9 Fold01 mean_rainfall          691428271. pre0_mod0_post0
10 Fold01 seasons_Spring         199935510. pre0_mod0_post0
# ℹ 140 more rows</code></pre>
</div>
</div>
<p>The random forest model’s variable importance plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cells_resampling_2, <span class="fu">aes</span>(<span class="at">x=</span>Variable, <span class="at">y=</span>Importance)) <span class="sc">+</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>)<span class="sc">+</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Variable Importance for Random Forest Model'</span>, <span class="at">x=</span><span class="st">'Variable'</span>, <span class="at">y=</span><span class="st">'Importance'</span>) <span class="sc">+</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Once again, the Random Forest Model dictates the high importance of the temperature, solar radiation, dew point temperature, closely followed by the season being winter! What a cool analysis.</p>
<p>For the overall best model, the random forest model, here’s the fit for the entire data set!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(seoul_test,seoul_train)</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>rand_for_final_model_fit_total <span class="ot">&lt;-</span> rand_for_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(combo)</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>rand_for_final_model_fit_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~7L,      x), num.trees = ~2000L, importance = ~"impurity", num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) 

Type:                             Regression 
Number of trees:                  2000 
Sample size:                      365 
Number of independent variables:  15 
Mtry:                             7 
Target node size:                 5 
Variable importance mode:         impurity 
Splitrule:                        variance 
OOB prediction error (MSE):       25740242 
R squared (OOB):                  0.7554131 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>