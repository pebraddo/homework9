<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Powell Braddock, ST 558">

<title>Homework 9 Modeling Practice - Continuation of Homework 8</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Basic Modeling Practice_files/libs/clipboard/clipboard.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/popper.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/anchor.min.js"></script>
<link href="Basic Modeling Practice_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Basic Modeling Practice_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Basic Modeling Practice_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Basic Modeling Practice_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Basic Modeling Practice_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 9 Modeling Practice - Continuation of Homework 8</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Powell Braddock, ST 558 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="homework-8-portion" class="level1">
<h1>Homework 8 Portion</h1>
<p>In this assignment, we are looking at the Seoul Bike Data from the UCI Machine Learning Repository. We are looking at the following variables of interest:</p>
<p>• Date : day/month/year</p>
<p>• Rented Bike count - Count of bikes rented at each hour</p>
<p>• Hour - Hour of the day</p>
<p>• Temperature-Temperature in Celsius</p>
<p>• Humidity - %</p>
<p>• Windspeed - m/s</p>
<p>• Visibility - 10m</p>
<p>• Dew point temperature - Celsius</p>
<p>• Solar radiation - MJ/m2</p>
<p>• Rainfall - mm</p>
<p>• Snowfall - cm</p>
<p>• Seasons - Winter, Spring, Summer, Autumn</p>
<p>• Holiday - Holiday/No holiday</p>
<p>• Functional Day - NoFunc(Non Functional Hours), Fun(Functional hours)</p>
<section id="reading-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-the-data">Reading in the Data</h2>
<p>Let’s look at the data using read_csv. We have to use the locale encoding of latin1 because of the degree symbol for temperature variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#originally got an error: what I think came from the degree symbol in one of the attributes.  the wild internet provided the locale = latin1 solution!</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv'</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">'latin1'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8760 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Date, Seasons, Holiday, Functioning Day
dbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,760 × 14
   Date       `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
   &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;
 1 01/12/2017                 254     0              -5.2            37
 2 01/12/2017                 204     1              -5.5            38
 3 01/12/2017                 173     2              -6              39
 4 01/12/2017                 107     3              -6.2            40
 5 01/12/2017                  78     4              -6              36
 6 01/12/2017                 100     5              -6.4            37
 7 01/12/2017                 181     6              -6.6            35
 8 01/12/2017                 460     7              -7.4            38
 9 01/12/2017                 930     8              -7.6            37
10 01/12/2017                 490     9              -6.5            27
# ℹ 8,750 more rows
# ℹ 9 more variables: `Wind speed (m/s)` &lt;dbl&gt;, `Visibility (10m)` &lt;dbl&gt;,
#   `Dew point temperature(°C)` &lt;dbl&gt;, `Solar Radiation (MJ/m2)` &lt;dbl&gt;,
#   `Rainfall(mm)` &lt;dbl&gt;, `Snowfall (cm)` &lt;dbl&gt;, Seasons &lt;chr&gt;, Holiday &lt;chr&gt;,
#   `Functioning Day` &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<p>Now we must <em>check</em> the data… I’m starting with check for missingness: looks like we have na_counts of zero across the board for all columns! Whoop whoop whoop!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sum_na <span class="ot">&lt;-</span> <span class="cf">function</span>(column){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">is.na</span>(column) <span class="sc">+</span> <span class="fu">is.null</span>(column) <span class="sc">+</span> <span class="fu">is.nan</span>(column))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>na_counts <span class="ot">&lt;-</span> seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum_na))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>na_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 14
   Date `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
  &lt;int&gt;               &lt;int&gt; &lt;int&gt;             &lt;int&gt;         &lt;int&gt;
1     0                   0     0                 0             0
# ℹ 9 more variables: `Wind speed (m/s)` &lt;int&gt;, `Visibility (10m)` &lt;int&gt;,
#   `Dew point temperature(°C)` &lt;int&gt;, `Solar Radiation (MJ/m2)` &lt;int&gt;,
#   `Rainfall(mm)` &lt;int&gt;, `Snowfall (cm)` &lt;int&gt;, Seasons &lt;int&gt;, Holiday &lt;int&gt;,
#   `Functioning Day` &lt;int&gt;</code></pre>
</div>
</div>
<p>Now, we must check the column types and the values within the columns to make sure they make sense. I’m using the psych package’s describe() for basic summary statistics for numeric columns. I’m checking the unique values for the categorical variables using unique().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'psych'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:ggplot2':

    %+%, alpha</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(seoul_bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          vars    n    mean     sd  median trimmed    mad   min
Date*                        1 8760  183.00 105.37  183.00  183.00 134.92   1.0
Rented Bike Count            2 8760  704.60 645.00  504.50  612.58 553.75   0.0
Hour                         3 8760   11.50   6.92   11.50   11.50   8.90   0.0
Temperature(°C)              4 8760   12.88  11.94   13.70   13.19  13.94 -17.8
Humidity(%)                  5 8760   58.23  20.36   57.00   58.02  23.72   0.0
Wind speed (m/s)             6 8760    1.72   1.04    1.50    1.63   1.04   0.0
Visibility (10m)             7 8760 1436.83 608.30 1698.00 1509.50 447.75  27.0
Dew point temperature(°C)    8 8760    4.07  13.06    5.10    4.76  14.38 -30.6
Solar Radiation (MJ/m2)      9 8760    0.57   0.87    0.01    0.38   0.01   0.0
Rainfall(mm)                10 8760    0.15   1.13    0.00    0.00   0.00   0.0
Snowfall (cm)               11 8760    0.08   0.44    0.00    0.00   0.00   0.0
Seasons*                    12 8760    2.50   1.11    2.00    2.49   1.48   1.0
Holiday*                    13 8760    1.95   0.22    2.00    2.00   0.00   1.0
Functioning Day*            14 8760    1.97   0.18    2.00    2.00   0.00   1.0
                              max   range  skew kurtosis   se
Date*                      365.00  364.00  0.00    -1.20 1.13
Rented Bike Count         3556.00 3556.00  1.15     0.85 6.89
Hour                        23.00   23.00  0.00    -1.20 0.07
Temperature(°C)             39.40   57.20 -0.20    -0.84 0.13
Humidity(%)                 98.00   98.00  0.06    -0.80 0.22
Wind speed (m/s)             7.40    7.40  0.89     0.73 0.01
Visibility (10m)          2000.00 1973.00 -0.70    -0.96 6.50
Dew point temperature(°C)   27.20   57.80 -0.37    -0.76 0.14
Solar Radiation (MJ/m2)      3.52    3.52  1.50     1.12 0.01
Rainfall(mm)                35.00   35.00 14.53   284.76 0.01
Snowfall (cm)                8.80    8.80  8.44    93.73 0.00
Seasons*                     4.00    3.00  0.00    -1.35 0.01
Holiday*                     2.00    1.00 -4.16    15.33 0.00
Functioning Day*             2.00    1.00 -5.17    24.72 0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span>Seasons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Winter" "Spring" "Summer" "Autumn"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span>Holiday) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "No Holiday" "Holiday"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span><span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yes" "No" </code></pre>
</div>
</div>
<p>Let’s convert the Date column into an actual date using the dmy() function from the lubridate package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_date <span class="ot">&lt;-</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  seoul_bike_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">dmy</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we want to turn the character variables (Seasons, Holiday, and Functioning Day) into factors (remember those unique values from before?). We can rename all the variables to be lower snake case too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data<span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Seasons =</span> <span class="fu">as.factor</span>(Seasons),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Holiday =</span> <span class="fu">as.factor</span>(Holiday),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'date'</span><span class="ot">=</span><span class="st">'Date'</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">'rented_bike_count'</span> <span class="ot">=</span> <span class="st">'Rented Bike Count'</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">'hour'</span> <span class="ot">=</span> <span class="st">'Hour'</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">'celcius_temp'</span> <span class="ot">=</span> <span class="st">'Temperature(°C)'</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">'percent_humidity'</span><span class="ot">=</span><span class="st">'Humidity(%)'</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">'wind_speed'</span><span class="ot">=</span> <span class="st">'Wind speed (m/s)'</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">'visib'</span><span class="ot">=</span><span class="st">'Visibility (10m)'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">'dew_point_temp'</span> <span class="ot">=</span> <span class="st">'Dew point temperature(°C)'</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">'solar_rad'</span><span class="ot">=</span><span class="st">'Solar Radiation (MJ/m2)'</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">'rainfall'</span> <span class="ot">=</span> <span class="st">'Rainfall(mm)'</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">'snowfall'</span> <span class="ot">=</span> <span class="st">'Snowfall (cm)'</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">'seasons'</span> <span class="ot">=</span> <span class="st">'Seasons'</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">'holiday'</span> <span class="ot">=</span> <span class="st">'Holiday'</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">'function_day'</span> <span class="ot">=</span> <span class="st">'Functioning Day'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Onto creating summary statistics. The first contingency table is the data grouped by Functioning Day across Rented Bike Count with descriptive summaries of mean, median, variance, standard deviation, and interquartile range.</p>
<p>Wow! When functioning day is ‘no’, there were no bike rentals. Bike rentals only occurred on functioning days of ‘yes’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(function_day) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"var"</span> <span class="ot">=</span> var, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> sd, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"IQR"</span> <span class="ot">=</span> IQR), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  function_day mean_rented_bike_count median_rented_bike_count
  &lt;fct&gt;                         &lt;dbl&gt;                    &lt;dbl&gt;
1 No                               0                         0
2 Yes                            729.                      542
# ℹ 3 more variables: var_rented_bike_count &lt;dbl&gt;, sd_rented_bike_count &lt;dbl&gt;,
#   IQR_rented_bike_count &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This time, we will only look at functioning days of ‘yes’ where we summarize grouped by seasons and holiday variables. All four seasons have rented bike counts associated with them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasons, holiday) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(function_day <span class="sc">==</span> <span class="st">'Yes'</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"var"</span> <span class="ot">=</span> var, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> sd, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"IQR"</span> <span class="ot">=</span> IQR), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'seasons'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
# Groups:   seasons [4]
  seasons holiday    mean_rented_bike_count median_rented_bike_count
  &lt;fct&gt;   &lt;fct&gt;                       &lt;dbl&gt;                    &lt;dbl&gt;
1 Autumn  Holiday                      948.                     900 
2 Autumn  No Holiday                   923.                     852 
3 Spring  Holiday                      635.                     366.
4 Spring  No Holiday                   750.                     605 
5 Summer  Holiday                     1022.                     925 
6 Summer  No Holiday                  1034.                     904.
7 Winter  Holiday                      157.                     138 
8 Winter  No Holiday                   232.                     212 
# ℹ 3 more variables: var_rented_bike_count &lt;dbl&gt;, sd_rented_bike_count &lt;dbl&gt;,
#   IQR_rented_bike_count &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now, we’ll summarize across the hours so that each day has one observation associated with it. We are grouping by Date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(function_day <span class="sc">==</span> <span class="st">'Yes'</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 353 × 3
   date       mean_rented_bike_count median_rented_bike_count
   &lt;chr&gt;                       &lt;dbl&gt;                    &lt;dbl&gt;
 1 01/01/2018                   179.                    174. 
 2 01/02/2018                   224.                    238. 
 3 01/03/2018                   214.                    190. 
 4 01/04/2018                   724.                    662. 
 5 01/05/2018                  1118.                   1092  
 6 01/06/2018                  1330.                   1156  
 7 01/07/2018                   135.                     22.5
 8 01/08/2018                   863                     673  
 9 01/09/2018                  1084.                   1034. 
10 01/10/2018                  1163.                   1122. 
# ℹ 343 more rows</code></pre>
</div>
</div>
<p>Now let’s group across date, seasons, and holiday variables for the sums of rented bike count, rainfall, and snowfall and the averages of the weather variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new_bike_data <span class="ot">&lt;-</span> seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, seasons, holiday) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(rented_bike_count,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                     rainfall,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                     snowfall), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns=</span><span class="fu">list</span>(<span class="st">'sum'</span><span class="ot">=</span>sum), </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">c</span>(celcius_temp, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                     percent_humidity,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                     wind_speed,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                     visib,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                     dew_point_temp, </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                     solar_rad, </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                     rainfall,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                     snowfall), </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean), </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date', 'seasons'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>new_bike_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 14
# Groups:   date, seasons [365]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter  Holiday                     4290          0            0  
 2 2018-02-01 Winter  No Holiday                  5377          0           21.7
 3 2018-03-01 Spring  Holiday                     5132          2.5          0  
 4 2018-04-01 Spring  No Holiday                 17388          0            0  
 5 2018-05-01 Spring  Holiday                    26820          0            0  
 6 2018-06-01 Summer  No Holiday                 31928          0            0  
 7 2018-07-01 Summer  No Holiday                  3231         81            0  
 8 2018-08-01 Summer  No Holiday                 20712          0            0  
 9 2018-09-01 Autumn  No Holiday                 26010          0            0  
10 2018-10-01 Autumn  No Holiday                 27909          0            0  
# ℹ 355 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now let’s use this data to recreate those basic summary statistics and then create some plots to explore relationships.</p>
<p>First, we will create a contingency table of seasons and holiday variables. Most rented bike counts occurred on ‘not’ holidays. The highest count of rentals is in the summer for ‘not’ holidays and winter for holidays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>new_bike_data <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasons, holiday)<span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> holiday, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'seasons'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   seasons [4]
  seasons Holiday `No Holiday`
  &lt;fct&gt;     &lt;int&gt;        &lt;int&gt;
1 Autumn        5           86
2 Spring        3           89
3 Summer        2           90
4 Winter        8           82</code></pre>
</div>
</div>
<p>We can use psych’s describe() function again to get numeric summaries on this new data, like before.</p>
<p>I also defined the numeric variables in the data as num_vars for easier use later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(new_bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(newX[, i], ...): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(newX[, i], ...): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      vars   n     mean       sd   median  trimmed      mad
date                     1 365      NaN       NA       NA      NaN       NA
seasons*                 2 365     2.50     1.12     2.00     2.49     1.48
holiday*                 3 365     1.95     0.22     2.00     2.00     0.00
sum_rented_bike_count    4 365 16910.45 10258.64 17730.00 16859.32 14654.02
sum_rainfall             5 365     3.57    11.85     0.00     0.60     0.00
sum_snowfall             6 365     1.80     8.66     0.00     0.00     0.00
mean_celcius_temp        7 365    12.88    11.56    13.84    13.20    13.50
mean_percent_humidity    8 365    58.23    14.67    57.21    57.75    14.70
mean_wind_speed          9 365     1.72     0.60     1.64     1.66     0.50
mean_visib              10 365  1436.83   491.25  1557.75  1486.04   565.49
mean_dew_point_temp     11 365     4.07    12.81     5.01     4.67    14.39
mean_solar_rad          12 365     0.57     0.31     0.56     0.56     0.41
mean_rainfall           13 365     0.15     0.49     0.00     0.02     0.00
mean_snowfall           14 365     0.08     0.36     0.00     0.00     0.00
                         min      max    range  skew kurtosis     se
date                     Inf     -Inf     -Inf    NA       NA     NA
seasons*                1.00     4.00     3.00  0.00    -1.36   0.06
holiday*                1.00     2.00     1.00 -4.15    15.23   0.01
sum_rented_bike_count   0.00 36149.00 36149.00 -0.03    -1.39 536.96
sum_rainfall            0.00    95.50    95.50  4.85    26.25   0.62
sum_snowfall            0.00    78.70    78.70  5.94    37.97   0.45
mean_celcius_temp     -14.74    33.74    48.48 -0.24    -0.91   0.60
mean_percent_humidity  22.25    95.88    73.62  0.26    -0.28   0.77
mean_wind_speed         0.66     4.00     3.34  1.07     1.18   0.03
mean_visib            214.29  2000.00  1785.71 -0.63    -0.74  25.71
mean_dew_point_temp   -27.75    25.04    52.79 -0.32    -0.82   0.67
mean_solar_rad          0.03     1.22     1.19  0.18    -1.08   0.02
mean_rainfall           0.00     3.98     3.98  4.85    26.25   0.03
mean_snowfall           0.00     3.28     3.28  5.94    37.97   0.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> new_bike_data <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sum_rented_bike_count, sum_rainfall, sum_snowfall, mean_celcius_temp, mean_percent_humidity, mean_wind_speed, mean_visib, mean_dew_point_temp, mean_solar_rad, mean_rainfall, mean_snowfall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `date`, `seasons`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>num_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 13
# Groups:   date, seasons [365]
   date       seasons sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;                   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter                   4290          0            0  
 2 2018-02-01 Winter                   5377          0           21.7
 3 2018-03-01 Spring                   5132          2.5          0  
 4 2018-04-01 Spring                  17388          0            0  
 5 2018-05-01 Spring                  26820          0            0  
 6 2018-06-01 Summer                  31928          0            0  
 7 2018-07-01 Summer                   3231         81            0  
 8 2018-08-01 Summer                  20712          0            0  
 9 2018-09-01 Autumn                  26010          0            0  
10 2018-10-01 Autumn                  27909          0            0  
# ℹ 355 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now to plot… Let’s look at the rented bike count sums by date and holiday! Both the scatterplot and the overlapping holiday linear regression plots show an increase in the rental counts as the year goes on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>holiday)) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%B %d, %Y"</span>) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Date'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_rainfall, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_visib)) <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Rainfall and Mean Visibility in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Rainfall - mm'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s check where the x axis is mean snowfall and mean wind speed. The majority of bike rentals occur when there is no snowfall and low wind speed. There are a few dates with snowfall and rentals, but they mostly have lower wind speeds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_snowfall, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_wind_speed)) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Snowfall and Mean Wind Speed in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Rainfall - mm'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OOOh, a correlation matrix of the numeric variables we defined before.</p>
<p>As expected, mean rainfall and sum rainfall are very correlated, as well as mean snowfall and sum snowfall.</p>
<p>Mean Celcius Temp and Mean Dew Point Temp are also super correlated (0.96).</p>
<p>The most correlated variable with the Sum Rented Bike Count is Mean Celcius Temp. Let’s look at this and the next most correlated variable: solar radiation!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">correlate</span>(num_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `date`, and `seasons`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">shave</span>(cor_matrix)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rplot</span>(cor_matrix, <span class="at">print_cor =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.
ℹ The deprecated feature was likely used in the corrr package.
  Please report the issue at &lt;https://github.com/tidymodels/corrr/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is certainly a correlated relationship! The higher temperature has higher rental counts and higher solar radiation. Who would have thought?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_celcius_temp, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_solar_rad)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Temperature and Mean Solar Radiation </span><span class="sc">\n</span><span class="st">in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Temperature in Celcius'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Makes sense, because dew point temperature looks to be correlated as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_celcius_temp, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_dew_point_temp)) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Temperature and Mean Dew Point Temperature </span><span class="sc">\n</span><span class="st">in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Temperature in Celcius'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="split-the-data" class="level1">
<h1>Split the Data</h1>
<p>Here, we can use functions from tidymodels to split the data into a training and test set (75/25 split). By using the strata argument, we can stratify the split on the seasons variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.10     ✔ rsample      1.3.1 
✔ dials        1.4.2      ✔ tailor       0.1.0 
✔ infer        1.0.9      ✔ tune         2.0.1 
✔ modeldata    1.5.1      ✔ workflows    1.3.0 
✔ parsnip      1.3.3      ✔ workflowsets 1.1.1 
✔ recipes      1.3.1      ✔ yardstick    1.3.2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ psych::%+%()      masks ggplot2::%+%()
✖ scales::alpha()   masks psych::alpha(), ggplot2::alpha()
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>seoul_data <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(new_bike_data, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata=</span>seasons)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>seoul_train <span class="ot">&lt;-</span> <span class="fu">training</span>(seoul_data)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>seoul_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 273 × 14
# Groups:   date, seasons [273]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-09-01 Autumn  No Holiday                 26010          0              0
 2 2018-10-01 Autumn  No Holiday                 27909          0              0
 3 2018-11-01 Autumn  No Holiday                 22964          0              0
 4 2018-09-02 Autumn  No Holiday                 26881          0              0
 5 2018-10-02 Autumn  No Holiday                     0          0              0
 6 2018-11-02 Autumn  No Holiday                 24077          0              0
 7 2018-09-03 Autumn  No Holiday                 10802         34.5            0
 8 2018-10-03 Autumn  Holiday                    30349          0              0
 9 2018-11-03 Autumn  No Holiday                     0          0              0
10 2018-09-04 Autumn  No Holiday                 29529          0              0
# ℹ 263 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>seoul_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(seoul_data)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>seoul_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92 × 14
# Groups:   date, seasons [92]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-04-02 Spring  No Holiday                 21585            0            0
 2 2018-05-02 Spring  No Holiday                  7448           12            0
 3 2017-12-02 Winter  No Holiday                  8523            0            0
 4 2018-01-03 Winter  No Holiday                  6512            0            0
 5 2018-03-03 Spring  No Holiday                 12191            0            0
 6 2018-08-03 Summer  No Holiday                 20794            0            0
 7 2018-01-04 Winter  No Holiday                  6453            0            0
 8 2018-05-04 Spring  No Holiday                 26670            0            0
 9 2018-07-04 Summer  No Holiday                 31781            0            0
10 2018-11-04 Autumn  No Holiday                 20471            0            0
# ℹ 82 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now we can look further into the training set and create a 10 fold CV split.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(seoul_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 273</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>size_fold <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(seoul_train)<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>size_fold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>random_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(seoul_train), <span class="at">size =</span> <span class="fu">nrow</span>(seoul_train), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#see the random reordering</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(random_indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 183 226  79  12 119 170</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a list to save our folds in</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#now cycle through our random indices vector and take the appropriate observations to each fold</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#you may want to set i to 1 and run the arguments to from and to in the seq() function</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#change i to 2 and do the same thing to see how this works</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    fold_index <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> (i<span class="dv">-1</span>)<span class="sc">*</span>size_fold <span class="sc">+</span><span class="dv">1</span>, <span class="at">to =</span> i<span class="sc">*</span>size_fold, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    folds[[i]] <span class="ot">&lt;-</span> seoul_train[random_indices[fold_index], ]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co">#for i = 10 we need to have 1 more observation </span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    fold_index <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> (i<span class="dv">-1</span>)<span class="sc">*</span>size_fold <span class="sc">+</span><span class="dv">1</span>, <span class="at">to =</span> <span class="fu">length</span>(random_indices), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    folds[[i]] <span class="ot">&lt;-</span> seoul_train[random_indices[fold_index], ]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>folds[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 14
# Groups:   date, seasons [27]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-06-21 Summer  No Holiday                 34621          0            0  
 2 2018-01-11 Winter  No Holiday                  4017          0            0  
 3 2018-03-06 Spring  No Holiday                 12003          0            0  
 4 2018-09-05 Autumn  No Holiday                 31114          0            0  
 5 2018-03-22 Spring  No Holiday                 14007          0            0  
 6 2018-06-15 Summer  No Holiday                 33492         16.5          0  
 7 2017-12-13 Winter  No Holiday                  6019          0            0  
 8 2017-12-22 Winter  Holiday                     7184          0            7.7
 9 2017-12-24 Winter  Holiday                     2014         20            0  
10 2018-02-08 Winter  No Holiday                  5613          0            0  
# ℹ 17 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>folds[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 14
# Groups:   date, seasons [27]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-03-24 Spring  No Holiday                 12243          0            0  
 2 2018-09-29 Autumn  No Holiday                 31447          0            0  
 3 2018-10-21 Autumn  No Holiday                 23906          0            0  
 4 2018-06-07 Summer  No Holiday                 32002          0            0  
 5 2018-07-24 Summer  No Holiday                 24635          0            0  
 6 2018-04-08 Spring  No Holiday                  6666          3            0  
 7 2017-12-18 Winter  No Holiday                  2620          3.4         59.7
 8 2018-04-12 Spring  No Holiday                 22729          0            0  
 9 2018-05-22 Spring  Holiday                    13790          9            0  
10 2018-01-13 Winter  No Holiday                  3503          0.4          2.2
# ℹ 17 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#training data</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>train_list <span class="ot">&lt;-</span> folds</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(train_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
</section>
<section id="fitting-mlr-models" class="level1">
<h1>Fitting MLR Models</h1>
<p>First, let’s create some recipes for our different models. For the 1st recipe: we’re ignoring the date variable for modeling (day_type) and removing it after we create a weekday/weekend (factor) variable. We can use step_normalize to standardize the numeric variables since their scales are pretty different and create dummy variables for the seasons, holiday, and our new day type variable using step_dummy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_1 <span class="ot">&lt;-</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
</div>
<p>For the 2nd recipe we are beginning with the same steps as before, but also adding in interactions between seasons and holiday, seasons and temp, temp and rainfall.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_2 <span class="ot">&lt;-</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)<span class="sc">|&gt;</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">step_interact</span>(</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="sc">~</span> (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span><span class="st">`</span><span class="at">holiday_No.Holiday</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>           (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span>mean_celcius_temp <span class="sc">+</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>           mean_celcius_temp<span class="sc">:</span>mean_rainfall</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: ...</code></pre>
</div>
</div>
<p>For the 3rd recipe: we are adding in quadratic terms for each numeric predictor using step_poly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_3 <span class="ot">&lt;-</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)<span class="sc">|&gt;</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="sc">~</span> (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span><span class="st">`</span><span class="at">holiday_No.Holiday</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>           (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span>mean_celcius_temp <span class="sc">+</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>           mean_celcius_temp<span class="sc">:</span>mean_rainfall</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>)<span class="sc">|&gt;</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(sum_rainfall, sum_snowfall, mean_celcius_temp, mean_percent_humidity, </span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>          mean_wind_speed, mean_visib, mean_dew_point_temp, mean_solar_rad, </span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>          mean_rainfall, mean_snowfall, <span class="at">degree =</span> <span class="dv">2</span>) </span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Polynomial expansion on: sum_rainfall sum_snowfall, ...</code></pre>
</div>
</div>
<p>Now we will set up our linear model fit to use the “lm” engine as seoul_mod.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>seoul_mod <span class="ot">&lt;-</span><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'lm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use this to create a workflow using the recipe and this model (for all three models).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl1 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl2 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_2) <span class="sc">|&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
5 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()
• step_interact()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl3 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_3) <span class="sc">|&gt;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
6 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()
• step_interact()
• step_poly()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
<p>Let’s check out the fits on the training data using the three different workflows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>seoul_fit1 <span class="ot">&lt;-</span> seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>seoul_fit1 <span class="sc">|&gt;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)             17116.      340.    50.3    1.13e-135
 2 sum_rainfall            -1733.      446.    -3.89   1.30e-  4
 3 sum_snowfall             -191.      371.    -0.514  6.08e-  1
 4 mean_celcius_temp        1127.     6358.     0.177  8.59e-  1
 5 mean_percent_humidity   -1092.     2340.    -0.467  6.41e-  1
 6 mean_wind_speed          -809.      387.    -2.09   3.75e-  2
 7 mean_visib               -166.      482.    -0.344  7.31e-  1
 8 mean_dew_point_temp      2646.     7411.     0.357  7.21e-  1
 9 mean_solar_rad           3873.      651.     5.95   8.79e-  9
10 mean_rainfall              NA        NA     NA     NA        
11 mean_snowfall              NA        NA     NA     NA        
12 seasons_Spring          -1608.      483.    -3.33   9.85e-  4
13 seasons_Summer           -532.      557.    -0.955  3.40e-  1
14 seasons_Winter          -2958.      648.    -4.56   7.74e-  6
15 holiday_No.Holiday        392.      348.     1.13   2.60e-  1
16 day_type_Weekend         -936.      346.    -2.71   7.23e-  3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>seoul_fit2 <span class="ot">&lt;-</span> seoul_wfl2 <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>seoul_fit2 <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 5
   term                  estimate std.error statistic   p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)             21540.      889.    24.2    8.25e-68
 2 sum_rainfall            -1940.      687.    -2.82   5.12e- 3
 3 sum_snowfall             -178.      340.    -0.525  6.00e- 1
 4 mean_celcius_temp       -2074.     5984.    -0.347  7.29e- 1
 5 mean_percent_humidity   -1714.     2214.    -0.774  4.40e- 1
 6 mean_wind_speed          -611.      351.    -1.74   8.31e- 2
 7 mean_visib                177.      464.     0.382  7.03e- 1
 8 mean_dew_point_temp      4070.     6952.     0.585  5.59e- 1
 9 mean_solar_rad           3057.      592.     5.16   5.02e- 7
10 mean_rainfall              NA        NA     NA     NA       
# ℹ 13 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>seoul_fit3 <span class="ot">&lt;-</span> seoul_wfl3 <span class="sc">|&gt;</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>seoul_fit3<span class="sc">|&gt;</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 5
   term                                estimate std.error statistic  p.value
   &lt;chr&gt;                                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)                          24888.      2465.   10.1    2.99e-20
 2 seasons_Spring                       -1160.       458.   -2.53   1.20e- 2
 3 seasons_Summer                        9195.      1547.    5.94   9.51e- 9
 4 seasons_Winter                       -1458.      1694.   -0.861  3.90e- 1
 5 holiday_No.Holiday                     447.       382.    1.17   2.43e- 1
 6 day_type_Weekend                      -925.       319.   -2.90   4.11e- 3
 7 seasons_Spring_x_holiday_No.Holiday     70.0      412.    0.170  8.65e- 1
 8 seasons_Summer_x_holiday_No.Holiday     23.8      557.    0.0427 9.66e- 1
 9 seasons_Winter_x_holiday_No.Holiday     51.5      344.    0.150  8.81e- 1
10 seasons_Spring_x_mean_celcius_temp    2996.       834.    3.59   3.97e- 4
# ℹ 23 more rows</code></pre>
</div>
</div>
<p>We can fit the models using 10 fold CV via fit_resamples() and look at the training set CV error to choose a best model—looks like the model 1!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>seoul_10_fold <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(seoul_train, <span class="dv">10</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>cv_fits1 <span class="ot">&lt;-</span> seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x7</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>cv_fits2 <span class="ot">&lt;-</span> seoul_wfl2 <span class="sc">|&gt;</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>cv_fits3 <span class="ot">&lt;-</span> seoul_wfl3 <span class="sc">|&gt;</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cv_fits1 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>),</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>      cv_fits2 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>),</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>      cv_fits3 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model=</span> <span class="fu">c</span>(<span class="st">'Model 1'</span>, <span class="st">'Model 2'</span>, <span class="st">'Model 3'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, mean, n, std_err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Model    mean     n std_err
  &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 Model 1 5530.    10    557.
2 Model 2 4833.    10    626.
3 Model 3 4858.    10    611.</code></pre>
</div>
</div>
<p>Model 1 is the ‘best’ model, so let’s fit the model to the entire training data set. The 2x4 tibble is the computed RMSE (and RSQ) metric on the test set.</p>
<p>The final model is fit on the entire training set and its coefficient table is the final displayed tibble (using extract_fit_parsnip() and tidy()).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(seoul_wfl1, <span class="at">split=</span>seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1
There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(best_mod_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6185. pre0_mod0_post0
2 mae     standard       4127. pre0_mod0_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)             17116.      340.    50.3    1.13e-135
 2 sum_rainfall            -1733.      446.    -3.89   1.30e-  4
 3 sum_snowfall             -191.      371.    -0.514  6.08e-  1
 4 mean_celcius_temp        1127.     6358.     0.177  8.59e-  1
 5 mean_percent_humidity   -1092.     2340.    -0.467  6.41e-  1
 6 mean_wind_speed          -809.      387.    -2.09   3.75e-  2
 7 mean_visib               -166.      482.    -0.344  7.31e-  1
 8 mean_dew_point_temp      2646.     7411.     0.357  7.21e-  1
 9 mean_solar_rad           3873.      651.     5.95   8.79e-  9
10 mean_rainfall              NA        NA     NA     NA        
11 mean_snowfall              NA        NA     NA     NA        
12 seasons_Spring          -1608.      483.    -3.33   9.85e-  4
13 seasons_Summer           -532.      557.    -0.955  3.40e-  1
14 seasons_Winter          -2958.      648.    -4.56   7.74e-  6
15 holiday_No.Holiday        392.      348.     1.13   2.60e-  1
16 day_type_Weekend         -936.      346.    -2.71   7.23e-  3</code></pre>
</div>
</div>
<p>I would be interested to learn more about why the p value of mean_solar_rad is so small, followed by rainfall and wind speed.</p>
<p>Overall, interesting assignment!</p>
</section>
<section id="homework-9-begins-here" class="level1">
<h1>Homework 9 Begins Here</h1>
<p>We will use the first recipe (seoul_train_rec_1) from homework 8 with no quadratics nor interactions to tune our <strong>LASSO Model</strong>. Let’s use the glmnet engine and the linear_reg function with a mixture of 1 (specifies LASSO instead of Elastic Net) and an opportunity to tune the penalty with a resampling method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>LASSO_Seoul <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'glmnet'</span>)</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(LASSO_Seoul)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>LASSO_wkf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Main Arguments:
  penalty = tune()
  mixture = 1

Computational engine: glmnet </code></pre>
</div>
</div>
<p>Now, we can great a grid that tunes based on the resamples of the CV-10-fold with 200 levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>LASSO_grid <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold, </span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">200</span>),</span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s plot these grid results with the RMSE metric… Looks like all the RMSE values are the same!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>LASSO_grid <span class="sc">|&gt;</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>) <span class="sc">|&gt;</span></span>
<span id="cb155-4"><a href="#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">color=</span>.metric)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'LASSO Grid results for Means associated with Penalty Options'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s pull out the ‘best’ model using select_best() by RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>lowest_rmse_LASSO <span class="ot">&lt;-</span> LASSO_grid <span class="sc">|&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>lowest_rmse_LASSO</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
       penalty .config          
         &lt;dbl&gt; &lt;chr&gt;            
1 0.0000000001 pre0_mod001_post0</code></pre>
</div>
</div>
<p>Now we can fit that ‘best’ LASSO model on the entire training set, seoul_train. finalize_workflow() has captured the tuned model we defined before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lowest_rmse_LASSO) <span class="sc">|&gt;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(LASSO_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   term                  estimate      penalty
   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;
 1 (Intercept)           17116.   0.0000000001
 2 sum_rainfall          -1781.   0.0000000001
 3 sum_snowfall           -207.   0.0000000001
 4 mean_celcius_temp      3309.   0.0000000001
 5 mean_percent_humidity  -230.   0.0000000001
 6 mean_wind_speed        -817.   0.0000000001
 7 mean_visib              -80.0  0.0000000001
 8 mean_dew_point_temp       3.43 0.0000000001
 9 mean_solar_rad         3847.   0.0000000001
10 mean_rainfall            -6.05 0.0000000001
11 mean_snowfall             0    0.0000000001
12 seasons_Spring        -1563.   0.0000000001
13 seasons_Summer         -451.   0.0000000001
14 seasons_Winter        -2932.   0.0000000001
15 holiday_No.Holiday      368.   0.0000000001
16 day_type_Weekend       -932.   0.0000000001</code></pre>
</div>
</div>
<p>Now we can compare the chosen model on the test set using last_fit() and see the differences between our MLR model from Homework 8 and this LASSO model. It appears that the MLR Model outperforms the LASSO Model slightly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data) <span class="sc">|&gt;</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1
There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    6185.    pre0_mod0_post0
2 rsq     standard       0.634 pre0_mod0_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lowest_rmse_LASSO) <span class="sc">|&gt;</span></span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data) <span class="sc">|&gt;</span></span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    6195.    pre0_mod0_post0
2 rsq     standard       0.632 pre0_mod0_post0</code></pre>
</div>
</div>
<p>Let’s check out the RMSE of the model when predicting on a new set of data: the test data. That’s the same RMSE as on the combined data. Let’s confirm and ‘finalize’ that model using finalize_workflow and collect metrics on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="sc">|&gt;</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(seoul_test) <span class="sc">|&gt;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">|&gt;</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse_vec</span>(<span class="at">truth =</span> seoul_test<span class="sc">$</span>sum_rented_bike_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6194.56</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(<span class="fu">tibble</span>(<span class="at">penalty =</span> lowest_rmse_LASSO<span class="sc">$</span>penalty)) </span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>LASSO_model <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(LASSO_wkf, <span class="at">split=</span>seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>LASSO_model<span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6195. pre0_mod0_post0
2 mae     standard       4159. pre0_mod0_post0</code></pre>
</div>
</div>
<p>To tuning a <strong>Regression Tree</strong> model…</p>
<p>We can use decision_tree from the tree package this time, with the rpart engine specified for regression. Let’s tune for the tree_depth and cost_complexity and follow similar steps to the LASSO model, using the recipe from homework 8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">20</span>,</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>tree_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_mod)</span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>temp_tree <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span> </span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb174-12"><a href="#cb174-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae)) <span class="co">#uses defaults from dials</span></span>
<span id="cb174-13"><a href="#cb174-13" aria-hidden="true" tabindex="-1"></a>temp_tree <span class="sc">|&gt;</span> </span>
<span id="cb174-14"><a href="#cb174-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          5 mae     standard   3857.    10    213. pre0_mod01…
 2    0.0000000001          5 rmse    standard   5573.    10    431. pre0_mod01…
 3    0.000000001          11 mae     standard   3874.    10    218. pre0_mod02…
 4    0.000000001          11 rmse    standard   5600.    10    460. pre0_mod02…
 5    0.00000001            1 mae     standard   5799.    10    349. pre0_mod03…
 6    0.00000001            1 rmse    standard   7557.    10    497. pre0_mod03…
 7    0.0000001             7 mae     standard   3878.    10    218. pre0_mod04…
 8    0.0000001             7 rmse    standard   5600.    10    460. pre0_mod04…
 9    0.000001             13 mae     standard   3874.    10    218. pre0_mod05…
10    0.000001             13 rmse    standard   5600.    10    460. pre0_mod05…
11    0.00001               2 mae     standard   4374.    10    255. pre0_mod06…
12    0.00001               2 rmse    standard   6090.    10    503. pre0_mod06…
13    0.0001                8 mae     standard   3874.    10    218. pre0_mod07…
14    0.0001                8 rmse    standard   5600.    10    460. pre0_mod07…
15    0.001                15 mae     standard   3850.    10    223. pre0_mod08…
16    0.001                15 rmse    standard   5593.    10    461. pre0_mod08…
17    0.01                  4 mae     standard   3896.    10    205. pre0_mod09…
18    0.01                  4 rmse    standard   5548.    10    394. pre0_mod09…
19    0.1                  10 mae     standard   5065.    10    236. pre0_mod10…
20    0.1                  10 rmse    standard   6761.    10    409. pre0_mod10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span> </span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> tree_grid,</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          1 mae     standard   5799.    10    349. pre0_mod01…
 2    0.0000000001          1 rmse    standard   7557.    10    497. pre0_mod01…
 3    0.0000000001          4 mae     standard   3877.    10    199. pre0_mod02…
 4    0.0000000001          4 rmse    standard   5548.    10    397. pre0_mod02…
 5    0.0000000001          8 mae     standard   3874.    10    218. pre0_mod03…
 6    0.0000000001          8 rmse    standard   5600.    10    460. pre0_mod03…
 7    0.0000000001         11 mae     standard   3874.    10    218. pre0_mod04…
 8    0.0000000001         11 rmse    standard   5600.    10    460. pre0_mod04…
 9    0.0000000001         15 mae     standard   3874.    10    218. pre0_mod05…
10    0.0000000001         15 rmse    standard   5600.    10    460. pre0_mod05…
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Our best tree fit selected with the RMSE in mind has a cost complexity of 0.001 and a tree depth of 4. We can finalize that workflow and plot it to a tree plot! So fun.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="sc">|&gt;</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"rmse"</span>) <span class="sc">|&gt;</span></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.001                 4 rmse    standard   5536.    10    399. pre0_mod37…
 2    0.01                  4 rmse    standard   5548.    10    394. pre0_mod42…
 3    0.0000000001          4 rmse    standard   5548.    10    397. pre0_mod02…
 4    0.000000001           4 rmse    standard   5548.    10    397. pre0_mod07…
 5    0.00000001            4 rmse    standard   5548.    10    397. pre0_mod12…
 6    0.0000001             4 rmse    standard   5548.    10    397. pre0_mod17…
 7    0.000001              4 rmse    standard   5548.    10    397. pre0_mod22…
 8    0.00001               4 rmse    standard   5548.    10    397. pre0_mod27…
 9    0.0001                4 rmse    standard   5548.    10    397. pre0_mod32…
10    0.001                 8 rmse    standard   5593.    10    461. pre0_mod38…
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>tree_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tree_fits, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>tree_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  cost_complexity tree_depth .config         
            &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;           
1           0.001          4 pre0_mod37_post0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>tree_final_wkf <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(tree_best_params)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="ot">&lt;-</span> tree_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>tree_final_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits           id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;           &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [273/92]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6664. pre0_mod0_post0
2 mae     standard       3938. pre0_mod0_post0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>tree_final_model <span class="ot">&lt;-</span> <span class="fu">extract_workflow</span>(tree_final_fit) </span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>tree_final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: decision_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
n= 273 

node), split, n, deviance, yval
      * denotes terminal node

 1) root 273 28747530000 17115.770  
   2) mean_celcius_temp&lt; -0.05651278 120  4361156000  8957.908  
     4) seasons_Winter&gt;=0.5904959 67   233775600  5447.925  
       8) mean_celcius_temp&lt; -1.528667 19    25516340  3916.263 *
       9) mean_celcius_temp&gt;=-1.528667 48   146041700  6054.208 *
     5) seasons_Winter&lt; 0.5904959 53  2258462000 13395.060  
      10) sum_rainfall&gt;=-0.1840241 11   106817300  6223.636 *
      11) sum_rainfall&lt; -0.1840241 42  1437758000 15273.290  
        22) seasons_Spring&gt;=0.567894 19   204644500 12605.210 *
        23) seasons_Spring&lt; 0.567894 23   986128000 17477.350 *
   3) mean_celcius_temp&gt;=-0.05651278 153 10136700000 23514.090  
     6) mean_solar_rad&lt; -0.63023 24  1187000000 12435.540  
      12) mean_solar_rad&lt; -1.279053 9   105700500  6772.889 *
      13) mean_solar_rad&gt;=-1.279053 15   619554200 15833.130 *
     7) mean_solar_rad&gt;=-0.63023 129  5456051000 25575.220  
      14) mean_celcius_temp&lt; 0.5866402 51  3056065000 22753.240  
        28) mean_dew_point_temp&gt;=0.2673345 14  1849726000 16943.710 *
        29) mean_dew_point_temp&lt; 0.2673345 37   555045000 24951.430 *
      15) mean_celcius_temp&gt;=0.5866402 78  1728289000 27420.360  
        30) mean_celcius_temp&gt;=1.39991 21   194265500 21850.670 *
        31) mean_celcius_temp&lt; 1.39991 57   642564000 29472.350 *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>tree_final_model <span class="sc">|&gt;</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>(<span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ooh La La… a tuned <strong>Bagged Tree</strong> model.</p>
<p>This time, we use bag_tree from the baguette library and do basically the same things as for the tree model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(baguette)</span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>bag_mod <span class="ot">&lt;-</span> <span class="fu">bag_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">20</span>,</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>bag_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bag_mod)</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a>temp_bag <span class="ot">&lt;-</span> bag_wkf <span class="sc">|&gt;</span> </span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae)) <span class="co">#uses defaults from dials</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'butcher':
  method                 from    
  as.character.dev_topic generics</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>temp_bag <span class="sc">|&gt;</span> </span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          5 mae     standard   3573.    10    310. pre0_mod01…
 2    0.0000000001          5 rmse    standard   5086.    10    551. pre0_mod01…
 3    0.000000001          11 mae     standard   3472.    10    239. pre0_mod02…
 4    0.000000001          11 rmse    standard   5068.    10    545. pre0_mod02…
 5    0.00000001            1 mae     standard   5529.    10    358. pre0_mod03…
 6    0.00000001            1 rmse    standard   7111.    10    530. pre0_mod03…
 7    0.0000001             7 mae     standard   3507.    10    268. pre0_mod04…
 8    0.0000001             7 rmse    standard   5147.    10    594. pre0_mod04…
 9    0.000001             13 mae     standard   3513.    10    244. pre0_mod05…
10    0.000001             13 rmse    standard   4950.    10    540. pre0_mod05…
11    0.00001               2 mae     standard   4141.    10    270. pre0_mod06…
12    0.00001               2 rmse    standard   5668.    10    531. pre0_mod06…
13    0.0001                8 mae     standard   3585.    10    270. pre0_mod07…
14    0.0001                8 rmse    standard   5143.    10    557. pre0_mod07…
15    0.001                15 mae     standard   3592.    10    248. pre0_mod08…
16    0.001                15 rmse    standard   5192.    10    552. pre0_mod08…
17    0.01                  4 mae     standard   3817.    10    290. pre0_mod09…
18    0.01                  4 rmse    standard   5239.    10    596. pre0_mod09…
19    0.1                  10 mae     standard   4658.    10    277. pre0_mod10…
20    0.1                  10 rmse    standard   6190.    10    472. pre0_mod10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>bag_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="ot">&lt;-</span> bag_wkf <span class="sc">|&gt;</span> </span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> bag_grid,</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          1 mae     standard   5374.    10    380. pre0_mod01…
 2    0.0000000001          1 rmse    standard   6932.    10    555. pre0_mod01…
 3    0.0000000001          4 mae     standard   3663.    10    290. pre0_mod02…
 4    0.0000000001          4 rmse    standard   5237.    10    557. pre0_mod02…
 5    0.0000000001          8 mae     standard   3469.    10    269. pre0_mod03…
 6    0.0000000001          8 rmse    standard   5079.    10    546. pre0_mod03…
 7    0.0000000001         11 mae     standard   3498.    10    281. pre0_mod04…
 8    0.0000000001         11 rmse    standard   5074.    10    575. pre0_mod04…
 9    0.0000000001         15 mae     standard   3484.    10    288. pre0_mod05…
10    0.0000000001         15 rmse    standard   5075.    10    569. pre0_mod05…
# ℹ 90 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="sc">|&gt;</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.metric == "rmse") |&gt;</span></span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.00001              11 mae     standard   3381.    10    254. pre0_mod29…
 2    0.0001               11 mae     standard   3385.    10    254. pre0_mod34…
 3    0.000001             11 mae     standard   3420.    10    274. pre0_mod24…
 4    0.000000001          15 mae     standard   3442.    10    252. pre0_mod10…
 5    0.00000001            8 mae     standard   3447.    10    265. pre0_mod13…
 6    0.000001             15 mae     standard   3458.    10    253. pre0_mod25…
 7    0.001                 8 mae     standard   3468.    10    241. pre0_mod38…
 8    0.0000000001          8 mae     standard   3469.    10    269. pre0_mod03…
 9    0.001                11 mae     standard   3474.    10    240. pre0_mod39…
10    0.0000001            15 mae     standard   3477.    10    257. pre0_mod20…
# ℹ 90 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>bag_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(bag_fits, <span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>bag_final_wkf <span class="ot">&lt;-</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  bag_wkf <span class="sc">|&gt;</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(bag_best_params)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>bag_final_fit <span class="ot">&lt;-</span> bag_final_wkf <span class="sc">|&gt;</span> </span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a>bag_final_fit<span class="sc">$</span>.metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       5957. pre0_mod0_post0
2 mae     standard       3495. pre0_mod0_post0</code></pre>
</div>
</div>
<p>Finally, a tuned Random Forest model: it uses the library ranger and rand_forest to tune mtry and trees. Let’s check out the comparisons between the models below to learn more!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>rand_for_mod <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'ranger'</span>, <span class="at">importance=</span><span class="st">'impurity'</span>) <span class="sc">|&gt;</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">'regression'</span>)</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>rand_for_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rand_for_mod)</span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>temp_rand_for <span class="ot">&lt;-</span> rand_for_wkf<span class="sc">|&gt;</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid=</span><span class="dv">7</span>,</span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>i Creating pre-processing data to finalize 1 unknown parameter: "mtry"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>temp_rand_for <span class="sc">|&gt;</span><span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1     1  1333 mae     standard   5007.    10    264. pre0_mod1_post0
 2     1  1333 rmse    standard   6135.    10    447. pre0_mod1_post0
 3     3   334 mae     standard   3473.    10    262. pre0_mod2_post0
 4     3   334 rmse    standard   4995.    10    581. pre0_mod2_post0
 5     5  2000 mae     standard   3299.    10    261. pre0_mod3_post0
 6     5  2000 rmse    standard   4884.    10    583. pre0_mod3_post0
 7     8  1000 mae     standard   3220.    10    268. pre0_mod4_post0
 8     8  1000 rmse    standard   4838.    10    591. pre0_mod4_post0
 9    10     1 mae     standard   4320.    10    329. pre0_mod5_post0
10    10     1 rmse    standard   6803.    10    700. pre0_mod5_post0
11    12  1666 mae     standard   3213.    10    264. pre0_mod6_post0
12    12  1666 rmse    standard   4884.    10    585. pre0_mod6_post0
13    15   667 mae     standard   3215.    10    265. pre0_mod7_post0
14    15   667 rmse    standard   4922.    10    574. pre0_mod7_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>rand_for_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">mtry</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(seoul_train) <span class="sc">-</span> <span class="dv">1</span>)), <span class="fu">trees</span>())</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="ot">&lt;-</span> rand_for_wkf <span class="sc">|&gt;</span></span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold, <span class="at">grid=</span>rand_for_grid,</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1     1     1 mae     standard   5938.    10    478. pre0_mod1_post0
 2     1     1 rmse    standard   7987.    10    542. pre0_mod1_post0
 3     1  1000 mae     standard   5046.    10    265. pre0_mod2_post0
 4     1  1000 rmse    standard   6169.    10    442. pre0_mod2_post0
 5     1  2000 mae     standard   5041.    10    259. pre0_mod3_post0
 6     1  2000 rmse    standard   6171.    10    446. pre0_mod3_post0
 7     7     1 mae     standard   4312.    10    446. pre0_mod4_post0
 8     7     1 rmse    standard   6459.    10    814. pre0_mod4_post0
 9     7  1000 mae     standard   3254.    10    261. pre0_mod5_post0
10     7  1000 rmse    standard   4868.    10    586. pre0_mod5_post0
11     7  2000 mae     standard   3243.    10    259. pre0_mod6_post0
12     7  2000 rmse    standard   4861.    10    585. pre0_mod6_post0
13    13     1 mae     standard   4596.    10    462. pre0_mod7_post0
14    13     1 rmse    standard   7008.    10    771. pre0_mod7_post0
15    13  1000 mae     standard   3220.    10    260. pre0_mod8_post0
16    13  1000 rmse    standard   4903.    10    574. pre0_mod8_post0
17    13  2000 mae     standard   3219.    10    262. pre0_mod9_post0
18    13  2000 rmse    standard   4917.    10    583. pre0_mod9_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="sc">|&gt;</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.metric == 'rmse') |&gt;</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1    13  2000 mae     standard   3219.    10    262. pre0_mod9_post0
 2    13  1000 mae     standard   3220.    10    260. pre0_mod8_post0
 3     7  2000 mae     standard   3243.    10    259. pre0_mod6_post0
 4     7  1000 mae     standard   3254.    10    261. pre0_mod5_post0
 5     7     1 mae     standard   4312.    10    446. pre0_mod4_post0
 6    13     1 mae     standard   4596.    10    462. pre0_mod7_post0
 7     7  2000 rmse    standard   4861.    10    585. pre0_mod6_post0
 8     7  1000 rmse    standard   4868.    10    586. pre0_mod5_post0
 9    13  1000 rmse    standard   4903.    10    574. pre0_mod8_post0
10    13  2000 rmse    standard   4917.    10    583. pre0_mod9_post0
11     1  2000 mae     standard   5041.    10    259. pre0_mod3_post0
12     1  1000 mae     standard   5046.    10    265. pre0_mod2_post0
13     1     1 mae     standard   5938.    10    478. pre0_mod1_post0
14     1  1000 rmse    standard   6169.    10    442. pre0_mod2_post0
15     1  2000 rmse    standard   6171.    10    446. pre0_mod3_post0
16     7     1 rmse    standard   6459.    10    814. pre0_mod4_post0
17    13     1 rmse    standard   7008.    10    771. pre0_mod7_post0
18     1     1 rmse    standard   7987.    10    542. pre0_mod1_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>rand_for_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rand_for_fits, <span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>rand_for_final_wkf <span class="ot">&lt;-</span> rand_for_wkf <span class="sc">|&gt;</span><span class="fu">finalize_workflow</span>(rand_for_best_params)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>rand_for_final_fit <span class="ot">&lt;-</span> rand_for_final_wkf <span class="sc">|&gt;</span> <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each of these models are fit and tuned on the training set. The best model from each family of models is then fit it to the entire training data set to see how it predicts on the test set.</p>
<p>All final model’s RMSE and MAE are shown in the table below. The Random Forest model has the lowest RMSE and MAE, which would make it my choice for the ‘best’ model for predicting the bike rentals in Seoul. The second ‘best’ model would be the Bagged Tree model, with the closest RMSE and MAE values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>   best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> </span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"MLR"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>), </span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  LASSO_model <span class="sc">|&gt;</span></span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"LASSO"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a>  tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"TREE"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>  bag_final_fit <span class="sc">|&gt;</span></span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"BAG"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>  rand_for_final_fit <span class="sc">|&gt;</span></span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"RANDOM FOREST"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>)</span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   Model         .metric .estimator .estimate .config        
   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
 1 MLR           rmse    standard       6185. pre0_mod0_post0
 2 MLR           mae     standard       4127. pre0_mod0_post0
 3 LASSO         rmse    standard       6195. pre0_mod0_post0
 4 LASSO         mae     standard       4159. pre0_mod0_post0
 5 TREE          rmse    standard       6664. pre0_mod0_post0
 6 TREE          mae     standard       3938. pre0_mod0_post0
 7 BAG           rmse    standard       5957. pre0_mod0_post0
 8 BAG           mae     standard       3495. pre0_mod0_post0
 9 RANDOM FOREST rmse    standard       5803. pre0_mod0_post0
10 RANDOM FOREST mae     standard       3340. pre0_mod0_post0</code></pre>
</div>
</div>
<p>Below are the extracted final model fits for each type, followed by a summary of each model.</p>
<p>The MLR model’s final coefficient table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits           id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;           &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [273/92]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;

There were issues with some computations:

  - Warning(s) x1: prediction from rank-deficient fit; consider predict(., rankdefic...

Run `show_notes(.Last.tune.result)` for more information.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)             17116.      340.    50.3    1.13e-135
 2 sum_rainfall            -1733.      446.    -3.89   1.30e-  4
 3 sum_snowfall             -191.      371.    -0.514  6.08e-  1
 4 mean_celcius_temp        1127.     6358.     0.177  8.59e-  1
 5 mean_percent_humidity   -1092.     2340.    -0.467  6.41e-  1
 6 mean_wind_speed          -809.      387.    -2.09   3.75e-  2
 7 mean_visib               -166.      482.    -0.344  7.31e-  1
 8 mean_dew_point_temp      2646.     7411.     0.357  7.21e-  1
 9 mean_solar_rad           3873.      651.     5.95   8.79e-  9
10 mean_rainfall              NA        NA     NA     NA        
11 mean_snowfall              NA        NA     NA     NA        
12 seasons_Spring          -1608.      483.    -3.33   9.85e-  4
13 seasons_Summer           -532.      557.    -0.955  3.40e-  1
14 seasons_Winter          -2958.      648.    -4.56   7.74e-  6
15 holiday_No.Holiday        392.      348.     1.13   2.60e-  1
16 day_type_Weekend         -936.      346.    -2.71   7.23e-  3</code></pre>
</div>
</div>
<p>According to the MLR coefficient table, the dew point temperature, followed by the solar radiation, are the two most impactful variables.</p>
<p>The LASSO model’s final coefficient table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>LASSO_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────

Call:  glmnet::glmnet(x = maybe_matrix(x), y = y, family = "gaussian",      alpha = ~1) 

   Df  %Dev Lambda
1   0  0.00 7282.0
2   2 10.50 6635.0
3   2 19.57 6046.0
4   2 27.10 5509.0
5   2 33.35 5019.0
6   2 38.53 4573.0
7   2 42.84 4167.0
8   3 46.46 3797.0
9   3 49.61 3460.0
10  3 52.24 3152.0
11  3 54.41 2872.0
12  3 56.22 2617.0
13  3 57.71 2385.0
14  3 58.96 2173.0
15  3 59.99 1980.0
16  3 60.85 1804.0
17  5 62.03 1644.0
18  5 63.12 1498.0
19  5 64.03 1365.0
20  5 64.78 1243.0
21  5 65.41 1133.0
22  6 65.94 1032.0
23  6 66.51  940.5
24  6 66.97  857.0
25  8 67.54  780.8
26  8 68.17  711.5
27  8 68.69  648.3
28  8 69.12  590.7
29  8 69.47  538.2
30  8 69.77  490.4
31  8 70.02  446.8
32  8 70.22  407.1
33  8 70.39  371.0
34  9 70.55  338.0
35  9 70.68  308.0
36  9 70.79  280.6
37 11 70.88  255.7
38 11 70.97  233.0
39 11 71.04  212.3
40 11 71.10  193.4
41 11 71.15  176.2
42 11 71.19  160.6
43 11 71.22  146.3
44 12 71.25  133.3
45 12 71.28  121.5
46 12 71.30  110.7

...
and 24 more lines.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="sc">|&gt;</span> </span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb216-3"><a href="#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   term                  estimate      penalty
   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;
 1 (Intercept)           17116.   0.0000000001
 2 sum_rainfall          -1781.   0.0000000001
 3 sum_snowfall           -207.   0.0000000001
 4 mean_celcius_temp      3309.   0.0000000001
 5 mean_percent_humidity  -230.   0.0000000001
 6 mean_wind_speed        -817.   0.0000000001
 7 mean_visib              -80.0  0.0000000001
 8 mean_dew_point_temp       3.43 0.0000000001
 9 mean_solar_rad         3847.   0.0000000001
10 mean_rainfall            -6.05 0.0000000001
11 mean_snowfall             0    0.0000000001
12 seasons_Spring        -1563.   0.0000000001
13 seasons_Summer         -451.   0.0000000001
14 seasons_Winter        -2932.   0.0000000001
15 holiday_No.Holiday      368.   0.0000000001
16 day_type_Weekend       -932.   0.0000000001</code></pre>
</div>
</div>
<p>According to this table of coefficients, the LASSO model perceives the solar radiation and dew point temperature to have the biggest influence on the accuracy of the prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="ot">&lt;-</span> tree_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_predictions</span>()</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tree_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ".pred"                 "id"                    "sum_rented_bike_count"
[4] ".row"                  ".config"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>tree_preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92 × 5
    .pred id               sum_rented_bike_count  .row .config        
    &lt;dbl&gt; &lt;chr&gt;                            &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;          
 1 16944. train/test split                 21585    16 pre0_mod0_post0
 2  6773. train/test split                  7448    17 pre0_mod0_post0
 3  6054. train/test split                  8523    24 pre0_mod0_post0
 4  6054. train/test split                  6512    25 pre0_mod0_post0
 5 12605. train/test split                 12191    27 pre0_mod0_post0
 6 21851. train/test split                 20794    32 pre0_mod0_post0
 7  3916. train/test split                  6453    37 pre0_mod0_post0
 8 24951. train/test split                 26670    41 pre0_mod0_post0
 9 29472. train/test split                 31781    43 pre0_mod0_post0
10 17477. train/test split                 20471    47 pre0_mod0_post0
# ℹ 82 more rows</code></pre>
</div>
</div>
<p>The Regression Tree model’s plot of the final fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="sc">|&gt;</span></span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_rented_bike_count, <span class="at">y=</span>.pred)) <span class="sc">+</span></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)<span class="sc">+</span></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Actual Rented Bike Count versus Predictions </span><span class="sc">\n</span><span class="st">for Regression Tree Model'</span>, <span class="at">x=</span><span class="st">'Rented Bike Count'</span>, <span class="at">y =</span> <span class="st">'Predictions for Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Regression Tree model shows a positive relationship between the actual rented bike count and the predicted rented bike count, shown by the blue indicator line. There are obvious visual outliers that prevent this line from having a slope of 1.</p>
<p>The bagged tree model’s variable importance plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>bag_final_model <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(bag_final_fit) </span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>bag_final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bagged CART (regression with 11 members)

Variable importance scores include:

# A tibble: 15 × 4
   term                         value  std.error  used
   &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
 1 mean_celcius_temp     18243736487. 590914074.    11
 2 mean_dew_point_temp   15383496230. 580151247.    11
 3 mean_solar_rad        13266533757. 591468377.    11
 4 seasons_Winter        10340172172. 471080298.    11
 5 mean_percent_humidity  7733981444. 534402205.    11
 6 seasons_Summer         3429179393. 858078950.    11
 7 sum_rainfall           3310623455. 248068969.    11
 8 mean_rainfall          2854728732. 216547124.    11
 9 mean_visib             2197362018. 447163990.    11
10 mean_wind_speed        1476235938. 207480801.    11
11 seasons_Spring         1081862900. 114523400.    11
12 sum_snowfall            721244888. 361437278.    11
13 day_type_Weekend        230915468.  93161745.    10
14 holiday_No.Holiday       83610420.  33059727.     9
15 mean_snowfall            18823063.  11540700.     7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>bag_final_model<span class="sc">$</span>imp <span class="sc">|&gt;</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">factor</span>(term, <span class="at">levels =</span> term)) <span class="sc">|&gt;</span></span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb226-4"><a href="#cb226-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb226-5"><a href="#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb226-6"><a href="#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Variable Importance for Bagged Tree Model'</span>, <span class="at">x=</span><span class="st">'Variable'</span>, <span class="at">y=</span><span class="st">'Importance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks like the temperature, solar radiation, and the dew point temperature were deemed the ‘most important’ by the Bagged tree model, which aligns with the results we anticipated in the correlation matrix from before. Snowfall, holiday/non-holiday, and weekday/weekend were not very relevant variables to the model.</p>
<p>Now, let’s break down the Random Forest model with a function to extract the fit to a control grid, then resample the fit using that control grid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>get_rand_for_importance <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb227-2"><a href="#cb227-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb227-3"><a href="#cb227-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb227-4"><a href="#cb227-4" aria-hidden="true" tabindex="-1"></a>    vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb227-5"><a href="#cb227-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb227-6"><a href="#cb227-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-7"><a href="#cb227-7" aria-hidden="true" tabindex="-1"></a>ctrl_imp <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">extract =</span> get_rand_for_importance)</span>
<span id="cb227-8"><a href="#cb227-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-9"><a href="#cb227-9" aria-hidden="true" tabindex="-1"></a>cells_resampling <span class="ot">&lt;-</span></span>
<span id="cb227-10"><a href="#cb227-10" aria-hidden="true" tabindex="-1"></a>  rand_for_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb227-11"><a href="#cb227-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold, <span class="at">control =</span> ctrl_imp)</span>
<span id="cb227-12"><a href="#cb227-12" aria-hidden="true" tabindex="-1"></a>cells_resampling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# 10-fold cross-validation 
# A tibble: 10 × 5
   splits           id     .metrics         .notes           .extracts       
   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
 1 &lt;split [245/28]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 2 &lt;split [245/28]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 3 &lt;split [245/28]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 4 &lt;split [246/27]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 5 &lt;split [246/27]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 6 &lt;split [246/27]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 7 &lt;split [246/27]&gt; Fold07 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 8 &lt;split [246/27]&gt; Fold08 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 9 &lt;split [246/27]&gt; Fold09 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
10 &lt;split [246/27]&gt; Fold10 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;</code></pre>
</div>
</div>
<p>Great, now we can unnest the tibble’s nested tibbles in the .extracts column to get the lists 2 levels down.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>cells_resampling_2 <span class="ot">&lt;-</span> cells_resampling <span class="sc">|&gt;</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .extracts) <span class="sc">|&gt;</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(.extracts) <span class="sc">|&gt;</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(.extracts) </span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>cells_resampling_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 4
   id     Variable               Importance .config        
   &lt;chr&gt;  &lt;chr&gt;                       &lt;dbl&gt; &lt;chr&gt;          
 1 Fold01 mean_celcius_temp     9536827694. pre0_mod0_post0
 2 Fold01 mean_solar_rad        4611837469. pre0_mod0_post0
 3 Fold01 mean_dew_point_temp   3363511695. pre0_mod0_post0
 4 Fold01 seasons_Winter        2441285310. pre0_mod0_post0
 5 Fold01 mean_percent_humidity 1096226421. pre0_mod0_post0
 6 Fold01 mean_visib             901704334. pre0_mod0_post0
 7 Fold01 mean_wind_speed        643247046. pre0_mod0_post0
 8 Fold01 sum_rainfall           577862168. pre0_mod0_post0
 9 Fold01 mean_rainfall          535783472. pre0_mod0_post0
10 Fold01 seasons_Spring         224161734. pre0_mod0_post0
# ℹ 140 more rows</code></pre>
</div>
</div>
<p>The random forest model’s variable importance plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cells_resampling_2, <span class="fu">aes</span>(<span class="at">x=</span>Variable, <span class="at">y=</span>Importance)) <span class="sc">+</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>)<span class="sc">+</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Variable Importance for Random Forest Model'</span>, <span class="at">x=</span><span class="st">'Variable'</span>, <span class="at">y=</span><span class="st">'Importance'</span>) <span class="sc">+</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Once again, the Random Forest Model dictates the high importance of the temperature, solar radiation, dew point temperature, closely followed by the season being winter! What a cool analysis.</p>
<p>For the overall best model, the random forest model, here’s the fit for the entire data set!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(seoul_test,seoul_train)</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>rand_for_final_model_fit_total <span class="ot">&lt;-</span> rand_for_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(combo)</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>rand_for_final_model_fit_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~7L,      x), num.trees = ~2000L, importance = ~"impurity", num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) 

Type:                             Regression 
Number of trees:                  2000 
Sample size:                      365 
Number of independent variables:  15 
Mtry:                             7 
Target node size:                 5 
Variable importance mode:         impurity 
Splitrule:                        variance 
OOB prediction error (MSE):       25878804 
R squared (OOB):                  0.7540965 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>