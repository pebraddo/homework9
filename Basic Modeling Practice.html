<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Powell Braddock, ST 558">

<title>Homework 9 Modeling Practice - Continuation of Homework 8</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Basic Modeling Practice_files/libs/clipboard/clipboard.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/popper.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Basic Modeling Practice_files/libs/quarto-html/anchor.min.js"></script>
<link href="Basic Modeling Practice_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Basic Modeling Practice_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Basic Modeling Practice_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Basic Modeling Practice_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Basic Modeling Practice_files/libs/bootstrap/bootstrap-81267100e462c21b3d6c0d5bf76a3417.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework 9 Modeling Practice - Continuation of Homework 8</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Powell Braddock, ST 558 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="homework-8-portion" class="level1">
<h1>Homework 8 Portion</h1>
<p>In this assignment, we are looking at the Seoul Bike Data from the UCI Machine Learning Repository. We are looking at the following variables of interest:</p>
<p>• Date : day/month/year</p>
<p>• Rented Bike count - Count of bikes rented at each hour</p>
<p>• Hour - Hour of the day</p>
<p>• Temperature-Temperature in Celsius</p>
<p>• Humidity - %</p>
<p>• Windspeed - m/s</p>
<p>• Visibility - 10m</p>
<p>• Dew point temperature - Celsius</p>
<p>• Solar radiation - MJ/m2</p>
<p>• Rainfall - mm</p>
<p>• Snowfall - cm</p>
<p>• Seasons - Winter, Spring, Summer, Autumn</p>
<p>• Holiday - Holiday/No holiday</p>
<p>• Functional Day - NoFunc(Non Functional Hours), Fun(Functional hours)</p>
<section id="reading-in-the-data" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-the-data">Reading in the Data</h2>
<p>Let’s look at the data using read_csv. We have to use the locale encoding of latin1 because of the degree symbol for temperature variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.1     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#originally got an error: what I think came from the degree symbol in one of the attributes.  the wild internet provided the locale = latin1 solution!</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">'https://www4.stat.ncsu.edu/~online/datasets/SeoulBikeData.csv'</span>, <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">'latin1'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8760 Columns: 14
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (4): Date, Seasons, Holiday, Functioning Day
dbl (10): Rented Bike Count, Hour, Temperature(°C), Humidity(%), Wind speed ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8,760 × 14
   Date       `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
   &lt;chr&gt;                    &lt;dbl&gt; &lt;dbl&gt;             &lt;dbl&gt;         &lt;dbl&gt;
 1 01/12/2017                 254     0              -5.2            37
 2 01/12/2017                 204     1              -5.5            38
 3 01/12/2017                 173     2              -6              39
 4 01/12/2017                 107     3              -6.2            40
 5 01/12/2017                  78     4              -6              36
 6 01/12/2017                 100     5              -6.4            37
 7 01/12/2017                 181     6              -6.6            35
 8 01/12/2017                 460     7              -7.4            38
 9 01/12/2017                 930     8              -7.6            37
10 01/12/2017                 490     9              -6.5            27
# ℹ 8,750 more rows
# ℹ 9 more variables: `Wind speed (m/s)` &lt;dbl&gt;, `Visibility (10m)` &lt;dbl&gt;,
#   `Dew point temperature(°C)` &lt;dbl&gt;, `Solar Radiation (MJ/m2)` &lt;dbl&gt;,
#   `Rainfall(mm)` &lt;dbl&gt;, `Snowfall (cm)` &lt;dbl&gt;, Seasons &lt;chr&gt;, Holiday &lt;chr&gt;,
#   `Functioning Day` &lt;chr&gt;</code></pre>
</div>
</div>
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<p>Now we must <em>check</em> the data… I’m starting with check for missingness: looks like we have na_counts of zero across the board for all columns! Whoop whoop whoop!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sum_na <span class="ot">&lt;-</span> <span class="cf">function</span>(column){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(<span class="fu">is.na</span>(column) <span class="sc">+</span> <span class="fu">is.null</span>(column) <span class="sc">+</span> <span class="fu">is.nan</span>(column))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>na_counts <span class="ot">&lt;-</span> seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), sum_na))</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>na_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 14
   Date `Rented Bike Count`  Hour `Temperature(°C)` `Humidity(%)`
  &lt;int&gt;               &lt;int&gt; &lt;int&gt;             &lt;int&gt;         &lt;int&gt;
1     0                   0     0                 0             0
# ℹ 9 more variables: `Wind speed (m/s)` &lt;int&gt;, `Visibility (10m)` &lt;int&gt;,
#   `Dew point temperature(°C)` &lt;int&gt;, `Solar Radiation (MJ/m2)` &lt;int&gt;,
#   `Rainfall(mm)` &lt;int&gt;, `Snowfall (cm)` &lt;int&gt;, Seasons &lt;int&gt;, Holiday &lt;int&gt;,
#   `Functioning Day` &lt;int&gt;</code></pre>
</div>
</div>
<p>Now, we must check the column types and the values within the columns to make sure they make sense. I’m using the psych package’s describe() for basic summary statistics for numeric columns. I’m checking the unique values for the categorical variables using unique().</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'psych'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:ggplot2':

    %+%, alpha</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(seoul_bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          vars    n    mean     sd  median trimmed    mad   min
Date*                        1 8760  183.00 105.37  183.00  183.00 134.92   1.0
Rented Bike Count            2 8760  704.60 645.00  504.50  612.58 553.75   0.0
Hour                         3 8760   11.50   6.92   11.50   11.50   8.90   0.0
Temperature(°C)              4 8760   12.88  11.94   13.70   13.19  13.94 -17.8
Humidity(%)                  5 8760   58.23  20.36   57.00   58.02  23.72   0.0
Wind speed (m/s)             6 8760    1.72   1.04    1.50    1.63   1.04   0.0
Visibility (10m)             7 8760 1436.83 608.30 1698.00 1509.50 447.75  27.0
Dew point temperature(°C)    8 8760    4.07  13.06    5.10    4.76  14.38 -30.6
Solar Radiation (MJ/m2)      9 8760    0.57   0.87    0.01    0.38   0.01   0.0
Rainfall(mm)                10 8760    0.15   1.13    0.00    0.00   0.00   0.0
Snowfall (cm)               11 8760    0.08   0.44    0.00    0.00   0.00   0.0
Seasons*                    12 8760    2.50   1.11    2.00    2.49   1.48   1.0
Holiday*                    13 8760    1.95   0.22    2.00    2.00   0.00   1.0
Functioning Day*            14 8760    1.97   0.18    2.00    2.00   0.00   1.0
                              max   range  skew kurtosis   se
Date*                      365.00  364.00  0.00    -1.20 1.13
Rented Bike Count         3556.00 3556.00  1.15     0.85 6.89
Hour                        23.00   23.00  0.00    -1.20 0.07
Temperature(°C)             39.40   57.20 -0.20    -0.84 0.13
Humidity(%)                 98.00   98.00  0.06    -0.80 0.22
Wind speed (m/s)             7.40    7.40  0.89     0.73 0.01
Visibility (10m)          2000.00 1973.00 -0.70    -0.96 6.50
Dew point temperature(°C)   27.20   57.80 -0.37    -0.76 0.14
Solar Radiation (MJ/m2)      3.52    3.52  1.50     1.12 0.01
Rainfall(mm)                35.00   35.00 14.53   284.76 0.01
Snowfall (cm)                8.80    8.80  8.44    93.73 0.00
Seasons*                     4.00    3.00  0.00    -1.35 0.01
Holiday*                     2.00    1.00 -4.16    15.33 0.00
Functioning Day*             2.00    1.00 -5.17    24.72 0.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span>Seasons)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Winter" "Spring" "Summer" "Autumn"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span>Holiday) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "No Holiday" "Holiday"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(seoul_bike_data<span class="sc">$</span><span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yes" "No" </code></pre>
</div>
</div>
<p>Let’s convert the Date column into an actual date using the dmy() function from the lubridate package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_date <span class="ot">&lt;-</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  seoul_bike_data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Date =</span> <span class="fu">dmy</span>(Date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we want to turn the character variables (Seasons, Holiday, and Functioning Day) into factors (remember those unique values from before?). We can rename all the variables to be lower snake case too.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data<span class="ot">&lt;-</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Seasons =</span> <span class="fu">as.factor</span>(Seasons),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Holiday =</span> <span class="fu">as.factor</span>(Holiday),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Functioning Day</span><span class="st">`</span>)) <span class="sc">|&gt;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">'date'</span><span class="ot">=</span><span class="st">'Date'</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">'rented_bike_count'</span> <span class="ot">=</span> <span class="st">'Rented Bike Count'</span>,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">'hour'</span> <span class="ot">=</span> <span class="st">'Hour'</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>         <span class="st">'celcius_temp'</span> <span class="ot">=</span> <span class="st">'Temperature(°C)'</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>         <span class="st">'percent_humidity'</span><span class="ot">=</span><span class="st">'Humidity(%)'</span>,</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>         <span class="st">'wind_speed'</span><span class="ot">=</span> <span class="st">'Wind speed (m/s)'</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>         <span class="st">'visib'</span><span class="ot">=</span><span class="st">'Visibility (10m)'</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>         <span class="st">'dew_point_temp'</span> <span class="ot">=</span> <span class="st">'Dew point temperature(°C)'</span>,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>         <span class="st">'solar_rad'</span><span class="ot">=</span><span class="st">'Solar Radiation (MJ/m2)'</span>,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">'rainfall'</span> <span class="ot">=</span> <span class="st">'Rainfall(mm)'</span>,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">'snowfall'</span> <span class="ot">=</span> <span class="st">'Snowfall (cm)'</span>,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>         <span class="st">'seasons'</span> <span class="ot">=</span> <span class="st">'Seasons'</span>,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>         <span class="st">'holiday'</span> <span class="ot">=</span> <span class="st">'Holiday'</span>,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>         <span class="st">'function_day'</span> <span class="ot">=</span> <span class="st">'Functioning Day'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Onto creating summary statistics. The first contingency table is the data grouped by Functioning Day across Rented Bike Count with descriptive summaries of mean, median, variance, standard deviation, and interquartile range.</p>
<p>Wow! When functioning day is ‘no’, there were no bike rentals. Bike rentals only occurred on functioning days of ‘yes’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(function_day) <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"var"</span> <span class="ot">=</span> var, </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> sd, </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"IQR"</span> <span class="ot">=</span> IQR), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  function_day mean_rented_bike_count median_rented_bike_count
  &lt;fct&gt;                         &lt;dbl&gt;                    &lt;dbl&gt;
1 No                               0                         0
2 Yes                            729.                      542
# ℹ 3 more variables: var_rented_bike_count &lt;dbl&gt;, sd_rented_bike_count &lt;dbl&gt;,
#   IQR_rented_bike_count &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This time, we will only look at functioning days of ‘yes’ where we summarize grouped by seasons and holiday variables. All four seasons have rented bike counts associated with them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasons, holiday) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(function_day <span class="sc">==</span> <span class="st">'Yes'</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"var"</span> <span class="ot">=</span> var, </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"sd"</span> <span class="ot">=</span> sd, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"IQR"</span> <span class="ot">=</span> IQR), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'seasons'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 7
# Groups:   seasons [4]
  seasons holiday    mean_rented_bike_count median_rented_bike_count
  &lt;fct&gt;   &lt;fct&gt;                       &lt;dbl&gt;                    &lt;dbl&gt;
1 Autumn  Holiday                      948.                     900 
2 Autumn  No Holiday                   923.                     852 
3 Spring  Holiday                      635.                     366.
4 Spring  No Holiday                   750.                     605 
5 Summer  Holiday                     1022.                     925 
6 Summer  No Holiday                  1034.                     904.
7 Winter  Holiday                      157.                     138 
8 Winter  No Holiday                   232.                     212 
# ℹ 3 more variables: var_rented_bike_count &lt;dbl&gt;, sd_rented_bike_count &lt;dbl&gt;,
#   IQR_rented_bike_count &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now, we’ll summarize across the hours so that each day has one observation associated with it. We are grouping by Date.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(function_day <span class="sc">==</span> <span class="st">'Yes'</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(rented_bike_count, <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean, </span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="st">"median"</span> <span class="ot">=</span> median), <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 353 × 3
   date       mean_rented_bike_count median_rented_bike_count
   &lt;chr&gt;                       &lt;dbl&gt;                    &lt;dbl&gt;
 1 01/01/2018                   179.                    174. 
 2 01/02/2018                   224.                    238. 
 3 01/03/2018                   214.                    190. 
 4 01/04/2018                   724.                    662. 
 5 01/05/2018                  1118.                   1092  
 6 01/06/2018                  1330.                   1156  
 7 01/07/2018                   135.                     22.5
 8 01/08/2018                   863                     673  
 9 01/09/2018                  1084.                   1034. 
10 01/10/2018                  1163.                   1122. 
# ℹ 343 more rows</code></pre>
</div>
</div>
<p>Now let’s group across date, seasons, and holiday variables for the sums of rented bike count, rainfall, and snowfall and the averages of the weather variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>new_bike_data <span class="ot">&lt;-</span> seoul_bike_data <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date, seasons, holiday) <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">c</span>(rented_bike_count,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>                     rainfall,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>                     snowfall), </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns=</span><span class="fu">list</span>(<span class="st">'sum'</span><span class="ot">=</span>sum), </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">across</span>(<span class="fu">c</span>(celcius_temp, </span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>                     percent_humidity,</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>                     wind_speed,</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>                     visib,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                     dew_point_temp, </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>                     solar_rad, </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                     rainfall,</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                     snowfall), </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="fu">list</span>(<span class="st">"mean"</span> <span class="ot">=</span> mean), </span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.names =</span> <span class="st">"{.fn}_{.col}"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">dmy</span>(date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'date', 'seasons'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>new_bike_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 14
# Groups:   date, seasons [365]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter  Holiday                     4290          0            0  
 2 2018-02-01 Winter  No Holiday                  5377          0           21.7
 3 2018-03-01 Spring  Holiday                     5132          2.5          0  
 4 2018-04-01 Spring  No Holiday                 17388          0            0  
 5 2018-05-01 Spring  Holiday                    26820          0            0  
 6 2018-06-01 Summer  No Holiday                 31928          0            0  
 7 2018-07-01 Summer  No Holiday                  3231         81            0  
 8 2018-08-01 Summer  No Holiday                 20712          0            0  
 9 2018-09-01 Autumn  No Holiday                 26010          0            0  
10 2018-10-01 Autumn  No Holiday                 27909          0            0  
# ℹ 355 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now let’s use this data to recreate those basic summary statistics and then create some plots to explore relationships.</p>
<p>First, we will create a contingency table of seasons and holiday variables. Most rented bike counts occurred on ‘not’ holidays. The highest count of rentals is in the summer for ‘not’ holidays and winter for holidays.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>new_bike_data <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(seasons, holiday)<span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> holiday, <span class="at">values_from =</span> count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'seasons'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
# Groups:   seasons [4]
  seasons Holiday `No Holiday`
  &lt;fct&gt;     &lt;int&gt;        &lt;int&gt;
1 Autumn        5           86
2 Spring        3           89
3 Summer        2           90
4 Winter        8           82</code></pre>
</div>
</div>
<p>We can use psych’s describe() function again to get numeric summaries on this new data, like before.</p>
<p>I also defined the numeric variables in the data as num_vars for easier use later.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">describe</span>(new_bike_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(newX[, i], ...): no non-missing arguments to min; returning Inf</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in FUN(newX[, i], ...): no non-missing arguments to max; returning -Inf</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                      vars   n     mean       sd   median  trimmed      mad
date                     1 365      NaN       NA       NA      NaN       NA
seasons*                 2 365     2.50     1.12     2.00     2.49     1.48
holiday*                 3 365     1.95     0.22     2.00     2.00     0.00
sum_rented_bike_count    4 365 16910.45 10258.64 17730.00 16859.32 14654.02
sum_rainfall             5 365     3.57    11.85     0.00     0.60     0.00
sum_snowfall             6 365     1.80     8.66     0.00     0.00     0.00
mean_celcius_temp        7 365    12.88    11.56    13.84    13.20    13.50
mean_percent_humidity    8 365    58.23    14.67    57.21    57.75    14.70
mean_wind_speed          9 365     1.72     0.60     1.64     1.66     0.50
mean_visib              10 365  1436.83   491.25  1557.75  1486.04   565.49
mean_dew_point_temp     11 365     4.07    12.81     5.01     4.67    14.39
mean_solar_rad          12 365     0.57     0.31     0.56     0.56     0.41
mean_rainfall           13 365     0.15     0.49     0.00     0.02     0.00
mean_snowfall           14 365     0.08     0.36     0.00     0.00     0.00
                         min      max    range  skew kurtosis     se
date                     Inf     -Inf     -Inf    NA       NA     NA
seasons*                1.00     4.00     3.00  0.00    -1.36   0.06
holiday*                1.00     2.00     1.00 -4.15    15.23   0.01
sum_rented_bike_count   0.00 36149.00 36149.00 -0.03    -1.39 536.96
sum_rainfall            0.00    95.50    95.50  4.85    26.25   0.62
sum_snowfall            0.00    78.70    78.70  5.94    37.97   0.45
mean_celcius_temp     -14.74    33.74    48.48 -0.24    -0.91   0.60
mean_percent_humidity  22.25    95.88    73.62  0.26    -0.28   0.77
mean_wind_speed         0.66     4.00     3.34  1.07     1.18   0.03
mean_visib            214.29  2000.00  1785.71 -0.63    -0.74  25.71
mean_dew_point_temp   -27.75    25.04    52.79 -0.32    -0.82   0.67
mean_solar_rad          0.03     1.22     1.19  0.18    -1.08   0.02
mean_rainfall           0.00     3.98     3.98  4.85    26.25   0.03
mean_snowfall           0.00     3.28     3.28  5.94    37.97   0.02</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> new_bike_data <span class="sc">|&gt;</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(sum_rented_bike_count, sum_rainfall, sum_snowfall, mean_celcius_temp, mean_percent_humidity, mean_wind_speed, mean_visib, mean_dew_point_temp, mean_solar_rad, mean_rainfall, mean_snowfall)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `date`, `seasons`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>num_vars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 365 × 13
# Groups:   date, seasons [365]
   date       seasons sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;                   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-01-01 Winter                   4290          0            0  
 2 2018-02-01 Winter                   5377          0           21.7
 3 2018-03-01 Spring                   5132          2.5          0  
 4 2018-04-01 Spring                  17388          0            0  
 5 2018-05-01 Spring                  26820          0            0  
 6 2018-06-01 Summer                  31928          0            0  
 7 2018-07-01 Summer                   3231         81            0  
 8 2018-08-01 Summer                  20712          0            0  
 9 2018-09-01 Autumn                  26010          0            0  
10 2018-10-01 Autumn                  27909          0            0  
# ℹ 355 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now to plot… Let’s look at the rented bike count sums by date and holiday! Both the scatterplot and the overlapping holiday linear regression plots show an increase in the rental counts as the year goes on.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>date, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>holiday)) <span class="sc">+</span> </span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%B %d, %Y"</span>) <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Date'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_rainfall, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_visib)) <span class="sc">+</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Rainfall and Mean Visibility in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Rainfall - mm'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now let’s check where the x axis is mean snowfall and mean wind speed. The majority of bike rentals occur when there is no snowfall and low wind speed. There are a few dates with snowfall and rentals, but they mostly have lower wind speeds.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_snowfall, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_wind_speed)) <span class="sc">+</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Snowfall and Mean Wind Speed in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Rainfall - mm'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>OOOh, a correlation matrix of the numeric variables we defined before.</p>
<p>As expected, mean rainfall and sum rainfall are very correlated, as well as mean snowfall and sum snowfall.</p>
<p>Mean Celcius Temp and Mean Dew Point Temp are also super correlated (0.96).</p>
<p>The most correlated variable with the Sum Rented Bike Count is Mean Celcius Temp. Let’s look at this and the next most correlated variable: solar radiation!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">correlate</span>(num_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Non-numeric variables removed from input: `date`, and `seasons`
Correlation computed with
• Method: 'pearson'
• Missing treated using: 'pairwise.complete.obs'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">shave</span>(cor_matrix)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rplot</span>(cor_matrix, <span class="at">print_cor =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">60</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `aes_string()` was deprecated in ggplot2 3.0.0.
ℹ Please use tidy evaluation idioms with `aes()`.
ℹ See also `vignette("ggplot2-in-packages")` for more information.
ℹ The deprecated feature was likely used in the corrr package.
  Please report the issue at &lt;https://github.com/tidymodels/corrr/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is certainly a correlated relationship! The higher temperature has higher rental counts and higher solar radiation. Who would have thought?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_celcius_temp, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_solar_rad)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Temperature and Mean Solar Radiation </span><span class="sc">\n</span><span class="st">in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Temperature in Celcius'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Makes sense, because dew point temperature looks to be correlated as well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(new_bike_data, </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>mean_celcius_temp, <span class="at">y=</span>sum_rented_bike_count, <span class="at">color=</span>mean_dew_point_temp)) <span class="sc">+</span> </span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Rented Bike Count Summed per Day Versus </span><span class="sc">\n</span><span class="st">Mean Temperature and Mean Dew Point Temperature </span><span class="sc">\n</span><span class="st">in Seoul Scatterplot'</span>, <span class="at">x=</span><span class="st">'Temperature in Celcius'</span>,<span class="at">y=</span><span class="st">'Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="split-the-data" class="level1">
<h1>Split the Data</h1>
<p>Here, we can use functions from tidymodels to split the data into a training and test set (75/25 split). By using the strata argument, we can stratify the split on the seasons variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.4.1 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.10     ✔ rsample      1.3.1 
✔ dials        1.4.2      ✔ tailor       0.1.0 
✔ infer        1.0.9      ✔ tune         2.0.1 
✔ modeldata    1.5.1      ✔ workflows    1.3.0 
✔ parsnip      1.3.3      ✔ workflowsets 1.1.1 
✔ recipes      1.3.1      ✔ yardstick    1.3.2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ psych::%+%()      masks ggplot2::%+%()
✖ scales::alpha()   masks psych::alpha(), ggplot2::alpha()
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>seoul_data <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(new_bike_data, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata=</span>seasons)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>seoul_train <span class="ot">&lt;-</span> <span class="fu">training</span>(seoul_data)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>seoul_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 273 × 14
# Groups:   date, seasons [273]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-09-01 Autumn  No Holiday                 26010          0              0
 2 2018-10-01 Autumn  No Holiday                 27909          0              0
 3 2018-11-01 Autumn  No Holiday                 22964          0              0
 4 2018-09-02 Autumn  No Holiday                 26881          0              0
 5 2018-10-02 Autumn  No Holiday                     0          0              0
 6 2018-09-03 Autumn  No Holiday                 10802         34.5            0
 7 2018-10-03 Autumn  Holiday                    30349          0              0
 8 2018-09-04 Autumn  No Holiday                 29529          0              0
 9 2018-10-04 Autumn  No Holiday                     0          0              0
10 2018-11-05 Autumn  No Holiday                 23472          0              0
# ℹ 263 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>seoul_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(seoul_data)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>seoul_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92 × 14
# Groups:   date, seasons [92]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-04-01 Spring  No Holiday                 17388          0              0
 2 2018-07-01 Summer  No Holiday                  3231         81              0
 3 2018-04-02 Spring  No Holiday                 21585          0              0
 4 2018-05-02 Spring  No Holiday                  7448         12              0
 5 2018-11-02 Autumn  No Holiday                 24077          0              0
 6 2017-12-02 Winter  No Holiday                  8523          0              0
 7 2018-06-03 Summer  No Holiday                 29761          0              0
 8 2018-11-03 Autumn  No Holiday                     0          0              0
 9 2018-11-04 Autumn  No Holiday                 20471          0              0
10 2017-12-04 Winter  No Holiday                  8729          0.1            0
# ℹ 82 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Now we can look further into the training set and create a 10 fold CV split.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(seoul_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 273</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>size_fold <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">nrow</span>(seoul_train)<span class="sc">/</span><span class="dv">10</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>size_fold</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>random_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(seoul_train), <span class="at">size =</span> <span class="fu">nrow</span>(seoul_train), <span class="at">replace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="co">#see the random reordering</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(random_indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 183 226  79  12 119 170</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create a list to save our folds in</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co">#now cycle through our random indices vector and take the appropriate observations to each fold</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#you may want to set i to 1 and run the arguments to from and to in the seq() function</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="co">#change i to 2 and do the same thing to see how this works</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">&lt;</span> <span class="dv">10</span>) {</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>    fold_index <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> (i<span class="dv">-1</span>)<span class="sc">*</span>size_fold <span class="sc">+</span><span class="dv">1</span>, <span class="at">to =</span> i<span class="sc">*</span>size_fold, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    folds[[i]] <span class="ot">&lt;-</span> seoul_train[random_indices[fold_index], ]</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="co">#for i = 10 we need to have 1 more observation </span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    fold_index <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> (i<span class="dv">-1</span>)<span class="sc">*</span>size_fold <span class="sc">+</span><span class="dv">1</span>, <span class="at">to =</span> <span class="fu">length</span>(random_indices), <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    folds[[i]] <span class="ot">&lt;-</span> seoul_train[random_indices[fold_index], ]</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>folds[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 14
# Groups:   date, seasons [27]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-06-21 Summer  No Holiday                 34621          0            0  
 2 2018-01-10 Winter  No Holiday                  4161          0.8         10.2
 3 2018-03-07 Spring  No Holiday                 11170          0            0  
 4 2018-09-07 Autumn  No Holiday                 30381          1.5          0  
 5 2018-05-23 Spring  No Holiday                 27674         10            0  
 6 2018-07-14 Summer  No Holiday                 25814          0            0  
 7 2018-02-12 Winter  No Holiday                  4813          0            0  
 8 2018-01-20 Winter  No Holiday                  5576          0            0  
 9 2018-01-22 Winter  No Holiday                  4503          3.3          6.2
10 2018-01-07 Winter  No Holiday                  4714          0            0  
# ℹ 17 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>folds[[<span class="dv">2</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 14
# Groups:   date, seasons [27]
   date       seasons holiday    sum_rented_bike_count sum_rainfall sum_snowfall
   &lt;date&gt;     &lt;fct&gt;   &lt;fct&gt;                      &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1 2018-03-25 Spring  No Holiday                 10963            0            0
 2 2018-10-29 Autumn  No Holiday                 19877            0            0
 3 2018-11-22 Autumn  No Holiday                 16496            0            0
 4 2018-06-06 Summer  Holiday                    30498            0            0
 5 2018-07-23 Summer  No Holiday                 24890            0            0
 6 2018-04-09 Spring  No Holiday                 19082            0            0
 7 2017-12-16 Winter  No Holiday                  4632            0            0
 8 2018-05-14 Spring  No Holiday                 27793            0            0
 9 2018-04-24 Spring  No Holiday                 20144            3            0
10 2018-01-11 Winter  No Holiday                  4017            0            0
# ℹ 17 more rows
# ℹ 8 more variables: mean_celcius_temp &lt;dbl&gt;, mean_percent_humidity &lt;dbl&gt;,
#   mean_wind_speed &lt;dbl&gt;, mean_visib &lt;dbl&gt;, mean_dew_point_temp &lt;dbl&gt;,
#   mean_solar_rad &lt;dbl&gt;, mean_rainfall &lt;dbl&gt;, mean_snowfall &lt;dbl&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#training data</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>train_list <span class="ot">&lt;-</span> folds</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(train_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 10</code></pre>
</div>
</div>
</section>
<section id="fitting-mlr-models" class="level1">
<h1>Fitting MLR Models</h1>
<p>First, let’s create some recipes for our different models. For the 1st recipe: we’re ignoring the date variable for modeling (day_type) and removing it after we create a weekday/weekend (factor) variable. We can use step_normalize to standardize the numeric variables since their scales are pretty different and create dummy variables for the seasons, holiday, and our new day type variable using step_dummy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_1 <span class="ot">&lt;-</span> </span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)</span>
<span id="cb74-16"><a href="#cb74-16" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
</div>
<p>For the 2nd recipe we are beginning with the same steps as before, but also adding in interactions between seasons and holiday, seasons and temp, temp and rainfall.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_2 <span class="ot">&lt;-</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)<span class="sc">|&gt;</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a><span class="fu">step_interact</span>(</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="sc">~</span> (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span><span class="st">`</span><span class="at">holiday_No.Holiday</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a>           (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span>mean_celcius_temp <span class="sc">+</span></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a>           mean_celcius_temp<span class="sc">:</span>mean_rainfall</span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: ...</code></pre>
</div>
</div>
<p>For the 3rd recipe: we are adding in quadratic terms for each numeric predictor using step_poly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_3 <span class="ot">&lt;-</span> </span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(sum_rented_bike_count <span class="sc">~</span> ., <span class="at">data=</span>seoul_train) <span class="sc">|&gt;</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(date, <span class="at">new_role =</span> <span class="st">'ID'</span>) <span class="sc">|&gt;</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_mutate</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_name =</span> <span class="fu">wday</span>(date, <span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">day_type =</span> <span class="fu">factor</span>(</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>        day_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'Mon'</span>, <span class="st">'Tue'</span>, <span class="st">'Wed'</span>,<span class="st">'Thu'</span>,<span class="st">'Fri'</span>), </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekday'</span>,</span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'Weekend'</span>)</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(seasons, holiday, day_type, <span class="at">one_hot =</span> <span class="cn">FALSE</span>)<span class="sc">|&gt;</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(day_name)<span class="sc">|&gt;</span></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">terms =</span> <span class="sc">~</span> (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span><span class="st">`</span><span class="at">holiday_No.Holiday</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>           (<span class="st">`</span><span class="at">seasons_Spring</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Summer</span><span class="st">`</span> <span class="sc">+</span> <span class="st">`</span><span class="at">seasons_Winter</span><span class="st">`</span>)<span class="sc">:</span>mean_celcius_temp <span class="sc">+</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>           mean_celcius_temp<span class="sc">:</span>mean_rainfall</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>)<span class="sc">|&gt;</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(sum_rainfall, sum_snowfall, mean_celcius_temp, mean_percent_humidity, </span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>          mean_wind_speed, mean_visib, mean_dew_point_temp, mean_solar_rad, </span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>          mean_rainfall, mean_snowfall, <span class="at">degree =</span> <span class="dv">2</span>) </span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a>seoul_train_rec_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Recipe ──────────────────────────────────────────────────────────────────────</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Inputs </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Number of variables by role</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outcome:    1
predictor: 12
ID:         1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Operations </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variable mutation for: wday(date, label = TRUE), ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Dummy variables from: seasons, holiday, day_type</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Centering and scaling for: all_numeric_predictors()</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Variables removed: day_name</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Interactions with: ...</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>• Polynomial expansion on: sum_rainfall sum_snowfall, ...</code></pre>
</div>
</div>
<p>Now we will set up our linear model fit to use the “lm” engine as seoul_mod.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>seoul_mod <span class="ot">&lt;-</span><span class="fu">linear_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'lm'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can use this to create a workflow using the recipe and this model (for all three models).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl1 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl2 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_2) <span class="sc">|&gt;</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
5 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()
• step_interact()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl3 <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_3) <span class="sc">|&gt;</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(seoul_mod)</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>seoul_wfl3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
6 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()
• step_interact()
• step_poly()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Computational engine: lm </code></pre>
</div>
</div>
<p>Let’s check out the fits on the training data using the three different workflows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>seoul_fit1 <span class="ot">&lt;-</span> seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>seoul_fit1 <span class="sc">|&gt;</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)             16980.      318.    53.3    1.12e-141
 2 sum_rainfall            -1812.      424.    -4.27   2.74e-  5
 3 sum_snowfall             -257.      348.    -0.737  4.62e-  1
 4 mean_celcius_temp       -1659.     6072.    -0.273  7.85e-  1
 5 mean_percent_humidity   -1422.     2231.    -0.637  5.25e-  1
 6 mean_wind_speed          -900.      368.    -2.44   1.52e-  2
 7 mean_visib               -310.      456.    -0.681  4.96e-  1
 8 mean_dew_point_temp      5142.     7042.     0.730  4.66e-  1
 9 mean_solar_rad           4365.      593.     7.36   2.42e- 12
10 mean_rainfall              NA        NA     NA     NA        
11 mean_snowfall              NA        NA     NA     NA        
12 seasons_Spring          -1478.      450.    -3.28   1.17e-  3
13 seasons_Summer           -547.      536.    -1.02   3.09e-  1
14 seasons_Winter          -3093.      603.    -5.13   5.80e-  7
15 holiday_No.Holiday        966.      326.     2.97   3.29e-  3
16 day_type_Weekend        -1247.      328.    -3.80   1.83e-  4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>seoul_fit2 <span class="ot">&lt;-</span> seoul_wfl2 <span class="sc">|&gt;</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>seoul_fit2 <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 23 × 5
   term                  estimate std.error statistic   p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)             21433.      841.    25.5    9.51e-72
 2 sum_rainfall            -2608.      572.    -4.56   8.08e- 6
 3 sum_snowfall             -229.      307.    -0.746  4.56e- 1
 4 mean_celcius_temp       -1707.     5611.    -0.304  7.61e- 1
 5 mean_percent_humidity    -989.     2062.    -0.480  6.32e- 1
 6 mean_wind_speed          -602.      328.    -1.83   6.80e- 2
 7 mean_visib                138.      430.     0.320  7.49e- 1
 8 mean_dew_point_temp      3509.     6491.     0.541  5.89e- 1
 9 mean_solar_rad           3691.      530.     6.96   2.91e-11
10 mean_rainfall              NA        NA     NA     NA       
# ℹ 13 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>seoul_fit3 <span class="ot">&lt;-</span> seoul_wfl3 <span class="sc">|&gt;</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>seoul_fit3<span class="sc">|&gt;</span></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 33 × 5
   term                                estimate std.error statistic  p.value
   &lt;chr&gt;                                  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
 1 (Intercept)                           22545.     2369.     9.52  1.81e-18
 2 seasons_Spring                        -1051.      410.    -2.56  1.09e- 2
 3 seasons_Summer                         7846.     1506.     5.21  4.02e- 7
 4 seasons_Winter                        -2528.     1607.    -1.57  1.17e- 1
 5 holiday_No.Holiday                      959.      315.     3.04  2.58e- 3
 6 day_type_Weekend                      -1195.      289.    -4.13  5.03e- 5
 7 seasons_Spring_x_holiday_No.Holiday    -481.      393.    -1.22  2.22e- 1
 8 seasons_Summer_x_holiday_No.Holiday    -341.      418.    -0.816 4.15e- 1
 9 seasons_Winter_x_holiday_No.Holiday    -386.      312.    -1.24  2.17e- 1
10 seasons_Spring_x_mean_celcius_temp     3184.      760.     4.19  3.91e- 5
# ℹ 23 more rows</code></pre>
</div>
</div>
<p>We can fit the models using 10 fold CV via fit_resamples() and look at the training set CV error to choose a best model—looks like the model 1!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>seoul_10_fold <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(seoul_train, <span class="dv">10</span>)</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>cv_fits1 <span class="ot">&lt;-</span> seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>cv_fits2 <span class="ot">&lt;-</span> seoul_wfl2 <span class="sc">|&gt;</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>cv_fits3 <span class="ot">&lt;-</span> seoul_wfl3 <span class="sc">|&gt;</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(cv_fits1 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>),</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>      cv_fits2 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>),</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a>      cv_fits3 <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model=</span> <span class="fu">c</span>(<span class="st">'Model 1'</span>, <span class="st">'Model 2'</span>, <span class="st">'Model 3'</span>)) <span class="sc">|&gt;</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Model, mean, n, std_err)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Model    mean     n std_err
  &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 Model 1 5265.    10    353.
2 Model 2 4555.    10    449.
3 Model 3 4466.    10    460.</code></pre>
</div>
</div>
<p>Model 1 is the ‘best’ model, so let’s fit the model to the entire training data set. The 2x4 tibble is the computed RMSE (and RSQ) metric on the test set.</p>
<p>The final model is fit on the entire training set and its coefficient table is the final displayed tibble (using extract_fit_parsnip() and tidy()).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(seoul_wfl1, <span class="at">split=</span>seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1
There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(best_mod_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       7068. pre0_mod0_post0
2 mae     standard       4801. pre0_mod0_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)             16980.      318.    53.3    1.12e-141
 2 sum_rainfall            -1812.      424.    -4.27   2.74e-  5
 3 sum_snowfall             -257.      348.    -0.737  4.62e-  1
 4 mean_celcius_temp       -1659.     6072.    -0.273  7.85e-  1
 5 mean_percent_humidity   -1422.     2231.    -0.637  5.25e-  1
 6 mean_wind_speed          -900.      368.    -2.44   1.52e-  2
 7 mean_visib               -310.      456.    -0.681  4.96e-  1
 8 mean_dew_point_temp      5142.     7042.     0.730  4.66e-  1
 9 mean_solar_rad           4365.      593.     7.36   2.42e- 12
10 mean_rainfall              NA        NA     NA     NA        
11 mean_snowfall              NA        NA     NA     NA        
12 seasons_Spring          -1478.      450.    -3.28   1.17e-  3
13 seasons_Summer           -547.      536.    -1.02   3.09e-  1
14 seasons_Winter          -3093.      603.    -5.13   5.80e-  7
15 holiday_No.Holiday        966.      326.     2.97   3.29e-  3
16 day_type_Weekend        -1247.      328.    -3.80   1.83e-  4</code></pre>
</div>
</div>
<p>I would be interested to learn more about why the p value of mean_solar_rad is so small, followed by rainfall and wind speed.</p>
<p>Overall, interesting assignment!</p>
</section>
<section id="homework-9-begins-here" class="level1">
<h1>Homework 9 Begins Here</h1>
<p>We will use the first recipe (seoul_train_rec_1) from homework 8 with no quadratics nor interactions to tune our <strong>LASSO Model</strong>. Let’s use the glmnet engine and the linear_reg function with a mixture of 1 (specifies LASSO instead of Elastic Net) and an opportunity to tune the penalty with a resampling method.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>LASSO_Seoul <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture=</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'glmnet'</span>)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(LASSO_Seoul)</span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>LASSO_wkf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)

Main Arguments:
  penalty = tune()
  mixture = 1

Computational engine: glmnet </code></pre>
</div>
</div>
<p>Now, we can great a grid that tunes based on the resamples of the CV-10-fold with 200 levels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>LASSO_grid <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold, </span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">200</span>),</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s plot these grid results with the RMSE metric… Looks like all the RMSE values are the same!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>LASSO_grid <span class="sc">|&gt;</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">'rmse'</span>) <span class="sc">|&gt;</span></span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">color=</span>.metric)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span><span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'LASSO Grid results for Means associated with Penalty Options'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Let’s pull out the ‘best’ model using select_best() by RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>lowest_rmse_LASSO <span class="ot">&lt;-</span> LASSO_grid <span class="sc">|&gt;</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>lowest_rmse_LASSO</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
       penalty .config          
         &lt;dbl&gt; &lt;chr&gt;            
1 0.0000000001 pre0_mod001_post0</code></pre>
</div>
</div>
<p>Now we can fit that ‘best’ LASSO model on the entire training set, seoul_train. finalize_workflow() has captured the tuned model we defined before.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lowest_rmse_LASSO) <span class="sc">|&gt;</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(seoul_train)</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(LASSO_final)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-10</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   term                  estimate      penalty
   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;
 1 (Intercept)             16980. 0.0000000001
 2 sum_rainfall            -1377. 0.0000000001
 3 sum_snowfall             -173. 0.0000000001
 4 mean_celcius_temp         391. 0.0000000001
 5 mean_percent_humidity    -670. 0.0000000001
 6 mean_wind_speed          -894. 0.0000000001
 7 mean_visib               -268. 0.0000000001
 8 mean_dew_point_temp      2736. 0.0000000001
 9 mean_solar_rad           4348. 0.0000000001
10 mean_rainfall            -485. 0.0000000001
11 mean_snowfall            -101. 0.0000000001
12 seasons_Spring          -1475. 0.0000000001
13 seasons_Summer           -525. 0.0000000001
14 seasons_Winter          -3065. 0.0000000001
15 holiday_No.Holiday        961. 0.0000000001
16 day_type_Weekend        -1260. 0.0000000001</code></pre>
</div>
</div>
<p>Now we can compare the chosen model on the test set using last_fit() and see the differences between our MLR model from Homework 8 and this LASSO model. It appears that the MLR Model outperforms the LASSO Model slightly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a>seoul_wfl1 <span class="sc">|&gt;</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data) <span class="sc">|&gt;</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>→ A | warning: prediction from rank-deficient fit; consider predict(., rankdeficient="NA")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>There were issues with some computations   A: x1
There were issues with some computations   A: x1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code></code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    7068.    pre0_mod0_post0
2 rsq     standard       0.556 pre0_mod0_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lowest_rmse_LASSO) <span class="sc">|&gt;</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data) <span class="sc">|&gt;</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard    7071.    pre0_mod0_post0
2 rsq     standard       0.556 pre0_mod0_post0</code></pre>
</div>
</div>
<p>Let’s check out the RMSE of the model when predicting on a new set of data: the test data. That’s the same RMSE as on the combined data. Let’s confirm and ‘finalize’ that model using finalize_workflow and collect metrics on it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="sc">|&gt;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(seoul_test) <span class="sc">|&gt;</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">|&gt;</span></span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse_vec</span>(<span class="at">truth =</span> seoul_test<span class="sc">$</span>sum_rented_bike_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7071.068</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a>LASSO_wkf <span class="ot">&lt;-</span> LASSO_wkf <span class="sc">|&gt;</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(<span class="fu">tibble</span>(<span class="at">penalty =</span> lowest_rmse_LASSO<span class="sc">$</span>penalty)) </span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>LASSO_model <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(LASSO_wkf, <span class="at">split=</span>seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>LASSO_model<span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       7071. pre0_mod0_post0
2 mae     standard       4821. pre0_mod0_post0</code></pre>
</div>
</div>
<p>To tuning a <strong>Regression Tree</strong> model…</p>
<p>We can use decision_tree from the tree package this time, with the rpart engine specified for regression. Let’s tune for the tree_depth and cost_complexity and follow similar steps to the LASSO model, using the recipe from homework 8.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tree)</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>tree_mod <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">20</span>,</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>tree_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tree_mod)</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>temp_tree <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span> </span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae)) <span class="co">#uses defaults from dials</span></span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>temp_tree <span class="sc">|&gt;</span> </span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          5 mae     standard   3648.    10    224. pre0_mod01…
 2    0.0000000001          5 rmse    standard   5328.    10    426. pre0_mod01…
 3    0.000000001          11 mae     standard   3754.    10    252. pre0_mod02…
 4    0.000000001          11 rmse    standard   5448.    10    438. pre0_mod02…
 5    0.00000001            1 mae     standard   5648.    10    401. pre0_mod03…
 6    0.00000001            1 rmse    standard   7365.    10    512. pre0_mod03…
 7    0.0000001             7 mae     standard   3757.    10    252. pre0_mod04…
 8    0.0000001             7 rmse    standard   5449.    10    439. pre0_mod04…
 9    0.000001             13 mae     standard   3754.    10    252. pre0_mod05…
10    0.000001             13 rmse    standard   5448.    10    438. pre0_mod05…
11    0.00001               2 mae     standard   4400.    10    240. pre0_mod06…
12    0.00001               2 rmse    standard   6069.    10    399. pre0_mod06…
13    0.0001                8 mae     standard   3753.    10    252. pre0_mod07…
14    0.0001                8 rmse    standard   5447.    10    438. pre0_mod07…
15    0.001                15 mae     standard   3735.    10    247. pre0_mod08…
16    0.001                15 rmse    standard   5440.    10    440. pre0_mod08…
17    0.01                  4 mae     standard   3760.    10    230. pre0_mod09…
18    0.01                  4 rmse    standard   5421.    10    460. pre0_mod09…
19    0.1                  10 mae     standard   4697.    10    284. pre0_mod10…
20    0.1                  10 rmse    standard   6368.    10    429. pre0_mod10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span> </span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> tree_grid,</span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          1 mae     standard   5648.    10    401. pre0_mod01…
 2    0.0000000001          1 rmse    standard   7365.    10    512. pre0_mod01…
 3    0.0000000001          4 mae     standard   3759.    10    231. pre0_mod02…
 4    0.0000000001          4 rmse    standard   5451.    10    462. pre0_mod02…
 5    0.0000000001          8 mae     standard   3754.    10    252. pre0_mod03…
 6    0.0000000001          8 rmse    standard   5448.    10    438. pre0_mod03…
 7    0.0000000001         11 mae     standard   3754.    10    252. pre0_mod04…
 8    0.0000000001         11 rmse    standard   5448.    10    438. pre0_mod04…
 9    0.0000000001         15 mae     standard   3754.    10    252. pre0_mod05…
10    0.0000000001         15 rmse    standard   5448.    10    438. pre0_mod05…
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>Our best tree fit selected with the RMSE in mind has a cost complexity of 0.001 and a tree depth of 4. We can finalize that workflow and plot it to a tree plot! So fun.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>tree_fits <span class="sc">|&gt;</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"rmse"</span>) <span class="sc">|&gt;</span></span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1          0.01            8 rmse    standard   5291.    10    470. pre0_mod43…
 2          0.01           11 rmse    standard   5291.    10    470. pre0_mod44…
 3          0.01           15 rmse    standard   5291.    10    470. pre0_mod45…
 4          0.01            4 rmse    standard   5421.    10    460. pre0_mod42…
 5          0.001           8 rmse    standard   5440.    10    440. pre0_mod38…
 6          0.001          11 rmse    standard   5440.    10    440. pre0_mod39…
 7          0.001          15 rmse    standard   5440.    10    440. pre0_mod40…
 8          0.001           4 rmse    standard   5447.    10    463. pre0_mod37…
 9          0.0001          8 rmse    standard   5447.    10    438. pre0_mod33…
10          0.0001         11 rmse    standard   5447.    10    438. pre0_mod34…
# ℹ 40 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>tree_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(tree_fits, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>tree_best_params</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  cost_complexity tree_depth .config         
            &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;           
1            0.01          8 pre0_mod43_post0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a>tree_final_wkf <span class="ot">&lt;-</span> tree_wkf <span class="sc">|&gt;</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(tree_best_params)</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="ot">&lt;-</span> tree_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>tree_final_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits           id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;           &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [273/92]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a>tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       7310. pre0_mod0_post0
2 mae     standard       4649. pre0_mod0_post0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>tree_final_model <span class="ot">&lt;-</span> <span class="fu">extract_workflow</span>(tree_final_fit) </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>tree_final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: decision_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
n= 273 

node), split, n, deviance, yval
      * denotes terminal node

  1) root 273 28087280000 16980.290  
    2) mean_celcius_temp&lt; -0.6367902 84   949702900  6378.452  
      4) seasons_Winter&gt;=0.5904959 67   165245700  5107.000 *
      5) seasons_Winter&lt; 0.5904959 17   249270500 11389.470 *
    3) mean_celcius_temp&gt;=-0.6367902 189 13499830000 21692.220  
      6) mean_solar_rad&lt; -0.3704764 48  2758063000 13159.290  
       12) mean_solar_rad&lt; -1.099996 20   470045600  8461.700 *
       13) mean_solar_rad&gt;=-1.099996 28  1531422000 16514.710  
         26) mean_percent_humidity&lt; 0.1982611 8   451214400 11283.380 *
         27) mean_percent_humidity&gt;=0.1982611 20   773697900 18607.250 *
      7) mean_solar_rad&gt;=-0.3704764 141  6057085000 24597.050  
       14) mean_celcius_temp&lt; 0.5227651 64  2960141000 21160.950  
         28) mean_wind_speed&gt;=-0.2280431 38  1768246000 19205.820  
           56) mean_solar_rad&lt; 1.009537 25  1032153000 16290.120  
            112) mean_solar_rad&gt;=0.3753711 14   526041800 13095.500 *
            113) mean_solar_rad&lt; 0.3753711 11   181388000 20356.000 *
           57) mean_solar_rad&gt;=1.009537 13   114845100 24812.920 *
         29) mean_wind_speed&lt; -0.2280431 26   834338900 24018.460 *
       15) mean_celcius_temp&gt;=0.5227651 77  1713253000 27453.030  
         30) mean_celcius_temp&gt;=1.411465 23   183217100 21947.170 *
         31) mean_celcius_temp&lt; 1.411465 54   535835700 29798.110 *</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>tree_final_model <span class="sc">|&gt;</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  rpart.plot<span class="sc">::</span><span class="fu">rpart.plot</span>(<span class="at">roundint =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ooh La La… a tuned <strong>Bagged Tree</strong> model.</p>
<p>This time, we use bag_tree from the baguette library and do basically the same things as for the tree model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(baguette)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>bag_mod <span class="ot">&lt;-</span> <span class="fu">bag_tree</span>(<span class="at">tree_depth =</span> <span class="fu">tune</span>(),</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_n =</span> <span class="dv">20</span>,</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">cost_complexity =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">|&gt;</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>bag_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bag_mod)</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>temp_bag <span class="ot">&lt;-</span> bag_wkf <span class="sc">|&gt;</span> </span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae)) <span class="co">#uses defaults from dials</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'butcher':
  method                 from    
  as.character.dev_topic generics</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>temp_bag <span class="sc">|&gt;</span> </span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          5 mae     standard   3245.    10    188. pre0_mod01…
 2    0.0000000001          5 rmse    standard   4752.    10    400. pre0_mod01…
 3    0.000000001          11 mae     standard   3192.    10    214. pre0_mod02…
 4    0.000000001          11 rmse    standard   4683.    10    432. pre0_mod02…
 5    0.00000001            1 mae     standard   5305.    10    390. pre0_mod03…
 6    0.00000001            1 rmse    standard   6751.    10    537. pre0_mod03…
 7    0.0000001             7 mae     standard   3302.    10    166. pre0_mod04…
 8    0.0000001             7 rmse    standard   4922.    10    406. pre0_mod04…
 9    0.000001             13 mae     standard   3079.    10    170. pre0_mod05…
10    0.000001             13 rmse    standard   4647.    10    412. pre0_mod05…
11    0.00001               2 mae     standard   4126.    10    227. pre0_mod06…
12    0.00001               2 rmse    standard   5652.    10    412. pre0_mod06…
13    0.0001                8 mae     standard   3179.    10    228. pre0_mod07…
14    0.0001                8 rmse    standard   4807.    10    453. pre0_mod07…
15    0.001                15 mae     standard   3270.    10    184. pre0_mod08…
16    0.001                15 rmse    standard   4709.    10    404. pre0_mod08…
17    0.01                  4 mae     standard   3562.    10    210. pre0_mod09…
18    0.01                  4 rmse    standard   4989.    10    432. pre0_mod09…
19    0.1                  10 mae     standard   4658.    10    272. pre0_mod10…
20    0.1                  10 rmse    standard   6042.    10    436. pre0_mod10…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>bag_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb195-4"><a href="#cb195-4" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="ot">&lt;-</span> bag_wkf <span class="sc">|&gt;</span> </span>
<span id="cb195-5"><a href="#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb195-6"><a href="#cb195-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> bag_grid,</span>
<span id="cb195-7"><a href="#cb195-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb195-8"><a href="#cb195-8" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001          1 mae     standard   5395.    10    402. pre0_mod01…
 2    0.0000000001          1 rmse    standard   6904.    10    563. pre0_mod01…
 3    0.0000000001          4 mae     standard   3433.    10    194. pre0_mod02…
 4    0.0000000001          4 rmse    standard   4906.    10    411. pre0_mod02…
 5    0.0000000001          8 mae     standard   3314.    10    211. pre0_mod03…
 6    0.0000000001          8 rmse    standard   4930.    10    455. pre0_mod03…
 7    0.0000000001         11 mae     standard   3239.    10    154. pre0_mod04…
 8    0.0000000001         11 rmse    standard   4804.    10    389. pre0_mod04…
 9    0.0000000001         15 mae     standard   3146.    10    191. pre0_mod05…
10    0.0000000001         15 rmse    standard   4765.    10    449. pre0_mod05…
# ℹ 90 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>bag_fits <span class="sc">|&gt;</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.metric == "rmse") |&gt;</span></span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 8
   cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
 1    0.0000000001         15 mae     standard   3146.    10    191. pre0_mod05…
 2    0.00001               8 mae     standard   3166.    10    207. pre0_mod28…
 3    0.00001              11 mae     standard   3167.    10    202. pre0_mod29…
 4    0.00001              15 mae     standard   3176.    10    211. pre0_mod30…
 5    0.00000001            8 mae     standard   3186.    10    220. pre0_mod13…
 6    0.000001              8 mae     standard   3188.    10    201. pre0_mod23…
 7    0.001                 8 mae     standard   3195.    10    204. pre0_mod38…
 8    0.000001             15 mae     standard   3198.    10    166. pre0_mod25…
 9    0.0001               15 mae     standard   3200.    10    191. pre0_mod35…
10    0.00000001           11 mae     standard   3226.    10    203. pre0_mod14…
# ℹ 90 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>bag_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(bag_fits, <span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>bag_final_wkf <span class="ot">&lt;-</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  bag_wkf <span class="sc">|&gt;</span></span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(bag_best_params)</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>bag_final_fit <span class="ot">&lt;-</span> bag_final_wkf <span class="sc">|&gt;</span> </span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>bag_final_fit<span class="sc">$</span>.metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
# A tibble: 2 × 4
  .metric .estimator .estimate .config        
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
1 rmse    standard       6483. pre0_mod0_post0
2 mae     standard       3930. pre0_mod0_post0</code></pre>
</div>
</div>
<p>Finally, a tuned Random Forest model: it uses the library ranger and rand_forest to tune mtry and trees. Let’s check out the comparisons between the models below to learn more!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>rand_for_mod <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'ranger'</span>, <span class="at">importance=</span><span class="st">'impurity'</span>) <span class="sc">|&gt;</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">'regression'</span>)</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>rand_for_wkf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(seoul_train_rec_1) <span class="sc">|&gt;</span></span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rand_for_mod)</span>
<span id="cb201-8"><a href="#cb201-8" aria-hidden="true" tabindex="-1"></a>temp_rand_for <span class="ot">&lt;-</span> rand_for_wkf<span class="sc">|&gt;</span></span>
<span id="cb201-9"><a href="#cb201-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold,</span>
<span id="cb201-10"><a href="#cb201-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid=</span><span class="dv">7</span>,</span>
<span id="cb201-11"><a href="#cb201-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>i Creating pre-processing data to finalize 1 unknown parameter: "mtry"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>temp_rand_for <span class="sc">|&gt;</span><span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1     1  1333 mae     standard   4815.    10    224. pre0_mod1_post0
 2     1  1333 rmse    standard   5914.    10    346. pre0_mod1_post0
 3     3   334 mae     standard   3291.    10    218. pre0_mod2_post0
 4     3   334 rmse    standard   4731.    10    451. pre0_mod2_post0
 5     5  2000 mae     standard   3113.    10    203. pre0_mod3_post0
 6     5  2000 rmse    standard   4607.    10    453. pre0_mod3_post0
 7     8  1000 mae     standard   3012.    10    211. pre0_mod4_post0
 8     8  1000 rmse    standard   4552.    10    469. pre0_mod4_post0
 9    10     1 mae     standard   4396.    10    435. pre0_mod5_post0
10    10     1 rmse    standard   6455.    10    794. pre0_mod5_post0
11    12  1666 mae     standard   2992.    10    229. pre0_mod6_post0
12    12  1666 rmse    standard   4557.    10    481. pre0_mod6_post0
13    15   667 mae     standard   2979.    10    231. pre0_mod7_post0
14    15   667 rmse    standard   4560.    10    483. pre0_mod7_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>rand_for_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">mtry</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">ncol</span>(seoul_train) <span class="sc">-</span> <span class="dv">1</span>)), <span class="fu">trees</span>())</span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="ot">&lt;-</span> rand_for_wkf <span class="sc">|&gt;</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> seoul_10_fold, <span class="at">grid=</span>rand_for_grid,</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="sc">|&gt;</span> <span class="fu">collect_metrics</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1     1     1 mae     standard   5990.    10    430. pre0_mod1_post0
 2     1     1 rmse    standard   7859.    10    427. pre0_mod1_post0
 3     1  1000 mae     standard   4852.    10    212. pre0_mod2_post0
 4     1  1000 rmse    standard   5942.    10    335. pre0_mod2_post0
 5     1  2000 mae     standard   4810.    10    220. pre0_mod3_post0
 6     1  2000 rmse    standard   5915.    10    343. pre0_mod3_post0
 7     7     1 mae     standard   4827.    10    388. pre0_mod4_post0
 8     7     1 rmse    standard   7107.    10    781. pre0_mod4_post0
 9     7  1000 mae     standard   3043.    10    209. pre0_mod5_post0
10     7  1000 rmse    standard   4566.    10    465. pre0_mod5_post0
11     7  2000 mae     standard   3047.    10    207. pre0_mod6_post0
12     7  2000 rmse    standard   4564.    10    460. pre0_mod6_post0
13    13     1 mae     standard   4461.    10    344. pre0_mod7_post0
14    13     1 rmse    standard   6689.    10    590. pre0_mod7_post0
15    13  1000 mae     standard   3002.    10    231. pre0_mod8_post0
16    13  1000 rmse    standard   4549.    10    487. pre0_mod8_post0
17    13  2000 mae     standard   2988.    10    228. pre0_mod9_post0
18    13  2000 rmse    standard   4549.    10    479. pre0_mod9_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>rand_for_fits <span class="sc">|&gt;</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filter(.metric == 'rmse') |&gt;</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 8
    mtry trees .metric .estimator  mean     n std_err .config        
   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1    13  2000 mae     standard   2988.    10    228. pre0_mod9_post0
 2    13  1000 mae     standard   3002.    10    231. pre0_mod8_post0
 3     7  1000 mae     standard   3043.    10    209. pre0_mod5_post0
 4     7  2000 mae     standard   3047.    10    207. pre0_mod6_post0
 5    13     1 mae     standard   4461.    10    344. pre0_mod7_post0
 6    13  2000 rmse    standard   4549.    10    479. pre0_mod9_post0
 7    13  1000 rmse    standard   4549.    10    487. pre0_mod8_post0
 8     7  2000 rmse    standard   4564.    10    460. pre0_mod6_post0
 9     7  1000 rmse    standard   4566.    10    465. pre0_mod5_post0
10     1  2000 mae     standard   4810.    10    220. pre0_mod3_post0
11     7     1 mae     standard   4827.    10    388. pre0_mod4_post0
12     1  1000 mae     standard   4852.    10    212. pre0_mod2_post0
13     1  2000 rmse    standard   5915.    10    343. pre0_mod3_post0
14     1  1000 rmse    standard   5942.    10    335. pre0_mod2_post0
15     1     1 mae     standard   5990.    10    430. pre0_mod1_post0
16    13     1 rmse    standard   6689.    10    590. pre0_mod7_post0
17     7     1 rmse    standard   7107.    10    781. pre0_mod4_post0
18     1     1 rmse    standard   7859.    10    427. pre0_mod1_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>rand_for_best_params <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rand_for_fits, <span class="at">metric =</span> <span class="st">'rmse'</span>)</span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>rand_for_final_wkf <span class="ot">&lt;-</span> rand_for_wkf <span class="sc">|&gt;</span><span class="fu">finalize_workflow</span>(rand_for_best_params)</span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>rand_for_final_fit <span class="ot">&lt;-</span> rand_for_final_wkf <span class="sc">|&gt;</span> <span class="fu">last_fit</span>(seoul_data, <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse, mae))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Each of these models are fit and tuned on the training set. The best model from each family of models is then fit it to the entire training data set to see how it predicts on the test set.</p>
<p>All final model’s RMSE and MAE are shown in the table below. The Random Forest model has the lowest RMSE and MAE, which would make it my choice for the ‘best’ model for predicting the bike rentals in Seoul. The second ‘best’ model would be the Bagged Tree model, with the closest RMSE and MAE values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(</span>
<span id="cb210-2"><a href="#cb210-2" aria-hidden="true" tabindex="-1"></a>   best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb210-3"><a href="#cb210-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span> </span>
<span id="cb210-4"><a href="#cb210-4" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"MLR"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>), </span>
<span id="cb210-5"><a href="#cb210-5" aria-hidden="true" tabindex="-1"></a>  LASSO_model <span class="sc">|&gt;</span></span>
<span id="cb210-6"><a href="#cb210-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb210-7"><a href="#cb210-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"LASSO"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb210-8"><a href="#cb210-8" aria-hidden="true" tabindex="-1"></a>  tree_final_fit <span class="sc">|&gt;</span></span>
<span id="cb210-9"><a href="#cb210-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb210-10"><a href="#cb210-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"TREE"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb210-11"><a href="#cb210-11" aria-hidden="true" tabindex="-1"></a>  bag_final_fit <span class="sc">|&gt;</span></span>
<span id="cb210-12"><a href="#cb210-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb210-13"><a href="#cb210-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"BAG"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>),</span>
<span id="cb210-14"><a href="#cb210-14" aria-hidden="true" tabindex="-1"></a>  rand_for_final_fit <span class="sc">|&gt;</span></span>
<span id="cb210-15"><a href="#cb210-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">|&gt;</span></span>
<span id="cb210-16"><a href="#cb210-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"RANDOM FOREST"</span>, <span class="at">.before =</span> <span class="st">".metric"</span>)</span>
<span id="cb210-17"><a href="#cb210-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   Model         .metric .estimator .estimate .config        
   &lt;chr&gt;         &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          
 1 MLR           rmse    standard       7068. pre0_mod0_post0
 2 MLR           mae     standard       4801. pre0_mod0_post0
 3 LASSO         rmse    standard       7071. pre0_mod0_post0
 4 LASSO         mae     standard       4821. pre0_mod0_post0
 5 TREE          rmse    standard       7310. pre0_mod0_post0
 6 TREE          mae     standard       4649. pre0_mod0_post0
 7 BAG           rmse    standard       6483. pre0_mod0_post0
 8 BAG           mae     standard       3930. pre0_mod0_post0
 9 RANDOM FOREST rmse    standard       6372. pre0_mod0_post0
10 RANDOM FOREST mae     standard       3577. pre0_mod0_post0</code></pre>
</div>
</div>
<p>Below are the extracted final model fits for each type, followed by a summary of each model.</p>
<p>The MLR model’s final coefficient table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# Manual resampling 
# A tibble: 1 × 6
  splits           id               .metrics .notes   .predictions .workflow 
  &lt;list&gt;           &lt;chr&gt;            &lt;list&gt;   &lt;list&gt;   &lt;list&gt;       &lt;list&gt;    
1 &lt;split [273/92]&gt; train/test split &lt;tibble&gt; &lt;tibble&gt; &lt;tibble&gt;     &lt;workflow&gt;

There were issues with some computations:

  - Warning(s) x1: prediction from rank-deficient fit; consider predict(., rankdefic...

Run `show_notes(.Last.tune.result)` for more information.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a>best_mod_fit <span class="sc">|&gt;</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 5
   term                  estimate std.error statistic    p.value
   &lt;chr&gt;                    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1 (Intercept)             16980.      318.    53.3    1.12e-141
 2 sum_rainfall            -1812.      424.    -4.27   2.74e-  5
 3 sum_snowfall             -257.      348.    -0.737  4.62e-  1
 4 mean_celcius_temp       -1659.     6072.    -0.273  7.85e-  1
 5 mean_percent_humidity   -1422.     2231.    -0.637  5.25e-  1
 6 mean_wind_speed          -900.      368.    -2.44   1.52e-  2
 7 mean_visib               -310.      456.    -0.681  4.96e-  1
 8 mean_dew_point_temp      5142.     7042.     0.730  4.66e-  1
 9 mean_solar_rad           4365.      593.     7.36   2.42e- 12
10 mean_rainfall              NA        NA     NA     NA        
11 mean_snowfall              NA        NA     NA     NA        
12 seasons_Spring          -1478.      450.    -3.28   1.17e-  3
13 seasons_Summer           -547.      536.    -1.02   3.09e-  1
14 seasons_Winter          -3093.      603.    -5.13   5.80e-  7
15 holiday_No.Holiday        966.      326.     2.97   3.29e-  3
16 day_type_Weekend        -1247.      328.    -3.80   1.83e-  4</code></pre>
</div>
</div>
<p>According to the MLR coefficient table, the dew point temperature, followed by the solar radiation, are the two most impactful variables.</p>
<p>The LASSO model’s final coefficient table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>LASSO_final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────

Call:  glmnet::glmnet(x = maybe_matrix(x), y = y, family = "gaussian",      alpha = ~1) 

   Df  %Dev Lambda
1   0  0.00 7205.0
2   2 10.52 6565.0
3   2 19.74 5982.0
4   2 27.40 5450.0
5   2 33.75 4966.0
6   3 39.38 4525.0
7   3 44.05 4123.0
8   3 47.93 3757.0
9   3 51.15 3423.0
10  3 53.82 3119.0
11  3 56.04 2842.0
12  3 57.88 2589.0
13  3 59.41 2359.0
14  3 60.68 2150.0
15  3 61.74 1959.0
16  3 62.61 1785.0
17  5 63.74 1626.0
18  5 64.85 1482.0
19  5 65.76 1350.0
20  5 66.52 1230.0
21  5 67.15 1121.0
22  7 67.90 1021.0
23  7 68.67  930.6
24  8 69.33  847.9
25  8 70.00  772.6
26  9 70.68  704.0
27  9 71.28  641.4
28  9 71.77  584.4
29  9 72.19  532.5
30  9 72.53  485.2
31  9 72.81  442.1
32  9 73.05  402.8
33  9 73.24  367.0
34  9 73.41  334.4
35  9 73.54  304.7
36 11 73.66  277.7
37 11 73.76  253.0
38 11 73.84  230.5
39 12 73.92  210.0
40 12 73.98  191.4
41 12 74.04  174.4
42 12 74.09  158.9
43 12 74.13  144.8
44 12 74.16  131.9
45 12 74.18  120.2
46 12 74.21  109.5

...
and 38 more lines.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>LASSO_final <span class="sc">|&gt;</span> </span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 3
   term                  estimate      penalty
   &lt;chr&gt;                    &lt;dbl&gt;        &lt;dbl&gt;
 1 (Intercept)             16980. 0.0000000001
 2 sum_rainfall            -1377. 0.0000000001
 3 sum_snowfall             -173. 0.0000000001
 4 mean_celcius_temp         391. 0.0000000001
 5 mean_percent_humidity    -670. 0.0000000001
 6 mean_wind_speed          -894. 0.0000000001
 7 mean_visib               -268. 0.0000000001
 8 mean_dew_point_temp      2736. 0.0000000001
 9 mean_solar_rad           4348. 0.0000000001
10 mean_rainfall            -485. 0.0000000001
11 mean_snowfall            -101. 0.0000000001
12 seasons_Spring          -1475. 0.0000000001
13 seasons_Summer           -525. 0.0000000001
14 seasons_Winter          -3065. 0.0000000001
15 holiday_No.Holiday        961. 0.0000000001
16 day_type_Weekend        -1260. 0.0000000001</code></pre>
</div>
</div>
<p>According to this table of coefficients, the LASSO model perceives the solar radiation and dew point temperature to have the biggest influence on the accuracy of the prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="ot">&lt;-</span> tree_final_fit <span class="sc">|&gt;</span> <span class="fu">collect_predictions</span>()</span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(tree_preds)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ".pred"                 "id"                    "sum_rented_bike_count"
[4] ".row"                  ".config"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>tree_preds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 92 × 5
    .pred id               sum_rented_bike_count  .row .config        
    &lt;dbl&gt; &lt;chr&gt;                            &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;          
 1 18607. train/test split                 17388     4 pre0_mod0_post0
 2  8462. train/test split                  3231     7 pre0_mod0_post0
 3 20356  train/test split                 21585    16 pre0_mod0_post0
 4  8462. train/test split                  7448    17 pre0_mod0_post0
 5 24018. train/test split                 24077    23 pre0_mod0_post0
 6  5107  train/test split                  8523    24 pre0_mod0_post0
 7 29798. train/test split                 29761    30 pre0_mod0_post0
 8 24018. train/test split                     0    35 pre0_mod0_post0
 9 24018. train/test split                 20471    47 pre0_mod0_post0
10  5107  train/test split                  8729    48 pre0_mod0_post0
# ℹ 82 more rows</code></pre>
</div>
</div>
<p>The Regression Tree model’s plot of the final fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a>tree_preds <span class="sc">|&gt;</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sum_rented_bike_count, <span class="at">y=</span>.pred)) <span class="sc">+</span></span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">'lm'</span>)<span class="sc">+</span></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Actual Rented Bike Count versus Predictions </span><span class="sc">\n</span><span class="st">for Regression Tree Model'</span>, <span class="at">x=</span><span class="st">'Rented Bike Count'</span>, <span class="at">y =</span> <span class="st">'Predictions for Rented Bike Count'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Regression Tree model shows a positive relationship between the actual rented bike count and the predicted rented bike count, shown by the blue indicator line. There are obvious visual outliers that prevent this line from having a slope of 1.</p>
<p>The bagged tree model’s variable importance plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>bag_final_model <span class="ot">&lt;-</span> <span class="fu">extract_fit_engine</span>(bag_final_fit) </span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>bag_final_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bagged CART (regression with 11 members)

Variable importance scores include:

# A tibble: 15 × 4
   term                         value  std.error  used
   &lt;chr&gt;                        &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;
 1 mean_celcius_temp     17513516003. 681600847.    11
 2 mean_dew_point_temp   14558519909. 914272216.    11
 3 mean_solar_rad        12549174255. 571796471.    11
 4 seasons_Winter        10568344509. 540672221.    11
 5 mean_percent_humidity  7640471028. 863312657.    11
 6 sum_rainfall           3157419217. 303808052.    11
 7 mean_rainfall          3102348320. 332428657.    11
 8 sum_snowfall           2454969878. 509177031.    11
 9 seasons_Summer         1786424100. 645545684.    11
10 mean_wind_speed        1502568957. 241089384.    11
11 mean_visib             1360964483. 176252020.    11
12 seasons_Spring         1306175251. 110103994.    11
13 mean_snowfall           567049114. 365430821.    10
14 day_type_Weekend        119543152.  34635566.    11
15 holiday_No.Holiday       84136258.  38596402.     8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>bag_final_model<span class="sc">$</span>imp <span class="sc">|&gt;</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term =</span> <span class="fu">factor</span>(term, <span class="at">levels =</span> term)) <span class="sc">|&gt;</span></span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> value)) <span class="sc">+</span> </span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span><span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Variable Importance for Bagged Tree Model'</span>, <span class="at">x=</span><span class="st">'Variable'</span>, <span class="at">y=</span><span class="st">'Importance'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Looks like the temperature, solar radiation, and the dew point temperature were deemed the ‘most important’ by the Bagged tree model, which aligns with the results we anticipated in the correlation matrix from before. Snowfall, holiday/non-holiday, and weekday/weekend were not very relevant variables to the model.</p>
<p>Now, let’s break down the Random Forest model with a function to extract the fit to a control grid, then resample the fit using that control grid.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>get_rand_for_importance <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">extract_fit_parsnip</span>() <span class="sc">|&gt;</span></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>    vip<span class="sc">::</span><span class="fu">vi</span>()</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>ctrl_imp <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">extract =</span> get_rand_for_importance)</span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>cells_resampling <span class="ot">&lt;-</span></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>  rand_for_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(seoul_10_fold, <span class="at">control =</span> ctrl_imp)</span>
<span id="cb229-12"><a href="#cb229-12" aria-hidden="true" tabindex="-1"></a>cells_resampling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Resampling results
# 10-fold cross-validation 
# A tibble: 10 × 5
   splits           id     .metrics         .notes           .extracts       
   &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;           &lt;list&gt;           &lt;list&gt;          
 1 &lt;split [245/28]&gt; Fold01 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 2 &lt;split [245/28]&gt; Fold02 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 3 &lt;split [245/28]&gt; Fold03 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 4 &lt;split [246/27]&gt; Fold04 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 5 &lt;split [246/27]&gt; Fold05 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 6 &lt;split [246/27]&gt; Fold06 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 7 &lt;split [246/27]&gt; Fold07 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 8 &lt;split [246/27]&gt; Fold08 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
 9 &lt;split [246/27]&gt; Fold09 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;
10 &lt;split [246/27]&gt; Fold10 &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 4]&gt; &lt;tibble [1 × 2]&gt;</code></pre>
</div>
</div>
<p>Great, now we can unnest the tibble’s nested tibbles in the .extracts column to get the lists 2 levels down.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>cells_resampling_2 <span class="ot">&lt;-</span> cells_resampling <span class="sc">|&gt;</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .extracts) <span class="sc">|&gt;</span></span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(.extracts) <span class="sc">|&gt;</span></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(.extracts) </span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a>cells_resampling_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 150 × 4
   id     Variable                Importance .config        
   &lt;chr&gt;  &lt;chr&gt;                        &lt;dbl&gt; &lt;chr&gt;          
 1 Fold01 mean_celcius_temp     13286627727. pre0_mod0_post0
 2 Fold01 mean_solar_rad         5084384925. pre0_mod0_post0
 3 Fold01 seasons_Winter         1444902431. pre0_mod0_post0
 4 Fold01 mean_dew_point_temp    1344712429. pre0_mod0_post0
 5 Fold01 mean_rainfall           611999661. pre0_mod0_post0
 6 Fold01 sum_rainfall            609877607. pre0_mod0_post0
 7 Fold01 mean_wind_speed         605929174. pre0_mod0_post0
 8 Fold01 mean_percent_humidity   499242914. pre0_mod0_post0
 9 Fold01 mean_visib              439304999. pre0_mod0_post0
10 Fold01 day_type_Weekend        204100522. pre0_mod0_post0
# ℹ 140 more rows</code></pre>
</div>
</div>
<p>The random forest model’s variable importance plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cells_resampling_2, <span class="fu">aes</span>(<span class="at">x=</span>Variable, <span class="at">y=</span>Importance)) <span class="sc">+</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">'identity'</span>)<span class="sc">+</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">'Variable Importance for Random Forest Model'</span>, <span class="at">x=</span><span class="st">'Variable'</span>, <span class="at">y=</span><span class="st">'Importance'</span>) <span class="sc">+</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Basic-Modeling-Practice_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Once again, the Random Forest Model dictates the high importance of the temperature, solar radiation, dew point temperature, closely followed by the season being winter! What a cool analysis.</p>
<p>For the overall best model, the random forest model, here’s the fit for the entire data set!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a>combo <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(seoul_test,seoul_train)</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a>rand_for_final_model_fit_total <span class="ot">&lt;-</span> rand_for_final_wkf <span class="sc">|&gt;</span></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(combo)</span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>rand_for_final_model_fit_total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
4 Recipe Steps

• step_mutate()
• step_dummy()
• step_normalize()
• step_rm()

── Model ───────────────────────────────────────────────────────────────────────
Ranger result

Call:
 ranger::ranger(x = maybe_data_frame(x), y = y, mtry = min_cols(~13L,      x), num.trees = ~2000L, importance = ~"impurity", num.threads = 1,      verbose = FALSE, seed = sample.int(10^5, 1)) 

Type:                             Regression 
Number of trees:                  2000 
Sample size:                      365 
Number of independent variables:  15 
Mtry:                             13 
Target node size:                 5 
Variable importance mode:         impurity 
Splitrule:                        variance 
OOB prediction error (MSE):       25390405 
R squared (OOB):                  0.7587373 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>